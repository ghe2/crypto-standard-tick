define(["Handlebars","QuickBase","moment","xlsx","jstree","css!./css/app.css"],function(e,E,v,T,Y){"use strict";var X,i=this&&this.__extends||(X=function(e,t){return(X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}X(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),g=this&&this.__assign||function(){return(g=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},G=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var n,r=0,o=t.length;r<o;r++)!n&&r in t||((n=n||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},n={Trigger:{default:"Click",enum:["Click","Hover"],propertyOrder:2,title:"Trigger Action",type:"string"}},r={RuleName:{default:"",propertyOrder:1,title:"Rule Name",type:"string"},RuleSource:{default:"",enumSource:"possible_columns",propertyOrder:3,title:"Rule Source",type:"string",watch:{possibleCols:"arrItem.possibleRulesColumns"}},RuleTarget:{enumSource:"possible_columns",default:"",propertyOrder:2,title:"Rule Target",type:"string",watch:{possibleCols:"arrItem.possibleYColumns"}},RuleType:{options:{hidden:!0},propertyOrder:4,title:"Rule Type",type:"string"},Show:{default:!1,format:"checkbox",propertyOrder:5,title:"Show Rule in Legend",type:"boolean"}},z=(o.getComponentDefinition=function(e){var t={id:667,componentName:"Editable Dropdown",componentDescription:"Editable dropdown",appKey:"EditableList",css:"EditableList",appArgs:{quickStart:[{path:"Layers.0.Data",message:"populate Data Source"}],json:{version:"4.7.3",possibleLegendGroups:["None"],possiblePositions:["Top","Bottom","Left","Right"],Style:{advanced:""},Basics:{Hover:"",Selected:"",Duration:400,Easing:"easeOutQuart"},Layers:[{_Id:"L0",_Type:"Bubble",Data:"",XAxis:"",YAxis:"",XAxisId:"X-Axis 1",YAxisId:"Y-Axis 1",Color:_.clone(o.COLOR_DEFAULT),ColorData:"None",Opacity:80,Name:"",Enabled:!0,Legend:!0,LegendGroup:"None",Palette:_.cloneDeep(o.PALETTE_DEFAULT),Actions:[],RadiusData:"Fixed Size",RadiusScaling:4,ScaleOnZoom:!0,Icon:"",HighlightRules:[],possibleRadiusData:["Fixed Size"],possibleRulesColumns:[],possibleXColumns:[],possibleYColumns:[],possibleXAxes:["X-Axis 1"],possibleYAxes:["Y-Axis 1"]}],Xaxes:[{Bounds:"",Type:"Linear",Position:"Bottom",Width:0,Ticks:10,Title:{Display:!1,LabelString:"",FontSize:16},Format:{Display:!0,BeginAtZero:!1,Format:"Number",Precision:2,FontSize:12,Prefix:"",Suffix:"",HideTrailingZeroes:!1},Range:{UseMinMax:!1,Min:"",Max:"",SelectionMin:"",SelectionMax:""},Gridlines:{GridlinesOffset:!1,GridlinesColor:"",GridlinesOpacity:15}}],Yaxes:[{Bounds:"",Type:"Linear",Position:"Left",Width:0,Ticks:10,Title:{Display:!1,LabelString:"",FontSize:16},Format:{Display:!0,BeginAtZero:!1,Format:"Number",Precision:2,FontSize:12,Prefix:"",Suffix:"",HideTrailingZeroes:!1},Range:{UseMinMax:!1,Min:"",Max:"",SelectionMin:"",SelectionMax:""},Gridlines:{GridlinesOffset:!1,GridlinesColor:"",GridlinesOpacity:15}}],Overlay:{ShowCrosshairs:!0,ShowCoordinates:!0,SnapToPoint:!0,UseCustomTooltip:!1,CustomTooltip:o.CUSTOM_TOOLTIP_DEFAULT,ShowAllPoints:!1,GroupByLayer:!1},Legend:{Position:"Top",LegendGroups:[]},FileExport:{FileName:[],ShowExportCsvButton:!1,ShowExportExcelButton:!1}},schema:{type:"object",title:"Properties",properties:{possibleXColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},possibleYColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},possibleLegendGroups:{type:"array",options:{hidden:!0},default:["None"]},possiblePositions:{type:"array",options:{hidden:!0},default:["Top","Bottom","Left","Right"]},Basics:{propertyOrder:0,type:"object",title:"Basics",options:{collapsed:!0},properties:{Hover:{title:"Hover",type:"string",default:""},Selected:{title:"Selected",type:"string",default:""},Duration:{title:"Animation Duration",type:"number",default:400},Easing:{title:"Animation Easing",type:"string",default:"easeOutQuart",enum:["swingFromTo","swingFrom","swingTo","easeFromTo","easeFrom","easeTo","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeOutBounce","easeInBack","easeOutBack","easeInOutBack","bounce","bouncePast","elastic"]}}},Layers:{propertyOrder:1,type:"array",items:{type:"object",id:"arrItem",title:"Layer",options:{collapsed:!0},headerTemplate:"{{#if self.Name}}{{valueProp self.Name }}{{else}}Layer {{ i1 }}{{/if}}",oneOf:[{title:"Bubble",options:{linked_oneof_property:{property:"_Type",value:"Bubble"}},properties:_.extend({},o.LAYER_COMMON,{RadiusData:{title:"Radius Data",type:"",propertyOrder:7,default:"Fixed Size",enumSource:"possible_columns",watch:{possibleCols:"arrItem.possibleRadiusData"}},RadiusScaling:{title:"Radius Scaling",type:"number",propertyOrder:7,default:4},ScaleOnZoom:{title:"Scale on Zoom",type:"boolean",default:!0,propertyOrder:7},Icon:{type:"icon",title:"Icon",iconTypes:"fa",propertyOrder:8,default:""}})},{title:"Line",options:{linked_oneof_property:{property:"_Type",value:"Line"}},properties:_.extend({},o.LAYER_COMMON,{Line:{title:"Line",type:"object",options:{collapsed:!0},propertyOrder:9,properties:{Fill:{title:"Fill",type:"dropdown",default:"No Fill",data:"possible_columns",watch:{possible_layers:"arrItem.possibleLayers"},propertyOrder:8},FillColor:{default:"#0061FF",options:{gradient:!1,noColor:!1},propertyOrder:8,title:"Fill Color",type:"gradient"},FillOpacity:{title:"Fill Opacity",type:"number",default:80,propertyOrder:8},FadeToTransparent:{title:"Fade to Transparent",type:"boolean",default:!1,propertyOrder:8},SpanGaps:{title:"Span Gaps",type:"boolean",default:!1,propertyOrder:8},FillPalette:{title:"Fill Color Palette",type:"array",format:"table",options:{collapsed:!0},uniqueItems:!1,items:{type:"object",title:"Fill Palette Color",properties:{type:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:_.cloneDeep(o.PALETTE_DEFAULT),propertyOrder:10}}}})},{title:"Bar",options:{linked_oneof_property:{property:"_Type",value:"Bar"}},properties:_.extend({},o.LAYER_COMMON,o.BAR_PROPERTIES)},{title:"Candlestick",options:{linked_oneof_property:{property:"_Type",value:"Candlestick"}},properties:_.extend({},o.LAYER_COMMON,{Open:{enumSource:"possible_columns",propertyOrder:3,title:"Open",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},High:{enumSource:"possible_columns",propertyOrder:3,title:"High",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},Low:{enumSource:"possible_columns",propertyOrder:3,title:"Low",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},Close:{enumSource:"possible_columns",propertyOrder:3,title:"Close",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},CandlestickFormat:{type:"object",title:"Candlestick Format",propertyOrder:9,options:{collapsed:!0},properties:_.extend({},o.BAR_PROPERTIES,{BearColor:{default:"#ff0000",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Bear Color",type:"gradient"},BullColor:{default:"#00ff00",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Bull Color",type:"gradient"},NeutralColor:{default:"#ffffff",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Neutral Color",type:"gradient"},WickColor:{default:"#7b8284",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Wick Color",type:"gradient"}})},YAxis:{options:{hidden:!0}}})}]}},Xaxes:{title:"X-Axes",type:"array",propertyOrder:2,options:{collapsed:!0},items:{title:"X-Axis",type:"object",options:{collapsed:!0},properties:{Bounds:{options:{hidden:!0}},Type:{title:"X-Axis Type",type:"string",propertyOrder:1,enum:["Linear","Category"],default:"Linear"},Position:{title:"Position",type:"string",enum:["Top","Bottom"],propertyOrder:2,default:"Bottom"},Width:{title:"Height",type:"number",propertyOrder:2,default:0},Ticks:{type:"number",title:"Number of Ticks",propertyOrder:2,default:10},Title:{type:"object",title:"Title",options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!1},LabelString:{title:"Label String",type:"string",default:""},FontSize:{title:"Font Size",type:"number",default:16}}},Range:{type:"object",title:"Range",propertyOrder:2,options:{collapsed:!0,hidden:!1},properties:{UseMinMax:{title:"Use min max",type:"boolean",default:!1},Min:{title:"Min",type:"string",default:""},Max:{title:"Max",type:"string",default:""},SelectionMin:{title:"Selection Min",type:"string",default:""},SelectionMax:{title:"Selection Max",type:"string",default:""}}},Gridlines:{type:"object",title:"Gridlines",propertyOrder:3,options:{collapsed:!0},properties:{GridlinesOffset:{title:"Offset Gridlines",type:"boolean",default:!1},GridlinesColor:{title:"Gridlines Color",type:"gradient",options:{noColor:!0,gradient:!1},default:""},GridlinesOpacity:{title:"Gridlines Opacity",type:"number",default:15}}},Format:{type:"object",title:"Format",propertyOrder:4,options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!0},BeginAtZero:{type:"boolean",title:"Begin at Zero",format:"checkbox",default:!1},Format:{title:"Numeric Format",type:"string",enum:["Number","Smart Number","Formatted Number"],default:"Number"},Precision:{title:"Decimal Places",type:"number",default:2},FontSize:{title:"Font Size",type:"number",format:"number",default:12},Prefix:{title:"Prefix",type:"string",default:""},Suffix:{title:"Suffix",type:"string",default:""},HideTrailingZeroes:{type:"boolean",propertyOrder:4,title:"Hide Trailing Zeroes",format:"checkbox",default:!1}}}}}},Yaxes:{title:"Y-Axes",type:"array",propertyOrder:2,options:{collapsed:!0},items:{title:"Y-Axis",type:"object",options:{collapsed:!0},properties:{Bounds:{options:{hidden:!0}},Type:{title:"Y-Axis Type",type:"string",propertyOrder:1,enum:["Linear","Category"],default:"Linear"},Position:{title:"Position",type:"string",enum:["Left","Right"],propertyOrder:2,default:"Left"},Width:{title:"Width",type:"number",propertyOrder:2,default:0},Ticks:{type:"number",title:"Number of Ticks",propertyOrder:2,default:10},Title:{type:"object",title:"Title",options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!1},LabelString:{title:"Label String",type:"string",default:""},FontSize:{title:"Font Size",type:"number",default:16}}},Range:{type:"object",title:"Range",propertyOrder:2,options:{collapsed:!0,hidden:!1},properties:{UseMinMax:{title:"Use min max",type:"boolean",default:!1},Min:{title:"Min",type:"string",default:""},Max:{title:"Max",type:"string",default:""},SelectionMin:{title:"Selection Min",type:"string",default:""},SelectionMax:{title:"Selection Max",type:"string",default:""}}},Gridlines:{type:"object",title:"Gridlines",propertyOrder:3,options:{collapsed:!0},properties:{GridlinesOffset:{title:"Offset Gridlines",type:"boolean",default:!1},GridlinesColor:{title:"Gridlines Color",type:"gradient",options:{noColor:!0,gradient:!1},default:""},GridlinesOpacity:{title:"Gridlines Opacity",type:"number",default:15}}},Format:{type:"object",title:"Format",propertyOrder:3,options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!0},BeginAtZero:{type:"boolean",title:"Begin at Zero",format:"checkbox",default:!1},Format:{title:"Numeric Format",type:"string",enum:["Number","Smart Number","Formatted Number"],default:"Number"},Precision:{title:"Decimal Places",type:"number",default:2},FontSize:{title:"Font Size",type:"number",format:"number",default:12},Prefix:{title:"Prefix",type:"string",default:""},Suffix:{title:"Suffix",type:"string",default:""},HideTrailingZeroes:{type:"boolean",propertyOrder:4,title:"Hide Trailing Zeroes",format:"checkbox",default:!1}}}}}},Overlay:{type:"object",title:"Overlay",options:{collapsed:!0},propertyOrder:209,properties:{ShowCrosshairs:{type:"boolean",title:"Show Crosshairs",default:!0},ShowCoordinates:{type:"boolean",title:"Show Coordinates",default:!0},SnapToPoint:{type:"boolean",title:"Snap Crosshair to Data",default:!0},UseCustomTooltip:{type:"boolean",title:"Use custom tooltip",default:!1},CustomTooltip:{type:"tooltipTemplate",title:"Custom tooltip",templateItems:{this:{type:"array",items:{color:"color",data:"data",icon:"icon",image:"image",name:"name",width:"width",xAxis:"xAxis",yAxis:"yAxis"}}},default:'<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead>{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</table>'},ShowAllPoints:{type:"boolean",title:"Show all data points",default:!1},GroupByLayer:{type:"boolean",title:"Group tooltip by layer",default:!1}}},FileExport:{options:{collapsed:!0},properties:{FileName:{format:"table",items:{options:{collapsed:!0},properties:{FileNamePart:{title:"FileName Part",type:"string"}},title:"Filename Part",type:"object"},options:{collapsed:!0,hidden:!1},title:"FileName",type:"array"},ShowExportCsvButton:{default:!1,format:"checkbox",title:"Show Export Csv Button",type:"boolean"},ShowExportExcelButton:{default:!1,format:"checkbox",title:"Show Export Excel Button",type:"boolean"}},propertyOrder:320,title:"File Export",type:"object"},Legend:{title:"Legend",type:"object",options:{collapsed:!0},propertyOrder:210,properties:{Position:{title:"Position",type:"dropdown",data:"possiblePositions",watch:{possiblePositions:"root.possiblePositions"},default:"Top"},LegendGroups:{title:"Legend Groups",type:"array",items:{headerTemplate:"{{#if self.Name}}{{valueProp self.Name }}{{else}}Legend Group {{ i1 }}{{/if}}",type:"object",id:"arrItem",title:"Legend Group",options:{collapsed:!0},properties:{Name:{type:"string",default:""},Expanded:{type:"boolean",default:!0},Icon:{type:"icon",title:"Icon",iconTypes:"fa",default:""}}}}}},Style:{type:"object",title:"Style",options:{collapsed:!0},propertyOrder:211,properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};if(0<_.keys(e.settingsModel.attributes).length)for(var i=_.find(o.upgrades,{version:e.settingsModel.get("version")}),n=void 0===i?1:o.upgrades.indexOf(i)+1;n<o.upgrades.length;n+=1){var r=o.upgrades[n];r.fn(e.settingsModel,e),e.settingsModel.set("version",r.version)}return t},o.PALETTE_DEFAULT=[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}],o.COLOR_DEFAULT="#0061FF",o.TOOLTIP_DEFAULT='<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead>{{#each this}} {{#if open}}<tr><td width="{{width}}">Open: </td><td>{{open}} </td></tr><tr><td width="{{width}}">High: </td><td>{{high}} </td></tr><tr><td width="{{width}}">Low: </td><td>{{low}} </td></tr><tr><td width="{{width}}">Close: </td><td>{{close}} </td></tr>{{else}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}};{{image}};"></i> {{name}}: </td><td>{{#if grouped}}{{#each grouped}}<td> {{this}} </td>{{/each}} {{else}} <td>{{yAxis}}</td> {{/if}}</td></tr>{{/if}}{{/each}}</table>',o.BAR_PROPERTIES={BarWidth:{title:"Bar Percentage",type:"number",default:95,propertyOrder:8},BarFixedWidth:{title:"Bar Fixed Width",type:"number",default:10,propertyOrder:8},BarWidthType:{title:"Bar Width Type",type:"string",default:"Percentage",enum:["Percentage","Fixed Width"],propertyOrder:8}},o.BASICS={Hover:"",Selected:"",Duration:400,Easing:"easeOutQuart"},o.CUSTOM_TOOLTIP_DEFAULT='<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead>{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</table>',o.LAYER_COMMON={_Id:{type:"string",options:{hidden:!0}},_Type:{type:"string",options:{hidden:!0}},possibleColorColumns:{type:"array",options:{hidden:!0}},possibleRadiusData:{type:"array",options:{hidden:!0}},possibleLayers:{type:"array",options:{hidden:!0}},possibleRulesColumns:{type:"array",options:{hidden:!0}},possibleXColumns:{type:"array",options:{hidden:!0}},possibleYColumns:{type:"array",options:{hidden:!0}},possibleXAxes:{type:"array",options:{hidden:!0}},possibleYAxes:{type:"array",options:{hidden:!0}},Data:{title:"Data Source",type:"data",default:"",propertyOrder:1},Name:{title:"Name",type:"string",default:"",propertyOrder:2},XAxis:{title:"X-Axis Data",type:"dropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem.possibleXColumns"},propertyOrder:3},XAxisId:{title:"X-Axis",default:"X-Axis 1",type:"string",enumSource:"possible_xaxis",watch:{possible_xaxis:"arrItem.possibleXAxes"},propertyOrder:3},YAxis:{title:"Y-Axis Data",type:"customDropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem.possibleYColumns"},propertyOrder:3},YAxisId:{title:"Y-Axis",default:"Y-Axis 1",type:"string",enumSource:"possible_yaxis",watch:{possible_yaxis:"arrItem.possibleYAxes"},propertyOrder:3},Color:{title:"Color",type:"gradient",options:{gradient:!1},default:_.clone(o.COLOR_DEFAULT),propertyOrder:8},ColorData:{title:"Color Enumeration",type:"dropdown",default:"None",data:"possible_columns",watch:{possible_columns:"arrItem.possibleColorColumns"},propertyOrder:8},Opacity:{title:"Opacity",type:"number",default:80,propertyOrder:8},LegendGroup:{title:"Legend Group",type:"dropdown",default:"None",data:"possibleCols",propertyOrder:9,watch:{possibleCols:"root.possibleLegendGroups"}},Legend:{title:"Legend Enabled",type:"boolean",default:!0,propertyOrder:9},Enabled:{title:"Enabled",type:"boolean",default:!0,propertyOrder:9},Palette:{type:"array",format:"table",title:"Color Palette",options:{collapsed:!0},uniqueItems:!1,items:{type:"object",title:"Palette Color",properties:{type:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:_.cloneDeep(o.PALETTE_DEFAULT),propertyOrder:10},Actions:{title:"Actions",type:"actions",fields:{map:_.extend({Current:{enumSource:"possible_columns",propertyOrder:10,title:"Source Column",type:"string",watch:{possibleColumns:"arrItem.possibleColorColumns"}}},n),nav:n,query:n,url:n},options:{collapsed:!0}},HighlightRules:{title:"Highlight Rules",type:"array",options:{collapsed:!0},items:{title:"Highlight Rule",type:"object",oneOf:[{options:{linked_oneof_property:{property:"RuleType",value:"discrete"}},properties:Object.assign({},r,{RuleColor:{default:"#F8F8F8",options:{gradient:!1,noColor:!1},propertyOrder:11,title:"Rule Color",type:"gradient"},RuleOperation:{default:"",enum:["","search","regexp","contains","starts with","ends with","==","<",">","<=",">=","!=","in"],propertyOrder:9,title:"Rule Operation",type:"string"},RuleValue:{data:"possible_columns",default:"",propertyOrder:10,title:"Rule Value",type:"string"}}),title:"Discrete"},{options:{additionalProperties:!1,linked_oneof_property:{property:"RuleType",value:"gradient"}},properties:Object.assign({},r,{Palette:{default:[{type:"#b71c1c"},{type:"#F57F17"},{type:"#33691E"}],format:"table",items:{properties:{type:{default:"#ffa500",options:{gradient:!1},title:"color",type:"gradient"}},title:"Palette Color",type:"object"},options:{collapsed:!0},propertyOrder:8,title:"Color Palette",type:"array",uniqueItems:!1},RuleMax:{default:1,format:"number",propertyOrder:7,title:"Rule Max",type:"number"},RuleMin:{default:0,format:"number",propertyOrder:6,title:"Rule Min",type:"number"}}),title:"Gradient"}]}}},o.upgrades=[{version:"0",fn:function(e,t){}},{version:"4.5.0",fn:function(e){e.get("Basics")&&!e.get("Basics.Easing")&&e.unset("Basics")}},{version:"4.5.1.1",fn:function(r){r.get("Palette")||r.set("Palette",o.PALETTE_DEFAULT),_.each(r.get("Layers"),function(e,t){r.get("Layers."+t+".Name")||r.set("Layers."+t+".Name","Layer "+(t+1))}),r.get("Xaxis")&&!r.get("Xaxes.Range.SelectionMin")&&(r.set("Xaxis.Range.SelectionMin",""),r.set("Xaxis.Range.SelectionMax",""),r.set("Yaxis.Range.SelectionMin",""),r.set("Yaxis.Range.SelectionMax","")),r.get("Basics.Easing")||r.set("Basics",o.BASICS),r.get("Xaxes")&&r.get("Xaxes.0.Format")||(r.set("Xaxes",[_.extend({},r.get("Xaxis"),{Position:{title:"Position",type:"string",enum:["Top","Bottom"],default:"Bottom"}})]),r.set("Yaxes",[_.extend({},r.get("Yaxis"),{Position:{title:"Position",type:"string",enum:["Left","Right"],default:"Left"}})]),r.set("Yaxes.0.Position","Left"),r.set("Xaxes.0.Position","Bottom"),r.unset("Xaxis"),r.unset("Yaxis"),_.each(r.get("Layers"),function(e,t){r.set("Layers."+t+".XAxisId","X-Axis 1"),r.set("Layers."+t+".YAxisId","Y-Axis 1"),r.set("Layers."+t+".possibleXAxes",["X-Axis 1"]),r.set("Layers."+t+".possibleYAxes",["Y-Axis 1"])}));'<table>{{#each this}}{{#eq @index 0}}<thead><tr><th>{{xAxis}}</th><th></th></tr></thead>{{/eq}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</table>'===r.get("Overlay.CustomTooltip")&&r.set("Overlay.CustomTooltip",'<table><thead><tr><th>{{this.0.0.xAxis}}</th><th></th></tr></thead>{{#each this}}{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}{{/each}}</table>'),r.get("Overlay.ShowAllPoints")||r.set("Overlay.ShowAllPoints",!1),r.get("Overlay.GroupByLayer")||r.set("Overlay.GroupByLayer",!1),_.each(r.get("Layers"),function(e,t){r.get("Layers."+t+".Enabled")||r.set("Layers."+t+".Enabled",!0),r.get("Layers."+t+".Opacity")||r.set("Layers."+t+".Opacity",80);var i="Layers."+t+".BarWidth",n="Layers."+t+".BarFixedWidth",t="Layers."+t+".BarWidthType";r.get(i)&&!r.get(n)&&(r.set(i,100*r.get(i)),r.set(t,"Percentage"),r.set(n,10))})}},{version:"4.6.0a",fn:function(n){_.each(n.get("Layers"),function(e,t){var i;void 0===n.get("Layers."+t+".ScaleOnZoom")&&(i=n.get("Layers."+t+".PointSize"),n.set("Layers."+t+".ScaleOnZoom",!0),n.set("Layers."+t+".RadiusData","Fixed Size"),n.set("Layers."+t+".RadiusScaling",i),n.unset("Layers."+t+".PointSize"))});'<table><thead><tr><th>{{this.0.0.xAxis}}</th><th></th></tr></thead>{{#each this}}{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}{{/each}}</table>'===n.get("Overlay.CustomTooltip")&&n.set("Overlay.CustomTooltip",o.CUSTOM_TOOLTIP_DEFAULT),n.get("Layers").forEach(function(e,t){"Line"===n.get("Layers."+t+"._Type")&&(n.get("Layers."+t+".Fill")||(n.set("Layers."+t+".Fill","No Fill"),n.set("Layers."+t+".FillColor","#0061FF"),n.set("Layers."+t+".FillOpacity",80)),"Line"===n.get("Layers."+t+"._Type")&&void 0===n.get("Layers."+t+".FadeToTransparent")&&n.set("Layers."+t+".FadeToTransparent",!1))})}},{version:"4.6.0b",fn:function(e){void 0===e.get("Overlay.ShowCoordinates")&&e.set("Overlay.ShowCoordinates",!0),void 0===e.get("Overlay.SnapToPoint")&&e.set("Overlay.SnapToPoint",!0)}},{version:"4.6.0c",fn:function(i){i.get("Layers").forEach(function(e,t){void 0===e.ColorData&&(i.set("Layers."+t+".possibleColorColumns",["None"]),i.set("Layers."+t+".ColorData","None")),void 0===e.Palette&&(e=i.get("Palette")||o.PALETTE_DEFAULT,i.set("Layers."+t+".Palette",e))}),i.get("Xaxes").forEach(function(e,t){void 0===e.Format.BeginAtZero&&i.set("Xaxes."+t+".Format.BeginAtZero",!1)}),i.get("Yaxes").forEach(function(e,t){void 0===e.Format.BeginAtZero&&i.set("Yaxes."+t+".Format.BeginAtZero",!1)})}},{version:"4.6.0d",fn:function(i){i.get("Layers").forEach(function(e,t){t="Layers."+t;void 0===e.Palette&&(e=i.get("Palette")||o.PALETTE_DEFAULT,i.set(t+".Palette",e)),"No Fill"===i.get(t+".Fill")&&(i.set(t+".FillColor",void 0),i.set(t+".Fade",void 0),i.set(t+".FillOpacity",void 0))})}},{version:"4.7.2",fn:function(i){i.get("Layers").forEach(function(e,t){t="Layers."+t;"Line"===e._Type&&void 0===i.get(t+".SpanGaps")&&i.set(t+".SpanGaps",!1),void 0===e.LegendGroup&&i.set(t+".LegendGroup","None")}),void 0===i.get("Legend")&&(i.set("Legend.LegendGroups",[]),i.set("Legend.Position","Top"))}},{version:"4.7.2",fn:function(e){_.isNil(e.get("FileExport"))&&e.set("FileExport",{FileName:[],ShowExportCsvButton:!1,ShowExportExcelButton:!1})}},{version:"4.7.3",fn:function(n){n.get("Layers").forEach(function(e,t){var i="Layers."+t;"Line"===e._Type&&void 0===n.get(i+".Line")&&(t=["Fill","FillColor","FillOpacity","FadeToTransparent","SpanGaps"],n.set(i+".Line"),n.set(i+".Line.FillPalette",o.PALETTE_DEFAULT),t.forEach(function(e){return n.set(i+".Line."+e,n.get(i+"."+e))}),t.forEach(function(e){return n.unset(i+"."+e)}))})}}],o);function o(){}s.app=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,n,r){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<canvas class="axis"></canvas>\n<canvas id='+e.escapeExpression("function"==typeof(i=null!=(i=o(i,"uid")||(null!=t?o(t,"uid"):t))?i:e.hooks.helperMissing)?i.call(null!=t?t:e.nullContext||{},{name:"uid",hash:{},data:r,loc:{start:{line:2,column:11},end:{line:2,column:18}}}):i)+'></canvas>\n<div class="export-div"></div>\n<div class="legend-div"></div>\n<svg class="overlay">\n    <defs>\n        <marker id="sArrow" markerWidth="9" markerHeight="6" orient="auto" refY="3" refX="0">\n            <path d="M7,0 L7,6 L0,3 z"></path>\n        </marker>\n        <marker id="eArrow" markerWidth="9" markerHeight="6" orient="auto" refY="3" refX="7">\n            <path d="M0,0 L0,6 L7,3 z"></path>\n        </marker>\n    </defs>\n</svg>\n<div class="GL-highlight-rule"></div>\n<img></img>'},useData:!0}),s.dualVertex=e.template({1:function(e,t,i,n,r){return"#version 300 es"},3:function(e,t,i,n,r,o,s){var a=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,h="function",u=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(e=c(i,"if").call(a,null!=s[1]?c(s[1],"isWebGL2"):s[1],{name:"if",hash:{},fn:e.program(4,r,0,o,s),inverse:e.program(6,r,0,o,s),data:r,loc:{start:{line:4,column:0},end:{line:4,column:45}}}))?e:"")+" "+u(typeof(o=null!=(o=c(i,"vt")||(null!=t?c(t,"vt"):t))?o:l)==h?o.call(a,{name:"vt",hash:{},data:r,loc:{start:{line:4,column:46},end:{line:4,column:52}}}):o)+" "+u(typeof(o=null!=(o=c(i,"name")||(null!=t?c(t,"name"):t))?o:l)==h?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:4,column:53},end:{line:4,column:61}}}):o)+"_position;\nuniform "+u(typeof(o=null!=(o=c(i,"ut")||(null!=t?c(t,"ut"):t))?o:l)==h?o.call(a,{name:"ut",hash:{},data:r,loc:{start:{line:5,column:8},end:{line:5,column:14}}}):o)+" "+u(typeof(o=null!=(o=c(i,"name")||(null!=t?c(t,"name"):t))?o:l)==h?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:5,column:15},end:{line:5,column:23}}}):o)+"_u_min;\nuniform "+u(typeof(o=null!=(o=c(i,"ut")||(null!=t?c(t,"ut"):t))?o:l)==h?o.call(a,{name:"ut",hash:{},data:r,loc:{start:{line:6,column:8},end:{line:6,column:14}}}):o)+" "+u(typeof(o=null!=(o=c(i,"name")||(null!=t?c(t,"name"):t))?o:l)==h?o.call(a,{name:"name",hash:{},data:r,loc:{start:{line:6,column:15},end:{line:6,column:23}}}):o)+"_u_max;\n"},4:function(e,t,i,n,r){return"in"},6:function(e,t,i,n,r){return"attribute"},8:function(e,t,i,n,r){var o,s=null!=t?t:e.nullContext||{},a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(o=a(i,"if").call(s,null!=t?a(t,"isWebGL2"):t,{name:"if",hash:{},fn:e.program(4,r,0),inverse:e.program(6,r,0),data:r,loc:{start:{line:10,column:0},end:{line:10,column:42}}}))?o:"")+" vec4 h_color;\n"+(null!=(o=a(i,"if").call(s,null!=t?a(t,"isWebGL2"):t,{name:"if",hash:{},fn:e.program(9,r,0),inverse:e.program(11,r,0),data:r,loc:{start:{line:11,column:0},end:{line:11,column:41}}}))?o:"")+" lowp vec4 v_color;\n"},9:function(e,t,i,n,r){return"out"},11:function(e,t,i,n,r){return"varying"},13:function(e,t,i,n,r){return"vec2 ds_sub (vec2 dsa, vec2 dsb) {\n    vec2 dsc;\n    float e, t1, t2;\n    t1 = dsa.x - dsb.x;\n    e = t1 - dsa.x;\n    t2 = ((-dsb.x - e) + (dsa.x - (t1 - e))) + dsa.y - dsb.y;\n    dsc.x = t1 + t2;\n    dsc.y = t2 - (dsc.x - t1);\n    return dsc;\n}\n\nvec2 ds_div(vec2 dsa, vec2 dsb)\n{\n    vec2 dsc;\n    float c11, c21, c2, e, s1, s2, t1, t2, t11, t12, t21, t22;\n    float a1, a2, b1, b2, cona, conb, split = 8193.;\n\n    // Compute a DP approximation to the quotient.\n    s1 = dsa.x / dsb.x;\n\n    // On systems with a fused multiply add, such as IBM systems, it is faster to\n    // uncomment the next two lines and comment out the following lines until !>.\n    // On other systems, do the opposite.\n    //  c11 = s1 * dsb(1)\n    // c21 = s1 * dsb(1) - c11\n    cona = s1 * split;\n    conb = dsb.x * split;\n    a1 = cona - (cona - s1);\n    b1 = conb - (conb - dsb.x);\n    a2 = s1 - a1;\n    b2 = dsb.x - b1;\n\n    // Multiply s1 * dsb.x using Dekker's method.\n    c11 = s1 * dsb.x;\n    c21 = (((a1 * b1 - c11) + a1 * b2) + a2 * b1) + a2 * b2;\n\n    // Compute s1 * dsb.y (only high-order word is needed).\n    c2 = s1 * dsb.y;\n    \n    // Compute (c11, c21) + c2 using Knuth's trick.\n    t1 = c11 + c2;\n    e = t1 - c11;\n    t2 = ((c2 - e) + (c11 - (t1 - e))) + c21;\n\n    // The result is t1 + t2, after normalization.\n    t12 = t1 + t2;\n    t22 = t2 - (t12 - t1);\n\n    // Compute dsa - (t12, t22) using Knuth's trick.\n    t11 = dsa.x - t12;\n    e = t11 - dsa.x;\n    t21 = ((-t12 - e) + (dsa.x - (t11 - e))) + dsa.y - t22;\n\n    // Compute high-order word of (t11, t21) and divide by dsb(1).\n    s2 = (t11 + t21) / dsb.x;\n    \n    // The result is s1 + s2, after normalization.\n    dsc.x = s1 + s2;\n    dsc.y = s2 - (dsc.x - s1);\n\n    return dsc;\n}\n"},15:function(e,t,i,n,r){var o,s=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(o=(l(i,"eq")||t&&l(t,"eq")||a).call(s,null!=t?l(t,"vt"):t,"uint",{name:"eq",hash:{},fn:e.program(16,r,0),inverse:e.noop,data:r,loc:{start:{line:85,column:4},end:{line:89,column:11}}}))?o:"")+(null!=(o=(l(i,"eq")||t&&l(t,"eq")||a).call(s,null!=t?l(t,"vt"):t,"int",{name:"eq",hash:{},fn:e.program(18,r,0),inverse:e.noop,data:r,loc:{start:{line:90,column:4},end:{line:94,column:11}}}))?o:"")+(null!=(o=(l(i,"eq")||t&&l(t,"eq")||a).call(s,null!=t?l(t,"vt"):t,"float",{name:"eq",hash:{},fn:e.program(20,r,0),inverse:e.noop,data:r,loc:{start:{line:95,column:4},end:{line:98,column:11}}}))?o:"")+(null!=(o=(l(i,"eq")||t&&l(t,"eq")||a).call(s,null!=t?l(t,"vt"):t,"vec2",{name:"eq",hash:{},fn:e.program(22,r,0),inverse:e.noop,data:r,loc:{start:{line:99,column:4},end:{line:104,column:11}}}))?o:"")},16:function(e,t,i,n,r){var o,s=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,l="function",h=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"    float "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:86,column:10},end:{line:86,column:18}}}):o)+"_u_range = float(int("+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:86,column:39},end:{line:86,column:47}}}):o)+"_u_max) - int("+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:86,column:61},end:{line:86,column:69}}}):o)+"_u_min));\n    float "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:87,column:10},end:{line:87,column:18}}}):o)+"a = float(int("+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:87,column:32},end:{line:87,column:40}}}):o)+"_position) - "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:87,column:53},end:{line:87,column:61}}}):o)+"_u_min);\n    zeroToOne."+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:88,column:14},end:{line:88,column:22}}}):o)+" = "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:88,column:25},end:{line:88,column:33}}}):o)+"a / "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:88,column:37},end:{line:88,column:45}}}):o)+"_u_range;\n"},18:function(e,t,i,n,r){var o,s=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,l="function",h=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"    float "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:91,column:10},end:{line:91,column:18}}}):o)+"_u_range = float(int("+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:91,column:39},end:{line:91,column:47}}}):o)+"_u_max) - int("+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:91,column:61},end:{line:91,column:69}}}):o)+"_u_min));\n    float "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:92,column:10},end:{line:92,column:18}}}):o)+"a = float("+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:92,column:28},end:{line:92,column:36}}}):o)+"_position - "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:92,column:48},end:{line:92,column:56}}}):o)+"_u_min);\n    zeroToOne."+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:93,column:14},end:{line:93,column:22}}}):o)+" = "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:93,column:25},end:{line:93,column:33}}}):o)+"a / "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:93,column:37},end:{line:93,column:45}}}):o)+"_u_range;\n"},20:function(e,t,i,n,r){var o,s=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,l="function",h=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"    float "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:96,column:10},end:{line:96,column:18}}}):o)+"_u_range = float("+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:96,column:35},end:{line:96,column:43}}}):o)+"_u_max - "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:96,column:52},end:{line:96,column:60}}}):o)+"_u_min);\n    zeroToOne."+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:97,column:14},end:{line:97,column:22}}}):o)+" = ("+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:97,column:26},end:{line:97,column:34}}}):o)+"_position - "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:97,column:46},end:{line:97,column:54}}}):o)+"_u_min) / "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:97,column:64},end:{line:97,column:72}}}):o)+"_u_range;\n"},22:function(e,t,i,n,r){var o,s=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,l="function",h=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"    vec2 "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:100,column:9},end:{line:100,column:17}}}):o)+"_u_range = ds_sub("+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:100,column:35},end:{line:100,column:43}}}):o)+"_u_max, "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:100,column:51},end:{line:100,column:59}}}):o)+"_u_min);  \n    vec2 "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:101,column:9},end:{line:101,column:17}}}):o)+"_position2 = ds_sub("+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:101,column:37},end:{line:101,column:45}}}):o)+"_position, "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:101,column:56},end:{line:101,column:64}}}):o)+"_u_min);             \n    vec2 "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:102,column:9},end:{line:102,column:17}}}):o)+"_zeroToOne = ds_div("+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:102,column:37},end:{line:102,column:45}}}):o)+"_position2,"+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:102,column:56},end:{line:102,column:64}}}):o)+"_u_range);\n    zeroToOne."+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:103,column:14},end:{line:103,column:22}}}):o)+" = "+h(typeof(o=null!=(o=e(i,"name")||(null!=t?e(t,"name"):t))?o:a)==l?o.call(s,{name:"name",hash:{},data:r,loc:{start:{line:103,column:25},end:{line:103,column:33}}}):o)+"_zeroToOne.x;\n"},24:function(e,t,i,n,r){return"    gl_PointSize = pointSize;\n    "},26:function(e,t,i,n,r){return" gl_PointSize = u_point_size;\n"},28:function(e,t,i,n,r){return"    v_color = h_color;\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,n,r,o,s){var a,l=null!=t?t:e.nullContext||{},h=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(a=h(i,"if").call(l,null!=t?h(t,"isWebGL2"):t,{name:"if",hash:{},fn:e.program(1,r,0,o,s),inverse:e.noop,data:r,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?a:"")+"\n\n"+(null!=(a=h(i,"each").call(l,null!=t?h(t,"axis"):t,{name:"each",hash:{},fn:e.program(3,r,0,o,s),inverse:e.noop,data:r,loc:{start:{line:3,column:0},end:{line:7,column:9}}}))?a:"")+"\n"+(null!=(a=h(i,"if").call(l,null!=t?h(t,"isColored"):t,{name:"if",hash:{},fn:e.program(8,r,0,o,s),inverse:e.noop,data:r,loc:{start:{line:9,column:0},end:{line:12,column:7}}}))?a:"")+"\nuniform float u_point_size;\n"+(null!=(a=h(i,"if").call(l,null!=t?h(t,"isWebGL2"):t,{name:"if",hash:{},fn:e.program(4,r,0,o,s),inverse:e.program(6,r,0,o,s),data:r,loc:{start:{line:15,column:0},end:{line:15,column:42}}}))?a:"")+" float pointSize;\n\n"+(null!=(a=h(i,"if").call(l,null!=t?h(t,"math"):t,{name:"if",hash:{},fn:e.program(13,r,0,o,s),inverse:e.noop,data:r,loc:{start:{line:17,column:0},end:{line:80,column:7}}}))?a:"")+"\nvoid main() {\n    vec2 zeroToOne;\n"+(null!=(a=h(i,"each").call(l,null!=t?h(t,"axis"):t,{name:"each",hash:{},fn:e.program(15,r,0,o,s),inverse:e.noop,data:r,loc:{start:{line:84,column:4},end:{line:105,column:13}}}))?a:"")+"\n    // 32-bit below here                \n    // convert from 0->1 to 0->2\n    vec2 zeroToTwo = zeroToOne * 2.0;\n\n    // convert from 0->2 to -1->+1 (clip space)\n    vec2 clipSpace = zeroToTwo - 1.0;\n\n    gl_Position = vec4(clipSpace, 0, 1);\n\n"+(null!=(a=h(i,"if").call(l,null!=t?h(t,"isSize"):t,{name:"if",hash:{},fn:e.program(24,r,0,o,s),inverse:e.program(26,r,0,o,s),data:r,loc:{start:{line:116,column:4},end:{line:119,column:11}}}))?a:"")+"\n"+(null!=(a=h(i,"if").call(l,null!=t?h(t,"isColored"):t,{name:"if",hash:{},fn:e.program(28,r,0,o,s),inverse:e.noop,data:r,loc:{start:{line:121,column:4},end:{line:123,column:11}}}))?a:"")+"}\n"},useData:!0,useDepths:!0}),s.fileExporter=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,n,r){var o=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,a=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="chartGLExportButtons">\n    <span class="lnksExport link-disabled">\n        <i class="fa fa-fw fa-download" title="'+a((e(i,"t")||t&&e(t,"t")||s).call(o,"Data",{name:"t",hash:{},data:r,loc:{start:{line:3,column:47},end:{line:3,column:59}}}))+'"></i>\n        <a class="lnkExcelExport" title="'+a((e(i,"t")||t&&e(t,"t")||s).call(o,"Download the current dataset in Excel format",{name:"t",hash:{},data:r,loc:{start:{line:4,column:41},end:{line:4,column:93}}}))+'">'+a((e(i,"t")||t&&e(t,"t")||s).call(o,"Excel",{name:"t",hash:{},data:r,loc:{start:{line:4,column:95},end:{line:4,column:108}}}))+'</a>\n        <a class="lnkCsvExport" title="'+a((e(i,"t")||t&&e(t,"t")||s).call(o,"Download the current dataset in CSV format",{name:"t",hash:{},data:r,loc:{start:{line:5,column:39},end:{line:5,column:89}}}))+'">'+a((e(i,"t")||t&&e(t,"t")||s).call(o,"CSV",{name:"t",hash:{},data:r,loc:{start:{line:5,column:91},end:{line:5,column:102}}}))+"</a>\n    </span> \n</div> \n"},useData:!0}),s.fragment=e.template({1:function(e,t,i,n,r){return"#version 300 es"},3:function(e,t,i,n,r){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(i=o(i,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"isWebGL2"):t,{name:"if",hash:{},fn:e.program(4,r,0),inverse:e.program(6,r,0),data:r,loc:{start:{line:9,column:0},end:{line:9,column:40}}}))?i:"")+" vec4 v_color;\n"},4:function(e,t,i,n,r){return"in"},6:function(e,t,i,n,r){return"varying"},8:function(e,t,i,n,r){return"uniform vec4 a_color; \n"},10:function(e,t,i,n,r){return"out vec4 outColor;\n"},12:function(e,t,i,n,r){return"uniform sampler2D spriteTexture;\n"},14:function(e,t,i,n,r){return"outColor"},16:function(e,t,i,n,r){return"gl_FragColor"},18:function(e,t,i,n,r){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"texture"+(null!=(i=o(i,"unless").call(null!=t?t:e.nullContext||{},null!=t?o(t,"isWebGL2"):t,{name:"unless",hash:{},fn:e.program(19,r,0),inverse:e.noop,data:r,loc:{start:{line:22,column:83},end:{line:22,column:116}}}))?i:"")+"(spriteTexture, gl_PointCoord) * "},19:function(e,t,i,n,r){return"2D"},21:function(e,t,i,n,r){return"v_color"},23:function(e,t,i,n,r){return"a_color"},compiler:[8,">= 4.3.0"],main:function(e,t,i,n,r){var o,s=null!=t?t:e.nullContext||{},a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(o=a(i,"if").call(s,null!=t?a(t,"isWebGL2"):t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?o:"")+"\n\n// fragment shaders don't have a default precision so we need\n// to pick one. mediump is a good default\n\nprecision mediump float;\n\n"+(null!=(o=a(i,"if").call(s,null!=t?a(t,"isColored"):t,{name:"if",hash:{},fn:e.program(3,r,0),inverse:e.program(8,r,0),data:r,loc:{start:{line:8,column:0},end:{line:12,column:7}}}))?o:"")+"\n"+(null!=(o=a(i,"if").call(s,null!=t?a(t,"isWebGL2"):t,{name:"if",hash:{},fn:e.program(10,r,0),inverse:e.noop,data:r,loc:{start:{line:14,column:0},end:{line:16,column:7}}}))?o:"")+"\n"+(null!=(o=a(i,"if").call(s,null!=t?a(t,"isTextured"):t,{name:"if",hash:{},fn:e.program(12,r,0),inverse:e.noop,data:r,loc:{start:{line:18,column:0},end:{line:19,column:7}}}))?o:"")+"\nvoid main() {\n    "+(null!=(o=a(i,"if").call(s,null!=t?a(t,"isWebGL2"):t,{name:"if",hash:{},fn:e.program(14,r,0),inverse:e.program(16,r,0),data:r,loc:{start:{line:22,column:4},end:{line:22,column:55}}}))?o:"")+" = "+(null!=(o=a(i,"if").call(s,null!=t?a(t,"isTextured"):t,{name:"if",hash:{},fn:e.program(18,r,0),inverse:e.noop,data:r,loc:{start:{line:22,column:58},end:{line:22,column:156}}}))?o:"")+(null!=(o=a(i,"if").call(s,null!=t?a(t,"isColored"):t,{name:"if",hash:{},fn:e.program(21,r,0),inverse:e.program(23,r,0),data:r,loc:{start:{line:22,column:156},end:{line:22,column:202}}}))?o:"")+";\n}\n"},useData:!0}),s.highlightRule=e.template({1:function(e,t,i,n,r){var o,s=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,l="function",h=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <li><svg style="background:'+h(typeof(o=null!=(o=e(i,"ruleColor")||(null!=t?e(t,"ruleColor"):t))?o:a)==l?o.call(s,{name:"ruleColor",hash:{},data:r,loc:{start:{line:3,column:31},end:{line:3,column:44}}}):o)+'; margin-right:4px;" width="15" height="16"></svg>\n    <span style="color:'+h(typeof(o=null!=(o=e(i,"color")||(null!=t?e(t,"color"):t))?o:a)==l?o.call(s,{name:"color",hash:{},data:r,loc:{start:{line:4,column:23},end:{line:4,column:32}}}):o)+'">'+h(typeof(o=null!=(o=e(i,"ruleName")||(null!=t?e(t,"ruleName"):t))?o:a)==l?o.call(s,{name:"ruleName",hash:{},data:r,loc:{start:{line:4,column:34},end:{line:4,column:46}}}):o)+"</span></li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,n,r){return'<ul class="chartgl-highlight-rule">\n'+(null!=(i=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(i,"each").call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:2,column:0},end:{line:5,column:9}}}))?i:"")+"</ul>"},useData:!0}),s.legend=e.template({1:function(e,t,i,n,r){var o=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,a="function",l=e.escapeExpression,h=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"    <li>"+(null!=(e=h(i,"if").call(o,null!=t?h(t,"icon"):t,{name:"if",hash:{},fn:e.program(2,r,0),inverse:e.program(4,r,0),data:r,loc:{start:{line:3,column:8},end:{line:16,column:17}}}))?e:"")+'      <span style="color:'+l(typeof(e=null!=(e=h(i,"fontColor")||(null!=t?h(t,"fontColor"):t))?e:s)==a?e.call(o,{name:"fontColor",hash:{},data:r,loc:{start:{line:17,column:25},end:{line:17,column:38}}}):e)+"; text-decoration:"+l(typeof(e=null!=(e=h(i,"strike")||(null!=t?h(t,"strike"):t))?e:s)==a?e.call(o,{name:"strike",hash:{},data:r,loc:{start:{line:17,column:56},end:{line:17,column:66}}}):e)+'">'+l(typeof(e=null!=(e=h(i,"text")||(null!=t?h(t,"text"):t))?e:s)==a?e.call(o,{name:"text",hash:{},data:r,loc:{start:{line:17,column:68},end:{line:17,column:76}}}):e)+"</span>\n    </li>\n"},2:function(e,t,i,n,r){var o,s=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,l="function",h=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\n            <svg width="'+h(typeof(o=null!=(o=e(i,"width")||(null!=t?e(t,"width"):t))?o:a)==l?o.call(s,{name:"width",hash:{},data:r,loc:{start:{line:4,column:24},end:{line:4,column:33}}}):o)+'" height="'+h(typeof(o=null!=(o=e(i,"width")||(null!=t?e(t,"width"):t))?o:a)==l?o.call(s,{name:"width",hash:{},data:r,loc:{start:{line:4,column:43},end:{line:4,column:52}}}):o)+'" style="padding:2px">\n              <i style="height:'+h(typeof(o=null!=(o=e(i,"width")||(null!=t?e(t,"width"):t))?o:a)==l?o.call(s,{name:"width",hash:{},data:r,loc:{start:{line:5,column:31},end:{line:5,column:40}}}):o)+"px;color:"+h(typeof(o=null!=(o=e(i,"fillStyle")||(null!=t?e(t,"fillStyle"):t))?o:a)==l?o.call(s,{name:"fillStyle",hash:{},data:r,loc:{start:{line:5,column:49},end:{line:5,column:62}}}):o)+";margin-top:2.5px;margin-right:5px;"+h(typeof(o=null!=(o=e(i,"image")||(null!=t?e(t,"image"):t))?o:a)==l?o.call(s,{name:"image",hash:{},data:r,loc:{start:{line:5,column:97},end:{line:5,column:106}}}):o)+'"class="fa '+h(typeof(o=null!=(o=e(i,"icon")||(null!=t?e(t,"icon"):t))?o:a)==l?o.call(s,{name:"icon",hash:{},data:r,loc:{start:{line:5,column:117},end:{line:5,column:125}}}):o)+'"></i>\n            </svg>\n'},4:function(e,t,i,n,r){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <svg width="10" height="10"  style="margin-left:14.5px;margin-right:2.8px;margin-top: 2px;padding:2px">\n'+(null!=(i=o(i,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"bullColor"):t,{name:"if",hash:{},fn:e.program(5,r,0),inverse:e.program(7,r,0),data:r,loc:{start:{line:9,column:10},end:{line:14,column:17}}}))?i:"")+"              </svg>\n"},5:function(e,t,i,n,r){var o,s=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,l="function",h=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <rect height="10" width="1.5" x="6.8" fill="'+h(typeof(o=null!=(o=e(i,"fillStyle")||(null!=t?e(t,"fillStyle"):t))?o:a)==l?o.call(s,{name:"fillStyle",hash:{},data:r,loc:{start:{line:10,column:60},end:{line:10,column:73}}}):o)+'"></rect>\n                <rect height="5" width="5" x="5" y="2.5" fill="'+h(typeof(o=null!=(o=e(i,"bullColor")||(null!=t?e(t,"bullColor"):t))?o:a)==l?o.call(s,{name:"bullColor",hash:{},data:r,loc:{start:{line:11,column:63},end:{line:11,column:76}}}):o)+'"></rect>\n'},7:function(e,t,i,n,r){var o,s=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,l="function",h=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <rect height="'+h(typeof(o=null!=(o=e(i,"width")||(null!=t?e(t,"width"):t))?o:a)==l?o.call(s,{name:"width",hash:{},data:r,loc:{start:{line:13,column:30},end:{line:13,column:39}}}):o)+'" width="'+h(typeof(o=null!=(o=e(i,"width")||(null!=t?e(t,"width"):t))?o:a)==l?o.call(s,{name:"width",hash:{},data:r,loc:{start:{line:13,column:48},end:{line:13,column:57}}}):o)+'" fill="'+h(typeof(o=null!=(o=e(i,"fillStyle")||(null!=t?e(t,"fillStyle"):t))?o:a)==l?o.call(s,{name:"fillStyle",hash:{},data:r,loc:{start:{line:13,column:65},end:{line:13,column:78}}}):o)+'"></rect>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,i,n,r){return'<ul class="chartgl-legend">\n'+(null!=(i=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(i,"each").call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:2,column:2},end:{line:19,column:11}}}))?i:"")+"</ul>"},useData:!0});var y=s;function s(){}W.prototype.getBarWidth=function(){return this.barWidth},W.prototype.getXBarPoints=function(i,e,t,n){var r,o,s=this,a=e.barGrouping,l=e.barWidth,h=e.chartWidth,u=null==a?void 0:a.barIndices,c=e.barType,e=N.getMidrange(new w(t.x,t.z),this.tx),e=(e&&(t=new I(Number(N.toBigInt(t.x)-e),t.y,Number(N.toBigInt(t.z)-e),t.w)),Math.abs(Number(t.z)-Number(t.x))),p=(e||(r=.1*Number(t.x),o=Number(t.x)-r,e=Number(t.z)+r-o),(null==u?void 0:u.length)||0),t=l/h,d=[],y=0,g=0,f=0,f=a&&u?(g=u.indexOf(a.index)+(n||0),y=e/a.dataLength/p,"Percentage"===c?y*l/2:e*t):(o=(r=i.slice(1).map(function(e,t){return e-i[t]})).length?0:.01*e,h=r.length?N.getDistance(r,i):o,e=e?Math.abs(e+o+o):10,"Percentage"===c?h/2*l:e*t);return _.each(i,function(e,t){var i,n=e-f,r=e+f;a&&(n=(e=e-p*(i=.85*("Percentage"===c?y:2*f))/2+i*(g+.5))-.85*f,r=e+.85*f),0===Number(t)&&(i=N.convertJSToNumber(N.convertToJsScalar(s.tx,n)),e=N.convertJSToNumber(N.convertToJsScalar(s.tx,r)),s.barWidth=Math.abs(i-e)),d.push(n,n,r,n,r,r)}),d},W.prototype.getYBarPoints=function(e){var t=[];return _.each(e,function(e){return t.push(0,e,0,e,0,e)}),t},W.prototype.getCandlesticks=function(r,o,s){var a=[],l=[];return r[0].forEach(function(e,t){var i,t=r[1][t],n=e===t&&s;n&&(e+=.002*o,t-=.002*o),a.push(e,t,e,t,e,t),s&&(i=Number(s[4]),n=n?s[2]:e<t?s[1]:s[0],e=_e.hexColorToVec4(n,i),l.push(Object.values(e)))}),[a,l]};var H=W;function W(e,t){this.tx=e,this.tys=t,this.barWidth=0}Z.spanGaps=function(o,s){for(var a,e,l,h=[],u=[],c=o.nullVal,p=s.nullVal,t=(o.col.calcRange&&o.col.qtype&&(o.col=o.col,e=o.col.calcRange(),a=N.getMidrange(new w(e[0],e[1]),o.col.qtype)),s.col.calcRange&&s.col.qtype&&(s.col=s.col,e=s.col.calcRange(),l=N.getMidrange(new w(e[0],e[1]),s.col.qtype)),_.each(s.col,function(e,t){var i=s.scalar,n=o.scalar,i=i(s.col,t),n=n(o.col,t),t=Number(l?i-l:i),r=Number(a?n-a:n);N.isNull(i,p)||N.isNull(n,c)||(h.push(t),u.push(r))}),u[u.length-1]),i=h[h.length-1],n=u.length;n<o.col.length;n++)u.push(t),h.push(i);return{x:u,y:h}},Z.prototype.getXLineFill=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],r=e[i+1];t.push(n,n,r,n,r,r)}return t},Z.prototype.getYLineFill=function(e,t){var i=[],n=t.fromBounds?Number(t.fromBounds.y):0,r=t.fromBounds?Number(t.fromBounds.w):0,o=t.toBounds?Number(t.toBounds.y):0,s=t.toBounds?Number(t.toBounds.w):0,a=_.min(e)||0,l=_.max(e)||0,h=n;a<0&&0<l||a<0&&l<0&&0<r?h=0:a<0&&l<0&&(h=r);for(var u=0;u<e.length;u++){var c=h,p=h,d=("Origin"!==t.fill&&(c=(y=t.cols[0])[u],p=y[u+1],y=new w(o,s),d=new w(n,r),_.isEqual(y,d)||(c=(r-n)*((c-o)/(y=s-o))+n,p=(r-n)*((p-o)/y)+n)),e[u]),y=e[u+1];i.push(d,c,p,d,p,y)}return i};var V=Z;function Z(){}function U(e,t,i){if(!(e=e.getUniformLocation(t,i)))throw new Error(i+" failed getUniformLocation");this.location=e}i(J,j=U),J.prototype.set=function(e,t){e.uniform1f(this.location,t)};var j,q=J;function J(){return null!==j&&j.apply(this,arguments)||this}i(ee,K=U),ee.prototype.set=function(e,t){e.uniform4f(this.location,t.x,t.y,t.z,t.w)};var K,Q=ee;function ee(){return null!==K&&K.apply(this,arguments)||this}te.MIN_KEY="_u_min",te.MAX_KEY="_u_max";n=te;function te(e,t,i){var n=e.getUniformLocation(t,i+te.MIN_KEY),e=e.getUniformLocation(t,i+te.MAX_KEY);if(!n||!e)throw new Error(i+" axis failed getUniformLocation");this.min=n,this.max=e}i(re,ie=n),re.prototype.set=function(e,t){e.uniform1i(this.min,t.x),e.uniform1i(this.max,t.y)};var ie,ne=re;function re(){return null!==ie&&ie.apply(this,arguments)||this}i(ae,oe=n),ae.prototype.set=function(e,t){e.uniform1f(this.min,t.x),e.uniform1f(this.max,t.y)};var oe,se=ae;function ae(){return null!==oe&&oe.apply(this,arguments)||this}i(ue,le=n),ue.prototype.set=function(e,t){e.uniform2f(this.min,t.x,t.x-Math.fround(t.x)),e.uniform2f(this.max,t.y,t.y-Math.fround(t.y))};var le,he=ue;function ue(){return null!==le&&le.apply(this,arguments)||this}ce.prototype.apply=function(e,t){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(this.location),this.glType===WebGLRenderingContext.FLOAT?e.vertexAttribPointer(this.location,this.size,this.glType,!1,this.stride||0,this.offset||0):e.vertexAttribIPointer(this.location,this.size,this.glType,this.stride||0,this.offset||0)};var h=ce;function ce(e,t,i,n,r){this.location=e,this.glType=t,this.size=i,this.stride=n,this.offset=r}Object.defineProperty(u.prototype,"Program",{get:function(){return this.program},enumerable:!1,configurable:!0}),u.createBuffer=function(e,t){var i=e.createBuffer();if(i)return e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),i;throw new Error("gl error creating buffer")},u.createTexture=function(e,t,i){var n=e.createTexture();if(n)return e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D),n;throw new Error("gl error creating texture")},u.getShader=function(e,t,i,n,r,o,s){var a=[i,n,r,o,s,e.canvas.id].join(":");return u.shaders[a]||(u.shaders[a]=new u(e,i,n,t,r,o,s)),this.shaders[a]},u.composeFragment=function(e,t,i,n){return y.fragment({isWebGL2:e,isTextured:t,isColored:i,isSize:n})},u.composeVertex=function(e,t,i,n,r){e={x:e,y:t};return y.dualVertex({isWebGL2:i,isColored:n,isSize:r,math:_.some(_.values(e),function(e){return N.isLong(e)||N.isDouble(e)}),axis:_.map(e,function(e,t){return _.extend(u.getShaderConfig(e),{name:t})})})},u.createProgram=function(e,t,i){var n=e.createProgram();if(!n)throw new Error("gl error creating program");if(e.attachShader(n,t),e.attachShader(n,i),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS))return n;throw t=e.getProgramInfoLog(n),e.deleteProgram(n),new Error("gl error linking program: "+t)},u.createShader=function(e,t,i){t=e.createShader(t);if(!t)throw new Error("gl error creating shader");if(e.shaderSource(t,i),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS))return t;throw i=e.getShaderInfoLog(t),e.deleteShader(t),new Error("gl error compiling shader: "+i)},u.getShaderConfig=function(e){switch(e){case D.Byte:case D.Char:return{vt:"uint",ut:"int"};case D.Short:case D.Int:case D.Month:case D.Date:case D.Minute:case D.Second:case D.Time:return{vt:"int",ut:"int"};case D.List:case D.Symbol:case D.Float:return{vt:"float",ut:"float"};case D.Long:case D.Double:case D.Timestamp:case D.DateTime:case D.Timespan:return{vt:"vec2",ut:"vec2"};default:throw"Not implemented"}},u.prototype.remove=function(e){e.deleteProgram(this.program),e.deleteShader(this.vertexShader),e.deleteShader(this.fragmentShader)},u.prototype.setTexture=function(e,t){e.uniform1i(this.textureLocation,t)},u.prototype.createRange=function(e,t,i){return new(N.isDouble(e)||N.isLong(e)?he:N.isFloat(e)?se:ne)(t,this.program,i)},u.prototype.getVertexBinding=function(e,t,i){var n=e.getAttribLocation(this.Program,i+"_position");switch(t){case D.Byte:case D.Char:return new h(n,e.UNSIGNED_BYTE,1);case D.Short:return new h(n,e.SHORT,1);case D.Int:case D.Month:case D.Date:case D.Minute:case D.Second:case D.Time:return new h(n,e.INT,1);case D.List:case D.Symbol:case D.Float:return new h(n,e.FLOAT,1);case D.Long:case D.Double:case D.Timestamp:case D.DateTime:case D.Timespan:return new h(n,e.FLOAT,2);default:throw"Not implemented"}},u.shaders={};var pe,A=u;function u(e,t,i,n,r,o,s){this.textureLocation=null;var a,l=u.composeVertex(t,i,n,o,s),n=u.composeFragment(n,r,o,s);this.vertexShader=u.createShader(e,e.VERTEX_SHADER,l),this.fragmentShader=u.createShader(e,e.FRAGMENT_SHADER,n),this.program=u.createProgram(e,this.vertexShader,this.fragmentShader),this.xRange=this.createRange(t,e,"x"),this.yRange=this.createRange(i,e,"y"),this.xBinding=this.getVertexBinding(e,t,"x"),this.yBinding=this.getVertexBinding(e,i,"y"),r&&(this.textureLocation=e.getUniformLocation(this.Program,"spriteTexture")),o?(a=e.getAttribLocation(this.Program,"h_color"),this.colorLocation=new h(a,e.FLOAT,4)):this.color=new Q(e,this.Program,"a_color"),s?(a=e.getAttribLocation(this.Program,"pointSize"),this.sizeLocation=new h(a,e.FLOAT,1)):this.pointSize=new q(e,this.Program,"u_point_size")}Math.fround=Math.fround||(pe=new Float32Array(1),function(e){return pe[0]=e,pe[0]});de.prototype.applyFn=function(e){return new de(e(this.x),e(this.y))};var w=de;function de(e,t){this.x=e,this.y=t}a.fromVec2=function(e,t){return new a(e.x,t.x,e.y,t.y)},a.prototype.toString=function(){return _.map([this.x,this.y,this.z,this.w],function(e){return""+e}).join(",")},a.prototype.applyFn=function(e){return new a(e(this.x),e(this.y),e(this.z),e(this.w))};var I=a;function a(e,t,i,n){this.x=e,this.y=t,this.z=i,this.w=n}var f,D=E.ipc.TypeNum,N=(c.calculateCroppedBounds=function(e,t,i,n){function r(e,t,i){return t+(i-t)*e}function o(e){return new w(Math.floor(e.x),Math.ceil(e.y))}var s=new w(r(e.x,t.x,t.z),r(e.z,t.x,t.z)),e=new w(r(e.y,t.y,t.w),r(e.w,t.y,t.w));return i&&(c.isInt(i)||c.isLong(i))&&(s=o(s)),n&&(c.isInt(n)||c.isLong(n))&&(e=o(e)),new I(s.x,e.x,s.y,e.y)},c.calculateCroppedJsBounds=function(e,t,i,n){var r=c.scaleJs(e.x,t.x,t.z),o=c.scaleJs(e.z,t.x,t.z),s=c.scaleJs(e.y,t.y,t.w),e=c.scaleJs(e.w,t.y,t.w),t=c.calculatePrecision(i,new w(r,o)),i=c.calculatePrecision(n,new w(s,e));return new I(t.x,i.x,t.y,i.y)},c.calculatePrecision=function(t,e){var i;return t&&(c.isInt(t)||t===D.Long||t===D.Timespan)&&(i=e.applyFn(function(e){return c.convertJSToScalar(t,e)}),i=i,i=new w(Math.floor(Number(i.x)),Math.ceil(Number(i.y))),e=new w(c.convertToJsScalar(t,i.x),c.convertToJsScalar(t,i.y))),e},c.calculateCroppedJs2=function(e,t,i){var n=c.scaleJs(e.x,t.x,t.y),e=c.scaleJs(e.y,t.x,t.y),t=new w(n,e);return i?c.calculatePrecision(i,t):t},c.calculateCrop=function(e,t){e=new w(c.calcCrop(e.x,t.x,t.y),c.calcCrop(e.y,t.x,t.y));return new w(isNaN(e.x)?0:e.x,isNaN(e.y)?1:e.y)},c.calcCrop=function(e,t,i){return e=c.convertJSToNumber(e),t=c.convertJSToNumber(t),1-(e-(i=c.convertJSToNumber(i)))/(t-i)},c.calculateBoundsDiagonal=function(e){var t=e.z-e.x,e=e.w-e.y;return Math.sqrt(t*t+e*e)},c.calculateInset=function(e,t){var i=e.z-e.x,n=e.w-e.y,r=2*t;return new I(r<=n?e.x+t:e.x,r<=i?e.y+t:e.y,r<=n?e.z-t:e.z,r<=i?e.w-t:e.w)},c.calculateMergedRange=function(e){if(0===e.length)return null;if(1===e.length)return e[0];for(var t=e[0].x,i=e[0].y,n=1;n<e.length;n++)var r=e[n],t=c.min(t,r.x),i=c.max(i,r.y);return new w(t,i)},c.getCategoryData=function(e){for(var t=e.length,i=new Float32Array(t),n=[],r=[],o=0;o<t;o++){var s=this.getColValue(e,o);r[o]=s}var a={},l=_.uniq(r);l.forEach(function(e,t){a[e]=1<l.length?t/l.length:.5});for(o=0;o<t;o++){var s=this.getColValue(e,o),h=a[s];i[o]=h,n[o]=c.isString(e.qtype)||e.qtype===D.Char?s:c.convertToJsScalar(e.qtype,s)}return[n,i]},c.getColValue=function(e,t){return void 0!==t||e.qtype!==D.List&&e.qtype!==D.Symbol?e.qtype===D.List?(i=e.getValue(t),c.getValueFromObject(i)):e.qtype===D.Symbol||e.qtype===D.Char?e.getValue(t):e.getScalar(t):null;var i},c.convertStringToScalar=function(e,t){var i;return isNaN(Number(e))?t?(i=t.fromString(e),t.toScalar(i)):e:Number(e)},c.convertJSToNumber=function(e){return v.isMoment(e)||v.isDuration(e)?e.valueOfNano()/1e6:e},c.convertJSToScalar=function(e,t){var i,n=E.ipc;(i={})[D.Date]=n.QDate,i[D.DateTime]=n.DateTime,i[D.Minute]=n.Minute,i[D.Month]=n.Month,i[D.Second]=n.Second,i[D.Time]=n.Time,i[D.Timespan]=n.Timespan,i[D.Timestamp]=n.Timestamp;n=i[e];if(n)return n.toScalar(n.fromMoment(t));if(v.isMoment(t)||v.isDuration(t))throw"Invalid Type Conversion";return t},c.convertStringToJsScalar=function(e,t){e=c.convertStringToScalar(e,c.ipcTemp(t));return c.convertToJsScalar(t,e)},c.convertToJsScalar=function(e,t,i){var n=E.ipc;(r={})[D.Date]=n.QDate,r[D.DateTime]=n.DateTime,r[D.Minute]=n.Minute,r[D.Month]=n.Month,r[D.Second]=n.Second,r[D.Time]=n.Time,r[D.Timespan]=n.Timespan,r[D.Timestamp]=n.Timestamp;var r,n=r[e];return n?(e===D.Timespan&&(t=Number(t)),r=c.isLong(e)&&E.Long.isLong(t)?E.Long.fromString(t.toString()):t,i?n.fromScalar(r):E.Tools.convertKDBTemporalToMoment(n.fromScalar(r))):Number(t)},c.convertVec2ToJsScalar=function(e,t,i){return new w(c.convertToJsScalar(t,e.x),c.convertToJsScalar(i,e.y))},c.convertVec4ToJsScalar=function(e,t,i){return new I(c.convertToJsScalar(t,e.x),c.convertToJsScalar(i,e.y),c.convertToJsScalar(t,e.z),c.convertToJsScalar(i,e.w))},c.convertVec4ToScalar=function(e,t,i){return new I(c.convertJSToScalar(t,e.x),c.convertJSToScalar(i,e.y),c.convertJSToScalar(t,e.z),c.convertJSToScalar(i,e.w))},c.dist=function(e,t){var i=e.x-t.x,e=e.y-t.y;return Math.sqrt(i*i+e*e)},c.expandNestedViewStates=function(e,t){var i,n=/([a-zA-Z]+)\.[0-9]+\./,r=Object.keys(e),o=[];return(o=_.every(function(e){e=t.getPropertyMeta(e[0]);return e&&"viewstate"===e.type})?_.uniq(_.filter(_.map(r,function(e){e=n.exec(e);return e?e[1]:null}))):o).length?(i={},_.each(o,function(e){return i[e]=t.getProperty(e)}),i):e},c.floatToEmulateDoubleArray=function(e){for(var t=2*e.length,i=new Float32Array(t),n=0,r=0;r<t;r+=2){var o=e.getScalar(n++);i[r]=o,i[r+1]=o-Math.fround(o)}return i},c.getDistance=function(e,t){for(var i=t[t.length-1]-t[0],n=e.length,r=1/0,o=1/0;n--;)r=e[n]<r&&0<e[n]?e[n]:r,o=Math.abs(e[n]<o&&e[n]<0?e[n]:o);var s=r<o?r:o;return s>i/t.length?s:i/t.length},c.getFormatter=function(i,n,r){return"Number"===i||"Formatted Number"===i||"Smart Number"===i?function(e){var t;if("Smart Number"!==i&&"Formatted Number"!==i||"string"==typeof e&&(e=/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/.test(e)?parseFloat(e):e),null==e)return"";if(t="Smart Number"===i?_.isNumber(e)?E.Tools.smartFormatNumber(e,n):_.escape(e):"number"==typeof e?"Formatted Number"===i?E.Tools.formatNumber(e,n):e.toFixed(n):_.escape(e),r&&0<=t.toString().indexOf(".")){for(;"0"===t[t.length-1];)t=t.slice(0,-1);t.indexOf(".")===t.length-1&&(t=t.slice(0,-1))}return t}:"General"===i?function(e){return v.isMoment(e)||v.isDuration(e)?e.format():_.escape(e)}:"Boolean"===i?function(e){return _.escape(e)}:function(e){return _.escape(e)}},c.getMajorPerformanceCaveat=function(e){var t=document.createElement("canvas"),i=(t.setAttribute("width","1"),t.setAttribute("height","1"),document.getElementsByTagName("body")[0]),e=(i.appendChild(t),t.getContext(e,{failIfMajorPerformanceCaveat:!0}));return i.removeChild(t),!e},c.getMidrange=function(e,t){if(t===D.Timestamp){t=new w(c.convertToJsScalar(t,e.x),c.convertToJsScalar(t,e.y)),t=new w(c.convertJSToNumber(t.x),c.convertJSToNumber(t.y));if(t.y===t.x&&e.x!==e.y)return(c.toBigInt(e.x)+c.toBigInt(e.y))/c.toBigInt(2)}return null},c.getNullVal=function(e){var t;return c.isLong(e)?(t=new E.Long(0,2147483648),"undefined"!=typeof BigInt&&(t=BigInt(t))):c.isDouble(e)||(t=5===e?-32768:-2147483648),t},c.getValueFromObject=function(e){for(var t="",i=0;i<e.length;i++)t+=e.getValue(i);return t},c.ipcTemp=function(e){switch(e){case 12:return E.ipc.Timestamp;case 13:return E.ipc.Month;case 14:return E.ipc.QDate;case 15:return E.ipc.DateTime;case 16:return E.ipc.Timespan;case 17:return E.ipc.Minute;case 18:return E.ipc.Second;case 19:return E.ipc.Time}},c.isDouble=function(e){return-1!==c.DOUBLE_TYPES.indexOf(e)},c.isFloat=function(e){return e===D.Float},c.isInt=function(e){return-1!==c.INT_TYPES.indexOf(e)},c.isLong=function(e){return-1!==c.LONG_TYPES.indexOf(e)},c.isNull=function(e,t){return t?Number(e)===Number(t):isNaN(Number(e))||null===e},c.isRegexOrWild=function(e){e="object"==typeof e&&e.attributes?e.attributes.value:e;return!!e&&(0===e.indexOf("/")||-1!==e.indexOf("*"))},c.isString=function(e){return null!==e&&-1!==c.STRING_TYPES.indexOf(e)},c.limitWithin=function(e,t,i){return e=c.toNumber(e),t=c.toNumber(t),i=c.toNumber(i),e<t?t:i<e?i:e},c.log10=function(e){return Math.log10?Math.log10(e):Math.log(e)/Math.LN10},c.longToEmulateDoubleArray=function(t){for(var e=2*t.length,i=new Float32Array(e),n=0,r="undefined"!=typeof BigInt?t.getScalar.bind(t):function(e){return t.getLegacyScalar(e).toString()},o=t.calcRange(),s=c.getMidrange(new w(o[0],o[1]),t.qtype),a=0;a<e;a+=2){var l=r(n++),l=s?Number(c.toBigInt(l)-s):Number(l),l=(i[a]=l,c.toBigInt(l)-c.toBigInt(Math.fround(l)));i[a+1]=Number(l)}return i},c.mergeRange=function(e){if(0<e.length){for(var t=e[0],i=1;i<e.length;i++)t=new w(c.minJs(t.x,e[i].x),c.maxJs(t.y,e[i].y));return t}},c.max=function(e,t){if(E.Long.isLong(e)){if(E.Long.isLong(t))return e.gt(t)?e:t;e=e.toNumber()}else E.Long.isLong(t)&&(t=t.toNumber());return t<e?e:t},c.maxJs=function(e,t){return v.isMoment(e)&&v.isMoment(t)?e.valueOfNano()>t.valueOfNano()?e:t:t<e?e:t},c.min=function(e,t){if(E.Long.isLong(e)){if(E.Long.isLong(t))return e.gt(t)?t:e;e=e.toNumber()}else E.Long.isLong(t)&&(t=t.toNumber());return t<e?t:e},c.minJs=function(e,t){return v.isMoment(e)&&v.isMoment(t)||v.isDuration(e)&&v.isDuration(t)?e.valueOfNano()>t.valueOfNano()?t:e:t<e?t:e},c.replaceViewStates=function(i,e,l,h){var u=function(e,t){return function i(e,t,n){n=n?n+".":"";t+="";var r=h.getPropertyMeta(n+t);var o=e&&e.has&&e.has("_dataSource")&&e.has("_dataType");o=(_.isArray(e)||_.isObject(e))&&!o;{var s,a;return r&&"data"===r.type?e:r&&"viewstate"===r.type?(a=(n+t).split("."),s=a.pop(),a=a.join("."),l(a,void 0===s?"":s,e,r)):o?(n+=t,u=function(e,t){return i(e,t,n)},(c=_.isArray(e)?_.map:_.mapValues)(e,u)):e}}(e,t,i||"")},c=_.isArray(e)?_.map:_.mapValues;return c(e,u)},c.replaceViewStatesWithValue=function(e,t,i){return c.replaceViewStates(e,t,function(e,t,i,n){return n.value,n.value},i)},c.intToFloat=function(e){for(var t=0,i=new Float32Array(e.length),n=0;n<e.length;n++){var r=e.getScalar(t++);i[n]=r}return i},c.toBigInt=function(e){return"bigint"==typeof e?e:BigInt(Math.round(e))},c.toLong=function(e){return c.isIE11?E.Long.isLong(e)?e:new E.Long(Math.round(Number(e))):"bigint"==typeof e?e:BigInt(Math.round(e))},c.toNumber=function(e){return E.Long.isLong(e)?e.toNumber():"bigint"==typeof e?Number(e):e},c.calculateRelativePoint=function(e,t){return new w(c.calculateRelativeValue(e.x,t.x,t.z),c.calculateRelativeValue(e.y,t.y,t.w))},c.calculateRelativeValue=function(e,t,i){var n;return c.isIE11?((E.Long.isLong(e)?e.toNumber():Number(e))-(n=E.Long.isLong(t)?t.toNumber():Number(t)))/((E.Long.isLong(i)?i.toNumber():Number(i))-n):"bigint"==typeof t&&"bigint"==typeof i?Number(c.toBigInt(e)-t)/Number(i-t):(Number(e)-Number(t))/(Number(i)-Number(t))},c.scale=function(e,t,i){return t+e*(i-t)},c.scale2=function(e,t,i){return new w(t.x+e*(i.x-t.x),t.y+e*(i.y-t.y))},c.scale4=function(e,t,i){return new I(t.x+e*(i.x-t.x),t.y+e*(i.y-t.y),t.z+e*(i.z-t.z),t.w+e*(i.w-t.w))},c.scaleJs=function(e,t,i){var n,r,o,s;return v.isMoment(t)&&v.isMoment(i)?(r=t.valueOf()+e*(i.valueOf()-t.valueOf()),o=t.nanosecond()+e*(i.nanosecond()-t.nanosecond()),(s=v(r)).nanoseconds(o),s):v.isDuration(t)&&v.isDuration(i)?(r=(n=Number(t.valueOf()))+e*(Number(i.valueOf())-n),o=t.nanosecond()+e*(i.nanosecond()-t.nanosecond()),(s=v.duration(r)).nanoseconds(o),s):Number(t)+e*(Number(i)-Number(t))},c.toS=function(e){return"number"!=typeof e&&e.toDashString?e.toDashString():e.toString?e.toString():""},c.xPart=function(e){return new w(e.x,e.z)},c.yPart=function(e){return new w(e.y,e.w)},c.isIE11=/Trident\/.*rv:11/.test(navigator.userAgent),c.isWebGL2="undefined"!=typeof WebGL2RenderingContext,c.glContext=c.isWebGL2?"webgl2":c.isIE11?"experimental-webgl":"webgl",c.isWebGLHWAcclEnabled=!c.getMajorPerformanceCaveat("webgl"),c.DOUBLE_TYPES=[D.Double,D.DateTime],c.INT_TYPES=[D.Byte,D.Short,D.Int,D.Char,D.Month,D.Date,D.Minute,D.Second],c.LONG_TYPES=[D.Long,D.Timespan,D.Timestamp],c.STRING_TYPES=[D.List,D.Symbol],c);function c(){}(r=f=f||{})[r.Nanosecond=0]="Nanosecond",r[r.Millisecond=1]="Millisecond",r[r.Second=2]="Second",r[r.Minute=3]="Minute",r[r.Hour=4]="Hour",r[r.Day=5]="Day",r[r.Month=6]="Month",r[r.Year=7]="Year";m.prototype.getTicksLength=function(){return this.ticks},m.prototype.getBaseSize=function(e){return this.displayTitle?e+m.TICKSIZE+1.8*this.titleFontSize:(e+=2*m.TICKSIZE,this.width?e-(e-this.width):e)},m.prototype.getGridlines=function(){return{color:this.gridlinesColor,offset:this.gridlinesOffset,opacity:this.gridlinesOpacity}},m.prototype.getSimpleTicks=function(){var e=v.isMoment(this.bounds.x),t=v.isDuration(this.bounds.x),i=N.convertJSToNumber(this.bounds.x),n=N.convertJSToNumber(this.bounds.y);if(e||t){for(var r,o,s,e=new w(N.convertJSToScalar(this.type,this.bounds.x),N.convertJSToScalar(this.type,this.bounds.y)),a=N.getMidrange(e,this.type),l=(a&&(i=Number(N.toBigInt(e.x)-a),n=Number(N.toBigInt(e.y)-a)),[]),e=this.determineUnitForAutoTicks(i,n,this.ticks),h=m.INTERVALS[e],u=e===f.Month||e===f.Year,c=u||e===f.Year,p=(i/=h.size,(n/=h.size)-i),e=this.niceNum(n-i,!1),d=e&&e<this.ticks-1?e:this.ticks-1,y=this.niceNum(e/d,!0),g=Math.floor(i/y)*y;g<=n;g+=y)i<=g&&(s=void 0,s=t?((r=E.Tools.convertValueToDuration(g*h.size)).nanosecond(g%1e6*h.size),r.formatNano(c?"":h.format)):(r=(u?g+1:g)*h.size,o=a?N.toBigInt(r)+a:r,(this.type===D.Date?v(r):a?E.Tools.convertValueToMoment(N.convertToJsScalar(this.type,o)):E.Tools.convertValueToMoment(r)).format(h.format)),l.push({pos:(g-i)/p,label:this.prefix+s+this.suffix}));return l}return this.niceScale(i,n)},m.prototype.measureText=function(e,t){return e.font=this.fontSize+"px "+m.FONTFACE,e.measureText(t)},m.prototype.setRangeViewstate=function(e,t,i){var n=e?N.toS(e.x):"",e=e?N.toS(e.y):"";this.api.getPropertyMeta(t+"."+i+m.PROP_SEL_MIN).viewstateType&&this.api.setProperty(t+"."+i+m.PROP_SEL_MIN,n),this.api.getPropertyMeta(t+"."+i+m.PROP_SEL_MAX).viewstateType&&this.api.setProperty(t+"."+i+m.PROP_SEL_MAX,e)},m.prototype.updateCategoryData=function(e){this.categoryData=e},m.prototype.updateBounds=function(e,t){_.isEqual(e,this.bounds)||(this.bounds=e,this.type=_.min(t))},m.prototype.niceNum=function(e,t){var i=Math.floor(N.log10(e)),e=e/Math.pow(10,i),t=t?e<1.5?1:e<3?2:e<7?5:10:e<=1?1:e<=2?2:e<=5?5:10;return t*Math.pow(10,i)},m.prototype.determineUnitForAutoTicks=function(e,t,i){var n,r=Number.MAX_SAFE_INTEGER||9007199254740991,o=this.getUnitFromLayer(this.type);for(n in f){var s=isNaN(Number(n))?f[n]:Number(n),a=m.INTERVALS[s],l=a.steps||r,a=Math.ceil((t-e)/(l*a.size)),l=Math.ceil((t-e)/(l*m.INTERVALS[o].size));if(a<=i){if(l<a)return o;if(Number(s)>=o)return s}}return f.Year},m.prototype.getUnitFromLayer=function(e){switch(e){case D.Date:return f.Day;case D.Month:return f.Month;case D.Minute:return f.Minute;case D.Second:return f.Second;case D.Timespan:case D.Timestamp:return f.Nanosecond;case D.DateTime:case D.Time:return f.Millisecond;default:return f.Year}},m.prototype.niceScale=function(e,t){for(var i=[],n=t-e,r="Category"===this.axisType&&this.categoryData.length,o=this.niceNum(t-e,!1),s=this.niceNum(o/(this.ticks-1),!0),a=0,o=(r&&(s=1/(a=this.categoryData.length-1)),r&&1===this.categoryData.length?t=.5:Math.floor(e/s)*s),l=Math.max(-Math.floor(N.log10(s)),0),h=N.getFormatter(this.format,Math.max(l,this.decPlaces),this.hideTrailingZeroes),u=o;u<=t;u+=s){var c=Math.round(a*u),c=r?this.categoryData[c]:u,p=v.isMoment(c),d=v.isDuration(c);"Category"===this.axisType&&(p||d)&&(c=N.toS(c)),e<=u&&void 0!==c&&i.push({pos:(u-e)/n,label:this.prefix+h(c)+this.suffix})}return i},m.FONTFACE="Segoe UI,Helvetica,Arial,sans-serif",m.PROP_BEGIN_ZERO=".Format.BeginAtZero",m.PROP_MIN=".Range.Min",m.PROP_MAX=".Range.Max",m.PROP_SEL_MIN=".Range.SelectionMin",m.PROP_SEL_MAX=".Range.SelectionMax",m.TICKSIZE=7,m.PROP_USE_MIN_MAX=".Range.UseMinMax",m.PROP_DISPLAY=".Format.Display",m.PROP_TYPE=".Type",m.PROP_FONTSIZE=".Format.FontSize",m.PROP_FORMAT=".Format.Format",m.PROP_GRIDLINESCOLOR=".Gridlines.GridlinesColor",m.PROP_GRIDLINESOFFSET=".Gridlines.GridlinesOffset",m.PROP_GRIDLINESOPACITY=".Gridlines.GridlinesOpacity",m.PROP_HIDETRAIL=".Format.HideTrailingZeroes",m.PROP_POSITION=".Position",m.PROP_PRECISION=".Format.Precision",m.PROP_PREFIX=".Format.Prefix",m.PROP_SUFFIX=".Format.Suffix",m.PROP_TICKS=".Ticks",m.PROP_TITLEDISPLAY=".Title.Display",m.PROP_TITLESTRING=".Title.LabelString",m.PROP_TITLEFONTSIZE=".Title.FontSize",m.PROP_WIDTH=".Width",m.INTERVALS=[{common:!0,size:1e-6,steps:1e6,format:"H:mm:ss.SSSSSSSSS"},{common:!0,size:1,steps:1e3,format:"H:mm:ss.SSS"},{common:!0,size:1e3,steps:60,format:"H:mm:ss"},{common:!0,size:6e4,steps:60,format:"H:mm"},{common:!0,size:36e5,steps:24,format:"HH:mm"},{common:!0,size:864e5,steps:30,format:"YYYY-MM-DD"},{common:!0,size:2628e6,steps:12,format:"MMM YY"},{common:!0,size:3154e7,format:"Y"}];var S=m;function m(e,t){this.bounds=new w(0,1),this.categoryData=[],this.type=0,this.api=e,this.axisType=e.getProperty(t+m.PROP_TYPE),this.width=e.getProperty(t+m.PROP_WIDTH),this.displayTitle=e.getProperty(t+m.PROP_TITLEDISPLAY),this.display=e.getProperty(t+m.PROP_DISPLAY),this.gridlinesOpacity=e.getProperty(t+m.PROP_GRIDLINESOPACITY),this.gridlinesOffset=e.getProperty(t+m.PROP_GRIDLINESOFFSET),this.gridlinesColor=e.getProperty(t+m.PROP_GRIDLINESCOLOR),this.title=e.getProperty(t+m.PROP_TITLESTRING),this.titleFontSize=e.getProperty(t+m.PROP_TITLEFONTSIZE),this.ticks=e.getProperty(t+m.PROP_TICKS),this.fontSize=e.getProperty(t+m.PROP_FONTSIZE),this.position=e.getProperty(t+m.PROP_POSITION),this.prefix=e.getProperty(t+m.PROP_PREFIX),this.suffix=e.getProperty(t+m.PROP_SUFFIX),this.format=e.getProperty(t+m.PROP_FORMAT),this.decPlaces=e.getProperty(t+m.PROP_PRECISION),this.hideTrailingZeroes=e.getProperty(t+m.PROP_HIDETRAIL)}var ye=function(e,t,i,n,r){this.layer=e,this.index=t,this.overpoint=i,this.yAxis=n,this.yIndex=r},ge=(P.prototype.drawCoordinates=function(e,t,i,n,r,o){var s,a,l,h=n.getElementsByClassName("xCoord")[0],u=n.getElementsByClassName("yCoord")[0],c=(h||u||(h=this.setUpCoordinate(!0,n),u=this.setUpCoordinate(!1,n)),e.width*t.x),t=e.height*t.y;!r||h.innerText===(a=this.formatData("Xaxis",r.val))&&"none"!==h.style.display||(h.style.display="block",l=h.offsetHeight,s=h.offsetWidth,r="Top"===r.position?i.y-l-3:e.height+i.y+3,e=c+i.x,c=s/2,h.style.top=(r+l>n.offsetHeight?r-l:r)+"px",h.style.left=(e-c<0?0:e+c>n.offsetWidth?n.offsetWidth-s:e-c)+"px",h.innerText=a),!o||u.innerText===(a=this.formatData("Yaxis",o.val))&&"none"!==u.style.display||(u.style.display="block",l="Right"===o.position?n.offsetWidth-i.z+3:i.x-u.offsetWidth-3,r=u.offsetHeight,u.style.top=t+i.y-r/2+"px",u.style.left=(l<0?0:l)+"px",u.innerText=a)},P.prototype.hideCoordinates=function(e,t){var i=e.getElementsByClassName("yCoord")[0],e=e.getElementsByClassName("xCoord")[0];"x"===t&&e?e.style.display="none":"y"===t&&i?i.style.display="none":e&&i&&(i.style.display="none",e.style.display="none")},P.prototype.updateTheme=function(e,t){var i,n=t.getElementsByClassName("xCoord")[0],t=t.getElementsByClassName("yCoord")[0];this.theme=e,n&&t&&(n.style.backgroundColor=i=(e="Light"===e)?"rgba(48, 48, 48, 0.9)":"rgba(248, 248, 248, 0.9)",n.style.color=e?"white":"black",t.style.backgroundColor=i,t.style.color=e?"white":"black")},P.prototype.updateTooltipPalette=function(e){this.palette=e},P.prototype.hideTooltip=function(){this.api.removeTooltip(),delete this.tooltip},P.prototype.render=function(e,t,i,n){var r=this,o=e.width*t.overpoint.x+6,s=e.height*(1-t.overpoint.y)+6,a=this.api.getProperty(P.PROP_GROUPBYLAYER),l=this.api.getProperty(P.PROP_SHOWALLPOINTS),h=this.api.getProperty(P.PROP_USECUSTOMTOOLTIP),u=this.api.getProperty(t.layer.indexProp(F.PROP_XAXIS)),c=t,t=(this.closestPointInfo=this.getRowData(c.layer,c.index,c.yAxis,c.yIndex),t.layer.getRowData(c.index)),p=t?t[u]:null,d=[],y=[];_.each(i,function(e){var t=r.api.getProperty(e.layer.indexProp(F.PROP_XAXIS)),i=e.layer.getRowData(e.index),i=i?i[t]:null;null!==i&&(t=function(e){return e.i+""+(e.n||0===e.n?e.n:"")},(i="object"==typeof i&&i.i?t(i):i)===(p="object"==typeof p&&null!=p&&p.i?t(p):p)&&(a&&l&&!h?y.push(e):d.push(r.getRowData(e.layer,e.index,e.yAxis,e.yIndex))))}),a&&l&&!h&&(d=this.groupedLayers(n,y));c={text:h?this.api.getProperty(P.PROP_CUSTOMTOOLTIP):z.TOOLTIP_DEFAULT,data:d,position:{top:s,left:o},anchorEl:e};return this.tooltip=this.api.setTooltip(c),t},P.prototype.returnPointInfo=function(){return this.closestPointInfo},P.prototype.formatData=function(e,t){var i=this.api.getProperty((e="Xaxis"===e?"Xaxes.0":"Yaxes.0")+P.PROP_FORMAT),n=this.api.getProperty(e+P.PROP_PRECISION),e=this.api.getProperty(e+P.PROP_HIDETRAIL);return N.getFormatter(i,n,e)(t)},P.prototype.formattedData=function(e,t){return e.getRowData(t)},P.prototype.getRowData=function(i,e,t,n,r){var o,s=this,a=this.api.getProperty(i.indexProp(F.PROP_XAXIS)),l=this.api.getProperty(i.indexProp(F.PROP_HIGHLIGHTRULES)),h=(i.isRegexOrWild()?(o=this.palette[i.index][n],(l&&l.length||i.hasColorData())&&(o=i.getColorArr(e,n))):(o=this.api.getProperty(i.indexProp(F.PROP_COLOR)),(l&&l.length||i.hasColorData())&&(o=i.getColorArr(e))),this.formattedData(i,e)),n=i.getLayerName(),l=i.isRegexOrWild()?t:n,e=h?this.formatData("Xaxis",h[a]):"",n=h?this.formatData("Yaxis",h[t]):"",a=this.getWidth(l,12),t=this.getWidth(e,12),u=this.api.getProperty(i.indexProp(F.PROP_ICON)),c={color:o,data:h,icon:u&&0===u.indexOf("fa")?"fa "+u:"fa fa-square",image:u&&0===u.indexOf("data:image/")?"width: 15px; content: url('"+u+"')":"",name:l,width:Math.max(a+30,t+30),xAxis:e,yAxis:n,grouped:r?_.map(r,function(e){return s.formatData("Yaxis",e)}):null};return i.isCandlestick()&&["Open","High","Low","Close"].forEach(function(e){var t=s.api.getProperty(i.indexProp(e));c[e.toLowerCase()]=h?s.formatData("Yaxis",h[t]):""}),c},P.prototype.getWidth=function(e,t){var i=document.createElement("canvas").getContext("2d");if(i)return i.font=t+"px "+S.FONTFACE,i.measureText(e).width;throw new Error("2d context not supported or canvas already initialized")},P.prototype.groupedLayers=function(n,o){var s=this,r=[],e=_.map(n,function(e){return e.layer.getAllCols()}),a=[];return _.each(e,function(e,t){var i=n[t];1===e.length?r.push(_.filter(o,function(e){return e.layer===i.layer&&e.yIndex===i.yIndex})):_.each(e,function(e,t){r.push(_.filter(o,function(e){return e.layer===i.layer&&e.yIndex===Number(t)}))})}),_.each(r,function(n,r){_.each(o,function(e){var t,i=n[0];i&&i.layer===e.layer&&(t=n[0].yAxis,e=_.map(n,function(e){e=s.formattedData(e.layer,e.index);return e?e[t]:null}),a[r]=s.getRowData(i.layer,i.index,i.yAxis,i.yIndex,e))})}),a.filter(function(e){return e})},P.prototype.setUpCoordinate=function(e,t){var i=document.createElement("div");return i.className=e?"xCoord":"yCoord",i.style.borderRadius="3px",i.style.padding="3px",i.style.position="absolute",i.style.fontFamily="sans-serif",t.appendChild(i),this.updateTheme(this.theme,t),i},P.PROP_CUSTOMTOOLTIP="Overlay.CustomTooltip",P.PROP_USECUSTOMTOOLTIP="Overlay.UseCustomTooltip",P.PROP_GROUPBYLAYER="Overlay.GroupByLayer",P.PROP_SHOWALLPOINTS="Overlay.ShowAllPoints",P.PROP_FORMAT=".Format.Format",P.PROP_HIDETRAIL=".Format.HideTrailingZeroes",P.PROP_PRECISION=".Format.Precision",P.FORMATS={1212:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",1213:"YYYY-MM",1214:"YYYY-MM-DD",1215:"YYYY-MM-DD HH:mm:ss.SSS",1216:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",1217:"YYYY-MM-DD HH:mm",1218:"YYYY-MM-DD HH:mm:ss",1219:"YYYY-MM-DD HH:mm:ss.SSS"},P);function P(e){this.subscriptionKey="",this.palette=[],this.api=e}l.prototype.hideCrosshair=function(e){var t=this.el.getElementsByClassName("crosshairX")[0],i=this.el.getElementsByClassName("crosshairY")[0],n=this.el.getElementsByClassName("crosshair-selected")[0];t&&this.el&&(t.setAttribute("visibility","hidden"),i.setAttribute("visibility","hidden"),"hide-both"===e&&n&&n.setAttribute("visibility","hidden"))},l.prototype.render=function(e,t,i,n){this.margin=e,"click"===i&&(this.overpoint=t);var r=this.canvas.width*t.x,t=this.canvas.height*(1-t.y),n="Light"===n?"black":"white";this.api.getProperty(l.PROP_CROSSHAIR)?(this.crosshairX?(this.crosshairX=this.el.getElementsByClassName("hover"===i?"crosshairX":"crosshair-selected")[0],this.crosshairY=this.el.getElementsByClassName("crosshairY")[0]):(this.crosshairX=document.createElementNS("http://www.w3.org/2000/svg","line"),this.crosshairY=document.createElementNS("http://www.w3.org/2000/svg","line"),"hover"===i?(this.crosshairX.setAttribute("class","crosshairX"),this.crosshairY.setAttribute("class","crosshairY")):this.crosshairX.setAttribute("class","crosshair-selected")),"number"==typeof r&&this.crosshairX&&isFinite(r)&&(this.setCrosshair(this.crosshairX,n,i),this.crosshairX.setAttribute("x1",r+""),this.crosshairX.setAttribute("y1","0"),this.crosshairX.setAttribute("x2",r+""),this.crosshairX.setAttribute("y2",this.canvas.height+e.y+"")),"number"==typeof t&&this.crosshairY&&isFinite(t)&&"hover"===i&&(this.setCrosshair(this.crosshairY,n),this.crosshairY.setAttribute("x1","0"),this.crosshairY.setAttribute("y1",t+""),this.crosshairY.setAttribute("x2",this.canvas.width+e.x+""),this.crosshairY.setAttribute("y2",t+""))):this.hideCrosshair("hide-both")},l.prototype.onPan=function(e){var t;this.isSelected()&&this.crosshairX&&(t=Number(this.crosshairX.getAttribute("x1"))/this.canvas.width,this.setPosition(t+e),this.overpoint=new w(t+e,this.overpoint.y))},l.prototype.updateSelected=function(e,t){var i;this.isSelected()&&(i=this.overpoint.x,t&&(t=e.y-e.x,i>e.x&&i<e.y?i=(i-e.x)/t:this.hideCrosshair("hide-both"),this.setPosition(i)))},l.prototype.isSelected=function(){return this.crosshairX&&this.crosshairX===this.el.getElementsByClassName("crosshair-selected")[0]&&"visible"===this.crosshairX.getAttribute("visibility")},l.prototype.setPosition=function(e){var t=this.canvas.width*e,i=this.canvas.height+this.margin.y+"";!isNaN(e)&&isFinite(t)&&this.crosshairX&&(this.crosshairX.setAttribute("x1",t+""),this.crosshairX.setAttribute("y1","0"),this.crosshairX.setAttribute("x2",t+""),this.crosshairX.setAttribute("y2",i))},l.prototype.setCrosshair=function(e,t,i){e.setAttribute("visibility","visible"),e.setAttribute("opacity",.7),e.setAttribute("stroke",t),e.setAttribute("stroke-dasharray","click"===i?0:3),this.el.getElementsByClassName("overlay")[0].appendChild(e)},l.SVG_NS="http://www.w3.org/2000/svg",l.PROP_CROSSHAIR="Overlay.ShowCrosshairs";var fe=l;function l(e,t,i){this.el=e,this.api=t,this.canvas=i,this.crosshairX=null,this.crosshairY=null,this.overpoint=new w(0,1),this.margin=new I(0,0,1,1)}p.prototype.destroyTree=function(){this.$tree.jstree("destroy"),this.treeWidth=0},p.prototype.getNames=function(){return this.names},p.prototype.getTreeWidth=function(){return this.treeWidth},p.prototype.onSettingsChange=function(t,e){var i=t.map(function(e){return e.Name}),n=t.map(function(e,t){return t}).filter(function(e){return t[e].Expanded}),r=this.legends.filter(function(e,t){return e.legendGroup&&-1!==n.indexOf(e.index)}).map(function(e){return e.id}),o=t.map(function(e){return e.Icon});this.openedNodes||(this.openedNodes=r,this.icons=o,this.names=i),!_.isEqual(r,this.openedNodes)&&e&&this.expandNodes(r),_.isEqual(i,this.names)&&_.isEqual(o,this.icons)||(this.icons=o,this.appInvalidate(M.Legend))},p.prototype.render=function(e){var t=this;this.destroyTree(),this.legends=this.generateDataObj(e),this.names=this.api.getProperty("Legend.LegendGroups").map(function(e){return e.Name}),this.$tree.jstree({core:{data:this.legends,force_text:!0,dblclick_toggle:!1},checkbox:{three_state:!0,cascade:"undefined",tie_selection:!1},plugins:["checkbox","conditionalselect","changed"]}),this.initTreeEvents(),this.$tree.on("ready.jstree",function(){var e=t.$tree.width();e!==t.treeWidth&&(t.treeWidth=e,t.appInvalidate(M.Axis)),t.updateIconColors()})},p.prototype.expandNodes=function(e){this.$tree.jstree("close_all"),this.$tree.jstree(!0).open_node(e),this.openedNodes=e},p.prototype.initTreeEvents=function(){var i=this;this.$tree.on("ready.jstree",function(){i.$tree.on("check_node.jstree",function(e,t){i.onNodeCheck(t.node,!0)}),i.$tree.on("uncheck_node.jstree",function(e,t){i.onNodeCheck(t.node,!1)}),i.$tree.on("open_node.jstree",function(e,t){i.setLegendGroupExpanded(t.node.original.index,!0)}),i.$tree.on("close_node.jstree",function(e,t){i.setLegendGroupExpanded(t.node.original.index,!1)})})},p.prototype.generateDataObj=function(e){var i=this;return e.map(function(e,t){return g(g({},e),{id:t,icon:"fa "+(e.icon||"fa-stop"),state:{opened:!e.legendGroup||i.api.getProperty("Legend.LegendGroups."+e.index+".Expanded"),selected:!1,checked:e.enabled},li_attr:{class:"treenode-id-"+t,title:e.text},color:e.fillStyle})})},p.prototype.onNodeCheck=function(e,t){var i=this,n=!1;this.clicks++,1===this.clicks&&setTimeout(function(){1===i.clicks?i.selectedLegend="":1<i.clicks&&(n=!0,i.selectedLegend?(i.$tree.jstree(!0).check_all(),i.selectedLegend="",i.updateIconColors()):(i.$tree.jstree(!0).uncheck_all(),i.$tree.jstree(!0).check_node(e),i.selectedLegend=e.original.text)),i.updateLayerOnNodeCheck(e,t,n),i.clicks=0},300)},p.prototype.setLegendGroupExpanded=function(e,t){this.api.setProperty("Legend.LegendGroups."+e+".Expanded",t);e=this.$tree.width();t?(this.updateIconColors(),e>this.treeWidth&&(this.treeWidth=e)):"Left"!==this.api.getProperty("Legend.Position")&&this.$tree.width(this.treeWidth),this.appInvalidate(M.Axis)},p.prototype.updateIconColors=function(){var i=this;this.legends.forEach(function(e,t){e.legendGroup||(t=null==(t=i.el.getElementsByClassName("treenode-id-"+t)[0])?void 0:t.getElementsByClassName("jstree-themeicon-custom")[0])&&(t.style.color=e.color)})},p.prototype.updateLayerOnNodeCheck=function(r,o,s){var e,a=this,t=r.original.text;r.children.length?r.children.forEach(function(e,t){var e=a.$tree.jstree(!0).get_node(e+""),i=e.original.index,t=t<r.children.length-1,n=e.original.wild,e=e.original.text;a.updateLayerState(i,o,s,e,t,n,!0)}):(e=r.original.wild,this.updateLayerState(r.original.index,o,s,t,!1,e))};var me=p;function p(e,t,i,n){this.el=e,this.api=t,this.updateLayerState=i,this.appInvalidate=n,this.clicks=0,this.icons=[],this.legends=[],this.names=[],this.selectedLegend="",this.$tree=$(this.el).find(".legend-div"),this.names=this.api.getProperty("Legend.LegendGroups").map(function(e){return e.Name})}xe.prototype.render=function(s){function a(e){return"object"==typeof e&&e.attributes?e.attributes.value:e}var l=[];_.each(this.api.getProperty("Layers"),function(e){_.each(_.filter(e.HighlightRules,function(e){return e.Show}),function(e){var t;if("gradient"===e.RuleType){if(!e.Palette.length)return;for(var i=e.Palette.map(function(e){return"object"==typeof e.type&&e.type.attributes?{type:e.type.attributes.value}:e}),n=new Array(i.length),r=0;r<i.length;r++){var o=(r/i.length*100).toFixed(2);n[r]=i[r].type+" "+o+"%"}t="linear-gradient(to right, "+n.join(", ")+")"}else t=a(e.RuleColor);l.push({ruleColor:t,ruleName:a(e.RuleName),color:s})})}),this.el.getElementsByClassName("GL-highlight-rule")[0].innerHTML=y.highlightRule(l)};var Pe=xe;function xe(e,t){this.api=e,this.el=t}d.prototype.onSettingsChange=function(e){this.tree.onSettingsChange(e,this.isLegendGroup)},d.prototype.render=function(e){var o,t,s,i,n,a,r,l,h,u,c,p,d=this;this.checkedNode?this.checkedNode=!1:(o=[],t=this.color,s=G([],this.layers,!0),i=this.el.getElementsByClassName("legend-div")[0],n=this.el.getElementsByClassName("export-div")[0],a=this.api.getProperty("Legend.LegendGroups"),r=this.api.getProperty("Layers"),l=[],this.legendHeight=void 0,this.ruleLegendHeight=void 0,this.updatePalette(this.layers,e),this.updateLegendGroupNames(a,r),h=r.some(function(e){return e.LegendGroup&&"None"!==e.LegendGroup}),u=0,r.forEach(function(t){var i,e,n=t.LegendGroup,r=(h&&n&&"None"!==n&&(-1===l.indexOf(n)?(e=a.findIndex(function(e){return e.Name===n}),e=d.renderLegendGroup(e),l.push(n),e.opened=d.api.getProperty("Legend.LegendGroups."+(l.length-1)+".Expanded"),o.push(e),i=u,u++):i=o.findIndex(function(e){return e.text===n})),s.find(function(e){return e.getId()===t._Id}));r&&d.renderLegend(t,r,n).forEach(function(e){h&&(e=g(g({},e),{id:u,legendGroup:!1,index:null==r?void 0:r.index,parent:"None"===n?"#":i,enabled:null==r?void 0:r.isEnabled(),wild:null==r?void 0:r.isRegexOrWild()})),o.push(e),u++})}),h?(i.classList.add("grouped-legend"),i.classList.remove("standard-legend"),"100%"===i.style.width&&(i.style.width="auto"),"100%"!==i.style.height&&(i.style.height="100%"),this.isLegendGroup=!0,this.tree.render(o)):(i.classList.add("standard-legend"),i.classList.remove("grouped-legend"),this.tree.destroyTree(),this.isLegendGroup=!1,i.innerHTML=y.legend(o),c=[],_.each(s,function(e,t){var i=d.api.getProperty("Layers."+t+".Legend"),n=c.filter(function(e){return e}),n=n[n.length-1],e=e.isCandlestick()?1:e.getAllCols().length;c.push(i?e+(0<t&&n?n:0):0)}),e=this.el.getElementsByClassName("legend-div")[0].getElementsByTagName("li"),p=0,_.each(e,function(t,r){t.onclick=function(){i=r,n=0,_.each(c,function(e,t){if(i+1<=e)return n=t,!1});var i,n,e=n;1===++p&&setTimeout(function(){d.updateState(t,e,1<p),p=0},300)}})),this.highlightRule.render(t),this.updateLegendPositions(i,n))},d.prototype.getLayers=function(e){this.layers=e},d.prototype.getHeight=function(){var e=this.el.getElementsByClassName("legend-div")[0],t=this.el.getElementsByClassName("export-div")[0];if(void 0!==this.legendHeight)return this.isLegendGroup||(e.style.height=this.legendHeight+"px"),t.style.height=this.legendHeight+"px",this.legendHeight;if(this.api.getProperty("Layers").filter(function(e){return e.Legend}).some(function(e){return e})){var i,n=e.getElementsByTagName("ul")[0],n=null==n?void 0:n.getBoundingClientRect();if(n)return this.isLegendGroup?(i=this.api.getProperty("FileExport.ShowExportCsvButton")||this.api.getProperty("FileExport.ShowExportExcelButton"),e.style.top=i?"20px":"5px"):e.style.height=n.height+"px",t.style.height=n.height+"px",this.legendHeight=n.height}return this.legendHeight=0,e.style.height=this.legendHeight+"px",t.style.height=this.legendHeight+"px",this.legendHeight},d.prototype.getTreeWidth=function(){return this.tree.getTreeWidth()||200},d.prototype.getWidth=function(){var e,t=this.el.getElementsByClassName("legend-div")[0],i=this.el.getElementsByClassName("export-div")[0],n=this.api.getProperty("Layers").filter(function(e){return e.Legend}),r=this.getFileExporterWidth();return n.some(function(e){return e})?(n=null==(n=this.el.getElementsByClassName("chartgl-legend")[0])?void 0:n.getBoundingClientRect(),"Left"===(e=this.getPosition())||"Right"===e?(this.isLegendGroup||(t.style.width=(null==n?void 0:n.width)+"px"),i.style.left="Left"===e?"0":"",i.style.right="Right"===e?"0":""):(t.style.width="calc(100%  - "+r+"px)",i.style.left="",i.style.right="0"),i.style.width=r+"px",this.isLegendGroup?this.getTreeWidth():null==n?void 0:n.width):(t.style.width="0px",0)},d.prototype.getPosition=function(){var e=this.api.getProperty("Legend.Position");return!this.isLegendGroup||"Top"!==e&&"Bottom"!==e?e:"Right"},d.prototype.getRulesHeight=function(){if(void 0!==this.ruleLegendHeight)return this.ruleLegendHeight;var e=this.el.getElementsByClassName("chartgl-highlight-rule")[0];return this.ruleLegendHeight=(null==e?void 0:e.getBoundingClientRect().height)+10||0},d.prototype.onResize=function(e){this.height=e,this.legendHeight=void 0,this.ruleLegendHeight=void 0},d.prototype.renderLegend=function(i,e,t){var n,r,o,s,a,l=e.index,h=this.color,u=[],c=e.getAllCols();return this.disabledColumns[l]&&(i.Enabled||this.disabledColumns[l]===c)||(this.disabledColumns[l]=i.Enabled?[]:c),this.api.getProperty("Layers."+l+".Legend")&&(n=this.api.getProperty("Layers."+l+".Icon"),r=e.isEnabled(),!e.hasColorData()||t&&"None"!==t?e.isRegexOrWild()?(c=e.getAllCols(),o=this.disabledColumns[l],s=e.getPaletteProperty(),_.each(c,function(e,t){u.push({fillStyle:s[t%s.length],icon:n,image:n&&0===n.indexOf("data:image/")?"content: url('"+n+"')":"",width:12,radius:6,text:e,fontColor:h,strike:i.Enabled&&-1===o.indexOf(e)?"":"line-through"})})):u.push({fillStyle:this.api.getProperty("Layers."+l+(e.isCandlestick()?".CandlestickFormat.WickColor":".Color")),icon:n,image:n&&0===n.indexOf("data:image/")?"content: url('"+n+"')":"",width:12,radius:6,text:this.api.getProperty("Layers."+l+".Name"),fontColor:h,strike:r?"":"line-through",bullColor:e.isCandlestick()?this.api.getProperty("Layers."+l+".CandlestickFormat.BullColor"):null}):(c=(t=e.getColorData())[0],a=t[1],c.forEach(function(e,t){u.push({fillStyle:a[t],icon:n,image:n&&0===n.indexOf("data:image/")?"content: url('"+n+"')":"",width:12,radius:6,text:null==e?void 0:e.toString(),fontColor:h,strike:r?"":"line-through"})}))),u},d.prototype.renderLegendGroup=function(e){var t=this.api.getProperty("Legend.LegendGroups."+e+".Icon");return{fillStyle:this.color,icon:t,image:t&&0===t.indexOf("data:image/")?"content: url('"+t+"')":"",width:12,radius:6,text:this.api.getProperty("Legend.LegendGroups."+e+".Name"),fontColor:this.color,strike:"",bullColor:null,parent:"#",id:e,legendGroup:!0,index:e}},d.prototype.updateLegendPositions=function(e,t){var i,n,r=this.getPosition();"Left"===r||"Right"===r?(e.classList.remove("top-bottom"),t.classList.remove("top-bottom"),"Right"===r?(e.classList.add("right"),t.classList.add("right")):(e.classList.remove("right"),t.classList.remove("right"))):(e.classList.add("top-bottom"),e.classList.remove("right"),t.classList.add("top-bottom"),t.classList.remove("right")),e.style.top="Bottom"===r?"auto":"Top"===r||this.isLegendGroup?"5px":this.height/2-this.getHeight()/2+"px",t.style.top="Bottom"===r?"auto":"5px",this.api.getProperty("Layers").some(function(e){return e.HighlightRules&&e.HighlightRules.some(function(e){return e.Show})})?(i=this.el.getElementsByClassName("GL-highlight-rule")[0],n=Math.max(this.getFileExporterWidth(),this.getWidth())+"px",i.style.left="Left"===r?n:"0px",i.style.right="Right"===r?n:"0px","Bottom"===r&&(e.style.bottom=this.getRulesHeight()-5+"px",t.style.bottom=e.style.bottom)):"Bottom"===r&&(e.style.bottom="5px",t.style.bottom=e.style.bottom)},d.prototype.updateTheme=function(e){this.color="Light"===e?"black":"white"},d.prototype.updateWildcards=function(e,t,i,n){e&&(this.updatePalette([e]),this.disabledColumns[t]=i&&e.isEnabled()?[]:e.getAllCols(),e.updateColumns(this.disabledColumns[t],n))},d.prototype.doubleClickLegend=function(n,e,r,t){var o=this;this.selectedLegend&&!t?(this.selectedLegend="",this.layers.forEach(function(e,t){o.api.setProperty("Layers."+t+".Enabled",!0),e.isRegexOrWild()&&(o.disabledColumns[t]=[])})):(t||(this.selectedLegend=n),this.api.getProperty("Layers."+r+".Enabled")||this.api.setProperty("Layers."+r+".Enabled",!0),this.layers.forEach(function(e,t){var i=o.api.getProperty("Layers."+t+".LegendGroup"),i=!o.isLegendGroup||i!==n;t!==r&&i&&o.api.setProperty("Layers."+t+".Enabled",!1)}),e.isRegexOrWild()&&!t&&(this.disabledColumns[r]=e.getAllCols().filter(function(e){return e!==n})))},d.prototype.updatePalette=function(n,r){var o=this,s=[];_.each(this.api.getProperty("Layers"),function(t,i){t.Palette.forEach(function(e,t){""===e.type&&(t=(e=z.PALETTE_DEFAULT)[t%e.length],o.api.setProperty("Layers."+i+".Palette."+i,t))});var e=_.findIndex(n,function(e){return e.getId()===t._Id}),e=n[e];e&&e.isRegexOrWild()?s[i]=e.updateLayerPalette(o.disabledColumns[i],!1,r):e&&(s[i]=[],o.disabledColumns[i]=[],e.updateLayerPalette([],!0),e.hasColorData()&&e.updateColumns([]))}),this.tooltips.updateTooltipPalette(s)},d.prototype.updateLegendGroupNames=function(e,t){var n=this,r=e.map(function(e){return e.Name}),o=this.tree.getNames();t.forEach(function(e,t){var i,e=e.LegendGroup;"None"!==e&&-1===r.indexOf(e)&&(i=o.indexOf(e),e=o.length===r.length?r[i]:"None",n.api.setProperty("Layers."+t+".LegendGroup",e))})},d.prototype.updateState=function(e,t,i){var e=e.getElementsByTagName("span")[0],n=this.layers[t],r=n.isEnabled(),o=n.isRegexOrWild(),s=n.hasColorData();this.setIgnoreSettings(!0),i&&!s?this.doubleClickLegend(e.innerHTML,n,t):(this.selectedLegend="")===e.style.textDecoration?(e.style.textDecoration="line-through",!o&&r&&this.api.setProperty("Layers."+t+".Enabled",!1),o&&(this.disabledColumns[t].length+1!==n.getAllCols().length&&!s||this.api.setProperty("Layers."+t+".Enabled",!1),s||this.disabledColumns[t].push(e.innerHTML))):(e.style.textDecoration="",r||this.api.setProperty("Layers."+t+".Enabled",!0),o&&(s?(this.api.setProperty("Layers."+t+".Enabled",!0),this.disabledColumns[t]=[]):this.disabledColumns[t].splice(this.disabledColumns[t].indexOf(e.innerHTML),1))),s&&this.render(!0),this.updateLayers(!0),o&&(this.updatePalette(this.layers),this.layers[t].updateColumns(this.disabledColumns[t])),this.setIgnoreSettings(!1),this.appInvalidate(M.Process)},d.prototype.updateTreeState=function(e,t,i,n,r,o,s){var a=this.layers[e],l=(this.setIgnoreSettings(!0),this.checkedNode=!0,a.isRegexOrWild());i?(this.doubleClickLegend(n,a,e,r),this.appInvalidate(M.Process)):(this.selectedLegend="",o?t?(this.disabledColumns[e].splice(this.disabledColumns[e].indexOf(n),1),this.api.setProperty("Layers."+e+".Enabled",!0)):(this.disabledColumns[e].length+1===a.getAllCols().length&&(this.api.setProperty("Layers."+e+".Enabled",!1),this.appInvalidate(M.Process)),this.disabledColumns[e].push(n)):(this.api.setProperty("Layers."+e+".Enabled",t),this.updateLayers(!0),t&&(this.disabledColumns[e]=[]),this.appInvalidate(M.Process))),l&&(t||!s&&!t)&&(this.updatePalette(this.layers),a.updateColumns(this.disabledColumns[e])),this.setIgnoreSettings(!1)};var ve=d;function d(e,t,i,n,r,o,s){this.el=e,this.api=t,this.tooltips=i,this.appInvalidate=n,this.setIgnoreSettings=r,this.updateLayers=o,this.getFileExporterWidth=s,this.checkedNode=!1,this.color="black",this.disabledColumns=[],this.height=0,this.isLegendGroup=!1,this.layers=[],this.selectedLegend="",this.highlightRule=new Pe(this.api,this.el),this.tree=new me(this.el,this.api,this.updateTreeState.bind(this),this.appInvalidate.bind(this))}Le.prototype.onAxisPan=function(e,t){var i=e.clientX-t.left,n=e.clientY-t.top,r=t.right-e.clientX,t=t.bottom-e.clientY,e=this.axis.getMargin(),o=i<e.x,s=r<e.z,a=n<e.y,e=t<e.w,o=o?"Left":s?"Right":a?"Top":e?"Bottom":"";return[new I(i,n,r,t),o]},Le.prototype.onPanning=function(e,t,i,n,r,o,s){var a,l="",h="Top"===t||"Bottom"===t,t="Left"===t||"Right"===t;this.activePan||(this.activePan=e),t?l=this.calculatePanDirection(e.y,"y",this.activePan):h&&(l=this.calculatePanDirection(e.x,"x",this.activePan)),l&&(s=h?s.offsetWidth:s.offsetHeight,s=this.pixelDiff/s,(a=this.num-1)<0||(this.activePan=e,document.body.style.cursor=h?"e-resize":"n-resize",e=("Right"===l||"Left"===l?r:o)[a],r=i[a]||new w(0,1),o=n[a]||new w(0,1),i=(e.y-e.x)*(r.y-r.x)*s,n=(e.y-e.x)*(o.y-o.x)*s,r="Right"===l?-i:"Left"===l?i:0,o="Top"===l?-n:"Bottom"===l?n:0,i=new I(e.x+(h?r:0),e.x+(t?o:0),e.y+(h?r:0),e.y+(t?o:0)),this.onPan(i,"Right"===l?s:"Left"===l?-s:0,a,l)))},Le.prototype.onPointDown=function(e,t){this.activePan=e;var i="Top"===t||"Bottom"===t,n="Left"===t||"Right"===t,r=this.axis.getAxes("x"),o=this.axis.getAxes("y"),s=this.axis.getAxes("x","Top"),a=this.axis.getAxes("x","Bottom"),l=this.axis.getAxes("y","Left"),h=this.axis.getAxes("y","Right"),u=0,c=0,p=i?this.axis.getSize(t,"x"):n?this.axis.getSize(t,"y"):[];_.each(p,function(e,t){0<Number(t)&&(p[t]=p[Number(t)-1]+p[t])}),"Right"===t&&(u=e.z),"Left"===t&&(u=e.x),"Top"===t&&(u=e.y),"Bottom"===t&&(u=e.w),_.each(p,function(e,t){if(u<=e)return c=p.length-Number(t),!1}),"Right"===t&&(c=o.indexOf(h[c-1])+1),"Left"===t&&(c=o.indexOf(l[c-1])+1),"Top"===t&&(c=r.indexOf(s[c-1])+1),"Bottom"===t&&(c=r.indexOf(a[c-1])+1),this.num=c},Le.prototype.calculatePanDirection=function(e,t,i){if("y"===t){if(this.pixelDiff=Math.abs(i.y-e),i.y<e)return"Bottom";if(i.y>e)return"Top"}else{if(this.pixelDiff=Math.abs(i.x-e),i.x<e)return"Right";if(i.x>e)return"Left"}return""};var Oe=Le;function Le(e,t,i){this.api=e,this.axis=t,this.onPan=i,this.activePan=null,this.num=0,this.pixelDiff=0}x.prototype.getAxes=function(e,i){return i?_.map(this[e],function(e,t){if(e.position===i)return Number(t)+1}).filter(function(e){return void 0!==e}):_.map(this[e],function(e,t){return Number(t)+1})},x.prototype.getBounds=function(e,t,i,n){var r=this.api.getProperty(t+"."+i+S.PROP_BEGIN_ZERO),o=this.api.getProperty(t+"."+i+S.PROP_USE_MIN_MAX),s=this.api.getProperty(t+"."+i+S.PROP_MIN),t=this.api.getProperty(t+"."+i+S.PROP_MAX),s=/\S/.test(s)?s:e.x,t=/\S/.test(t)?t:e.y,i=o?new w(N.convertStringToJsScalar(s,n),N.convertStringToJsScalar(t,n)):e,o=e.x<0,s=e.y<0;return new w(!r||s||o?i.x:0,r&&s?0:i.y)},x.prototype.getMargin=function(){return this.margin},x.prototype.getSelectionZoomBounds=function(e,t,i,n,r){var o=this.api.getProperty(t+"."+i+S.PROP_SEL_MIN),s=this.api.getProperty(t+"."+i+S.PROP_SEL_MAX),a=e?e.x:0,e=e?e.y:1,l=E.Tools.inferKdbTypeFromDashString(o),h=E.Tools.inferKdbTypeFromDashString(s),l=l?Number(l.slice(-2)):n,h=h?Number(h.slice(-2)):n,n=/\S/.test(o)?N.convertStringToScalar(o,N.ipcTemp(l)):"",u=/\S/.test(s)?N.convertStringToScalar(s,N.ipcTemp(h)):"";if("number"!=typeof n&&"bigint"!=typeof n||(a=N.convertToJsScalar(l,n)),"number"!=typeof u&&"bigint"!=typeof u||(e=N.convertToJsScalar(h,u)),"Category"===this.api.getProperty(t+"."+i+S.PROP_TYPE)&&r&&r[1]){if(!o&&!s)return new w(0,1);var c=l===D.Symbol?o:a,p=h===D.Symbol?s:e,n=r[0].findIndex(function(e){return _.isEqual(e,c)}),u=r[0].findIndex(function(e){return _.isEqual(e,p)});return new w(r[1][n]||0,r[1][u]||1)}return new w(a,e)},x.prototype.getSize=function(t,e){var i,n,r=this,o=("x"===e?this.x:this.y).filter(function(e){return e.position===t&&e.display}),s=this.legend.getHeight(),a=this.legend.getPosition();return"x"===e?(e=this.legend.getRulesHeight(),i="Top"===t&&"Top"===a?s+5:e+("Bottom"===a?s:0),_.map(o,function(e,t){return(e.display?e.getBaseSize(e.fontSize):0)+(0===t?i:0)})):(e=this.legend.getWidth(),n="Left"===t?"Left"===a?e:0:this.margin.z-this.getWidth(o),_.map(o,function(e,t){var i=e.getSimpleTicks(),i=_.maxBy(i,function(e){return e.label.length}),i=e.measureText(r.ctx,(null==i?void 0:i.label)||"");return(e.display?e.getBaseSize(i.width):0)+(0===t?n:0)}))},x.prototype.onResize=function(){this.renderAll=!0},x.prototype.onSettingsChange=function(e,t){"Xaxes"===e&&(this.x[t]=new S(this.api,"Xaxes."+t)),"Yaxes"===e&&(this.y[t]=new S(this.api,"Yaxes."+t)),this.renderAll=!0},x.prototype.render=function(i,n,e,t){var r,o,s,a,l,h=this,u=(this.x.length!==e.length&&(this.x=[],_.each(e,function(e,t){h.x[t]=new S(h.api,"Xaxes."+t)})),this.y.length!==t.length&&(this.y=[],_.each(t,function(e,t){h.y[t]=new S(h.api,"Yaxes."+t)})),this.x.length&&_.some(this.x,function(e){return!0===e.display})),c=this.y.length&&_.some(this.y,function(e){return!0===e.display}),p=this.y.filter(function(e){return"Right"===e.position&&e.display}),d=this.legend.getPosition(),y=this.legend.getWidth(),g=this.legend.getHeight(),f=y!==this.legendWidth,f=i!==this.width||n!==this.height||this.renderAll||f,m=(i!==this.width&&(this.width=i,this.canvas.width=i),n!==this.height&&(this.height=n,this.canvas.height=n),f&&(this.updateTheme(),this.ctx.clearRect(0,0,i,n)),_.some(this.x,function(e,t){return e.bounds&&h.xBounds[t]&&(e.bounds.x!==h.xBounds[t].x||e.bounds.y!==h.xBounds[t].y)})),P=_.some(this.y,function(e,t){return e.bounds&&h.yBounds[t]&&(e.bounds.x!==h.yBounds[t].x||e.bounds.y!==h.yBounds[t].y)}),c=((f||P)&&c&&(P=this.margin,c=S.TICKSIZE,this.ctx.clearRect(0,P.y-c,P.x-S.TICKSIZE,n-P.y-P.w+2*c),this.ctx.clearRect(i-P.z+c,P.y-c,P.z+c,n-P.y-P.w+2*c),this.ctx.clearRect(P.x,P.y,i-P.z-P.x,n-P.y-P.w),this.ctx.clearRect(P.x-c,P.y-c,c+.5,n-P.y+2*c-P.w),this.ctx.clearRect(i-P.z-2,P.y-c-1,c+2,n-P.y+c-P.w+1),this.ctx.clearRect(i-P.z,P.y-1,c,n-P.y+S.TICKSIZE+1-P.w),_.each(t,function(e,t){h.api.getProperty("Yaxes."+t+S.PROP_DISPLAY)&&h.renderY(t,i,n,d,y,g)})),this.m.x!==this.margin.x||this.m.z!==this.margin.z),x=((f||c||m)&&u&&(P=this.margin,t=S.TICKSIZE,u=this.calcTickWidth("Left"),x=this.calcTickWidth("Right"),l=_.some(this.y,function(e){return!0===e.display&&"Left"===e.position}),r=_.some(this.y,function(e){return!0===e.display&&"Right"===e.position}),o=_.some(this.x,function(e){return!0===e.display&&"Top"===e.position}),s=P.x-.5,a=P.z,u&&(u>P.x||!l)&&(s=u),x&&(x>P.z||!r)&&(a=u),this.ctx.clearRect(0,n-P.w+S.TICKSIZE,i,P.w-1+S.TICKSIZE),o&&this.ctx.clearRect(0,0,i,P.y-(!c||f||m?t:0)),this.ctx.clearRect(s,n-P.w,(l=r?i-s-a:i)+1,S.TICKSIZE),o&&this.ctx.clearRect(s,P.y-S.TICKSIZE,l+("Top"===d?.5:"Right"===d?-1:-.5),S.TICKSIZE-1),_.each(e,function(e,t){h.api.getProperty("Xaxes."+t+S.PROP_DISPLAY)&&h.renderX(t,i,n,d,y,g)})),this.margin),u=p.length?i-x.x-x.z-1:i;return this.ctx.clearRect(x.x,x.y-.5,u,n-x.w-x.y),this.drawXGridlines(i,n),this.drawYGridlines(i,n),this.ctx.globalAlpha=1,this.updateTheme(),_.each(this.x,function(e,t){return h.xBounds[t]=e.bounds}),_.each(this.y,function(e,t){return h.yBounds[t]=e.bounds}),this.m=this.margin,this.renderAll=!1,this.legendWidth=y,this.margin},x.prototype.renderAxes=function(){this.renderAll=!0},x.prototype.updateTheme=function(e){this.theme=e||this.theme,"Light"===this.theme?(this.ctx.strokeStyle="#000000",this.ctx.fillStyle="#000000"):(this.ctx.strokeStyle="#ffffff",this.ctx.fillStyle="#ffffff")},x.prototype.calcTickWidth=function(e){var i=this,t=0,e="Left"===e?_.map(this.x,function(e){return _.first(e.getSimpleTicks())}):_.map(this.x,function(e){return _.last(e.getSimpleTicks())});return e.length&&(e=_.map(e,function(e){return e?e.label:""}),(e=_.max(_.map(e,function(e,t){return i.x[t].measureText(i.ctx,e).width})))&&(t=Math.ceil(e/2)+1)),t},x.prototype.getStepSize=function(e,t,i){t=t&&t<e?Math.ceil(e/t):1;return"Category"===i.axisType&&(i=i.getTicksLength())<e&&(t<(e=Math.ceil(e/i))&&(t=e)),t},x.prototype.drawXGridlines=function(h,u){var c=this;_.each(this.x,function(e){var t=e.getSimpleTicks(),i=h-c.margin.x-c.margin.z-2,n=e.getGridlines(),r=_.maxBy(t,function(e){return e.label.length}),r=e.measureText(c.ctx,(null==r?void 0:r.label)||"").width+12,r=0<Math.round(i/r)?Math.round(i/r):1,o=c.getStepSize(t.length,r,e);c.ctx.beginPath(),c.ctx.strokeStyle=n.color,c.ctx.globalAlpha=void 0!==n.opacity?n.opacity/100:.15;for(var s=0;s<t.length;s+=o){var a=Math.round(c.margin.x+t[s].pos*i)-.5,l=(0!==s||!n.offset||(l=a/2)>c.margin.x&&(c.ctx.moveTo(l,u-c.margin.w),c.ctx.lineTo(l,c.margin.y)),n.offset?s===t.length-1?c.canvas.width-c.margin.z:c.margin.x+t[s+1].pos*i:0),a=n.offset?a+Math.abs(a-l)/2:a;a<h-c.margin.z&&(c.ctx.moveTo(a,u-c.margin.w),c.ctx.lineTo(a,c.margin.y))}c.ctx.stroke(),c.ctx.closePath()})},x.prototype.drawYGridlines=function(h,u){var c=this;_.each(this.y,function(e){for(var t=e.getSimpleTicks(),i=u-c.margin.w,n=i-c.margin.y,r=e.getGridlines(),o=(c.ctx.beginPath(),c.ctx.strokeStyle=r.color,c.ctx.globalAlpha=void 0!==r.opacity?r.opacity/100:.15,c.getStepSize(t.length,null,e)),s=0;s<t.length;s+=o){var a=Math.round(i-t[s].pos*n),l=r.offset?0===s?i:i-t[s-1].pos*n:0,l=r.offset?l-Math.abs(a-l)/2-.5:a+.5;c.ctx.moveTo(c.margin.x,l),c.ctx.lineTo(h-c.margin.z-1,l)}c.ctx.stroke(),c.ctx.closePath()})},x.prototype.getHeight=function(e){return _.sumBy(e,function(e){return e.display?e.getBaseSize(e.fontSize):0})},x.prototype.getWidth=function(e){var i=this;return _.sumBy(e,function(e){var t=e.getSimpleTicks(),t=_.maxBy(t,function(e){return e.label.length}),t=e.measureText(i.ctx,(null==t?void 0:t.label)||"");return e.display?e.getBaseSize(t.width):0})},x.prototype.renderX=function(e,t,i,n,r,o){function s(e,t,i,n){return t<=e&&!i?e:t<=e&&i?n+(e-n):n}var e=this.x[e],a=e.getSimpleTicks(),l=this.x.filter(function(e){return"Top"===e.position&&e.display}),h=this.x.filter(function(e){return"Bottom"===e.position&&e.display}),u=this.getHeight(l)+("Top"===n?o:0)+5,c="Top"===e.position,p=_.some(this.y,function(e){return!0===e.display&&"Left"===e.position}),d=_.some(this.y,function(e){return!0===e.display&&"Right"===e.position}),y=p?this.margin.x:"Left"===n?r:0,r="Right"===n?r:this.margin.z,g=this.legend.getRulesHeight(),f=(f=this.getHeight(h)+g+("Bottom"===n?o:0))||5,m=c?("Top"===n?o:0)+5+this.getHeight(l.slice(l.indexOf(e))):this.margin.y,P=c?0:this.getHeight(h.slice(h.indexOf(e)))+g+("Bottom"===n?o:0),l=s(this.calcTickWidth("Left"),this.margin.x,p,y),h=s(this.calcTickWidth("Right"),this.margin.z,d,r),x=y=y<l?l:y,v=t-y-(r=r<h?h:r)-3,g=_.maxBy(a,function(e){return e.label.length}),n=e.measureText(this.ctx,(null==g?void 0:g.label)||"").width+12,o=0<Math.round(v/n)?Math.round(v/n):1,O=this.getStepSize(a.length,o,e);this.ctx.beginPath(),this.ctx.moveTo(y-.5,c?m-.5:i-P+.5),this.ctx.lineTo(t-r-.5,c?m-.5:i-P+.5);for(var L=0;L<a.length;L+=O){var b=Math.round(x+a[L].pos*v)+.5;this.ctx.moveTo(b,.5+(c?m:i-P)),this.ctx.lineTo(b,.5+(c?m-S.TICKSIZE:i-P+S.TICKSIZE))}this.ctx.stroke(),this.ctx.closePath(),this.ctx.textBaseline=c?"bottom":"top",this.ctx.textAlign="center",this.ctx.font=e.fontSize+"px "+S.FONTFACE;for(L=0;L<a.length;L+=O)0===(b=x+a[L].pos*v)&&(b=10),this.ctx.fillText(a[L].label,b+.5,c?m-S.TICKSIZE-.5:i-P+S.TICKSIZE+.5);e.displayTitle&&(this.ctx.textBaseline="middle",this.ctx.font=e.titleFontSize+"px "+S.FONTFACE,this.ctx.fillText(e.title,(t+y-r)/2,c?m-e.titleFontSize-15:i-P+e.titleFontSize+15)),this.margin=new I(y,u,r,f)},x.prototype.renderY=function(e,t,i,n,r,o){var s,e=this.y[e],a=this.x.length&&_.some(this.x,function(e){return e.display}),l=this.getHeight(this.x.filter(function(e){return"Bottom"===e.position})),h=this.getHeight(this.x.filter(function(e){return"Top"===e.position})),u="Left"===e.position,c=this.y.filter(function(e){return"Left"===e.position&&e.display}),p=this.y.filter(function(e){return"Right"===e.position&&e.display}),d=this.getWidth(c)+("Left"===n?r:0),y=this.getWidth(p)+("Right"===n?r:0),g=y,a=Math.round(a?l:5)+this.legend.getRulesHeight()+("Bottom"===n?o:0),f=e.getSimpleTicks(),l=_.maxBy(f,function(e){return e.label.length}),l=e.measureText(this.ctx,(null==l?void 0:l.label)||""),h=h+(l.emHeightAscent||e.fontSize/2)+("Top"===n?o:0),o=this.getWidth(c.slice(c.indexOf(e)))+("Left"===n?r:0),g=u?g:this.getWidth(p.slice(p.indexOf(e)))+("Right"===n?r:0),m=this.calcTickWidth("Left")+("Left"===n?r:0),c=(m&&(c.length?d<m&&(d+=s=m-d,o+=s):d=m),this.calcTickWidth("Right")+("Right"===n?r:0)),P=(c&&(p.length?y<c&&(y+=s=c-y,g+=s):y=c),a=a||8,h=h||8,Math.floor(u?o:t-g+.5)+.5),x=i-a,v=x-h,O=this.getStepSize(f.length,null,e),m=(this.ctx.beginPath(),"Top"===n?2:6);this.ctx.moveTo(P-1,h-m),this.ctx.lineTo(P-1,1+x);for(var L=0;L<f.length;L+=O){var b=Math.round(x-f[L].pos*v)+.5;this.ctx.moveTo(P-1,b),this.ctx.lineTo(u?P-S.TICKSIZE-1:P+S.TICKSIZE,b)}this.ctx.stroke(),this.ctx.closePath(),this.ctx.textBaseline="middle",this.ctx.textAlign="Left"===e.position?"right":"left",this.ctx.font=e.fontSize+"px "+S.FONTFACE;for(L=0;L<f.length;L+=O){b=x-f[L].pos*v+.5;this.ctx.fillText(f[L].label,u?P-S.TICKSIZE:P+S.TICKSIZE,b)}e.displayTitle&&(this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.ctx.font=e.titleFontSize+"px "+S.FONTFACE,this.ctx.save(),this.ctx.translate(u?Math.abs(e.titleFontSize-P-2)-l.width:P+e.titleFontSize+l.width-2,(i-a+h)/2),this.ctx.rotate(u?-Math.PI/2:Math.PI/2),this.ctx.fillText(e.title,0,0),this.ctx.restore()),this.margin=new I(d,h,y,a)};var be=x;function x(e,t,i){this.api=e,this.canvas=t,this.legend=i,this.x=[],this.y=[],this.margin=new I(0,0,0,0),this.legendWidth=0,this.m=new I(0,0,0,0),this.xBounds=[],this.yBounds=[],this.renderAll=!0;e=this.canvas.getContext("2d");if(!e)throw new Error("ChartGL: failed to get 2D context");this.ctx=e}O.prototype.getZoomDirection=function(){return this.direction},O.prototype.isDragging=function(){return null!==this.dragBounds},O.prototype.remove=function(){this.el.removeEventListener("mousedown",this.mouseDownHandler),document.removeEventListener("mousemove",this.mouseOverHandler,{capture:!0}),document.removeEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.removeEventListener("mousemove",this.mouseMoveHandler,{capture:!0})},O.prototype.resize=function(e,t,i,n){this.el.style.left=e+"px",this.el.style.top=t+"px",this.el.style.width=i+"px",this.el.style.height=n+"px"},O.prototype.createMask=function(){var e=document.createElementNS(O.SVG_NS,"path");return this.el.append(e),e},O.prototype.createDragLine=function(){var e=document.createElementNS(O.SVG_NS,"line");return e.setAttribute("class","drag-line"),e.setAttribute("stroke-dasharray","8,4"),this.el.append(e),e},O.prototype.createLines=function(){var t=this;return _.times(2,function(){var e=document.createElementNS(O.SVG_NS,"line");return t.el.append(e),e})},O.prototype.createRect=function(){var e=document.createElementNS(O.SVG_NS,"rect");return e.style.fill="none",this.el.append(e),e},O.prototype.onOverlayMouseDown=function(e){if(0!==e.button)return this.onOverlayMouseUp(e);if(this.clickTime){if(Date.now()-this.clickTime<325)return this.onOverlayMouseUp(e),this.onReset();this.clickTime=Date.now()}else this.clickTime=Date.now();this.bounds=this.el.getBoundingClientRect(),this.downPoint=new w(e.clientX-this.bounds.left,e.clientY-this.bounds.top),document.body.style["pointer-events"]="none",document.addEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.addEventListener("mousemove",this.mouseMoveHandler,{capture:!0}),e.preventDefault(),e.stopPropagation()},O.prototype.onOverlayMouseMove=function(e){if(e.stopPropagation(),this.bounds&&this.downPoint){var t,i=this.bounds.right-this.bounds.left,n=this.bounds.bottom-this.bounds.top,r=N.limitWithin(e.clientX,this.bounds.left,this.bounds.right)-this.bounds.left,o=N.limitWithin(e.clientY,this.bounds.top,this.bounds.bottom)-this.bounds.top,s=Math.min(this.downPoint.x,r),a=Math.min(this.downPoint.y,o),l=Math.abs(this.downPoint.x-r),h=Math.abs(this.downPoint.y-o),e=((e=t=t||{})[e.XY=0]="XY",e[e.X=1]="X",e[e.Y=2]="Y",t.XY);switch(l<O.SNAP_SZ&&h<O.SNAP_SZ?((u=l/h)<O.ASPECT_RATIO||1/O.ASPECT_RATIO<u)&&(e=u<1?t.Y:t.X):l<O.SNAP_SZ?e=t.Y:h<O.SNAP_SZ&&(e=t.X),e){case t.X:a=0,h=n;break;case t.Y:s=0,l=i}this.dragBounds=new I(s,a,s+l,a+h);var u=N.calculateBoundsDiagonal(this.dragBounds);if(0<u?(this.mask=this.mask||this.createMask(),this.mask.setAttribute("d","M0,0H"+i+"V"+n+"H0V0M"+(Math.round(s)+.5)+","+(Math.round(a)+.5)+"v"+h+"h"+l+"v-"+h+"h-"+l+"Z")):this.removeMask(),15<u)switch(this.dragLine=this.dragLine||this.createDragLine(),e){case t.X:this.direction="x",this.lines=this.lines||this.createLines(),this.removeRect(),this.dragLine.x1.baseVal.value=this.downPoint.x+.5,this.dragLine.y1.baseVal.value=this.downPoint.y+.5,this.dragLine.x2.baseVal.value=.5+r,this.dragLine.y2.baseVal.value=this.downPoint.y+.5,this.lines[0].x1.baseVal.value=this.downPoint.x+.5,this.lines[0].y1.baseVal.value=0,this.lines[0].x2.baseVal.value=this.downPoint.x+.5,this.lines[0].y2.baseVal.value=n,this.lines[1].x1.baseVal.value=.5+r,this.lines[1].y1.baseVal.value=0,this.lines[1].x2.baseVal.value=.5+r,this.lines[1].y2.baseVal.value=n;break;case t.Y:this.direction="y",this.lines=this.lines||this.createLines(),this.removeRect(),this.dragLine.x1.baseVal.value=this.downPoint.x+.5,this.dragLine.y1.baseVal.value=this.downPoint.y+.5,this.dragLine.x2.baseVal.value=this.downPoint.x+.5,this.dragLine.y2.baseVal.value=.5+o,this.lines[0].x1.baseVal.value=0,this.lines[0].y1.baseVal.value=this.downPoint.y+.5,this.lines[0].x2.baseVal.value=i,this.lines[0].y2.baseVal.value=this.downPoint.y+.5,this.lines[1].x1.baseVal.value=0,this.lines[1].y1.baseVal.value=.5+o,this.lines[1].x2.baseVal.value=i,this.lines[1].y2.baseVal.value=.5+o;break;default:this.direction="xy",this.rectangle=this.rectangle||this.createRect(),this.removeLines(),this.dragLine.x1.baseVal.value=this.downPoint.x+.5,this.dragLine.y1.baseVal.value=this.downPoint.y+.5,this.dragLine.x2.baseVal.value=.5+r,this.dragLine.y2.baseVal.value=.5+o,this.rectangle.x.baseVal.value=this.downPoint.x<r?this.downPoint.x+.5:.5+r,this.rectangle.y.baseVal.value=this.downPoint.y<o?this.downPoint.y+.5:.5+o,this.rectangle.width.baseVal.value=l,this.rectangle.height.baseVal.value=h}else this.removeDragLine(),this.removeLines(),this.removeRect()}},O.prototype.onOverlayMouseOver=function(e){var t=this.el.getBoundingClientRect();if(e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom)return this.onOver(null);var i=e.clientX-t.left,e=e.clientY-t.top;this.onOver(new w(i/(t.right-t.left),e/(t.top-t.bottom)))},O.prototype.onOverlayMouseUp=function(e){var t;this.bounds&&(document.body.style["pointer-events"]="auto",document.removeEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.removeEventListener("mousemove",this.mouseMoveHandler,{capture:!0}),e.stopPropagation(),this.dragBounds&&N.calculateBoundsDiagonal(this.dragBounds)>O.SNAP_SZ/3?(e=this.bounds.right-this.bounds.left,t=this.bounds.bottom-this.bounds.top,this.onZoom(new I(this.dragBounds.x/e,this.dragBounds.y/t,this.dragBounds.z/e,this.dragBounds.w/t))):this.onClick(),this.removeMask(),this.removeDragLine(),this.removeLines(),this.removeRect(),this.dragBounds=null)},O.prototype.removeDragLine=function(){this.dragLine&&this.el.removeChild(this.dragLine),this.dragLine=void 0},O.prototype.removeLines=function(){var t=this;this.lines&&this.lines.forEach(function(e){return t.el.removeChild(e)}),this.lines=void 0},O.prototype.removeRect=function(){this.rectangle&&this.el.removeChild(this.rectangle),this.rectangle=void 0},O.prototype.removeMask=function(){this.mask&&this.el.removeChild(this.mask),this.mask=void 0},O.SVG_NS="http://www.w3.org/2000/svg",O.SNAP_SZ=28,O.ASPECT_RATIO=.45;var Se=O;function O(e,t,i,n,r){this.direction="",this.dragBounds=null,this.el=e,this.onOver=t,this.onZoom=i,this.onReset=n,this.onClick=r,this.mouseDownHandler=this.onOverlayMouseDown.bind(this),this.mouseUpHandler=this.onOverlayMouseUp.bind(this),this.mouseMoveHandler=this.onOverlayMouseMove.bind(this),this.mouseOverHandler=this.onOverlayMouseOver.bind(this),this.el.addEventListener("mousedown",this.mouseDownHandler),document.addEventListener("mousemove",this.mouseOverHandler,{capture:!0})}B.convertGroupedBarsData=function(e,t){t=B.convertBarsOrLineFillData(e,t);return B.calcBarData(e,t.scalar,t.nullVal)},B.hexColorToVec4=function(e,t){e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e&&4===e.length?new I(parseInt(e[1],16)/256,parseInt(e[2],16)/256,parseInt(e[3],16)/256,t/100):new I(.5,.5,.5,1)},B.calcBarData=function(i,n,r){var o=[],e=i.calcRange(),s=N.getMidrange(new w(e[0],e[1]),i.qtype);return _.each(i,function(e,t){t=n(i,t);N.isNull(t,r)&&(t=0),t=Number(s?N.toBigInt(t)-s:t),o.push(t)}),o},B.convertBarsOrLineFillData=function(e,t){var i;return i=e,e=t,t=N.getNullVal(e),{scalar:e=N.isString(e)?function(e,t){return N.getColValue(i,t)}:N.isLong(e)?function(e,t){if("bigint"==typeof e.calcRange()[0])return i.getScalar(t);e=i.getLegacyScalar(t);return N.isNull(e)?e.toString():N.toBigInt(e)}:function(e,t){return Number(i.getScalar(t))},nullVal:t}},B.prototype.convertFillToLayerData=function(){var i=this,n=[],r={fill:"",cols:null,toBounds:null,fromBounds:null};return this.yCols.forEach(function(e,t){n[t]=i.convertData(N.isWebGL2,e,"y",{lineFill:r})}),n},B.prototype.getBarWidth=function(){return this.barWidth},B.prototype.getCategoryData=function(e){return"x"===e?this.xCategoryData:this.yCategoryData},B.isDoubleOrLongTemporal=function(e){return e===D.DateTime||e===D.Timestamp||e===D.Timespan},B.prototype.remove=function(t){_.each(this.buffers,function(e){t.deleteBuffer(e)})},B.prototype.render=function(s,i,n,a,l,h,u,c,p){var d=this,y="Bubble"===l||""===l?s.POINTS:"Line"===l?s.LINE_STRIP:s.TRIANGLES,g=0;this.shaders.forEach(function(r,o){var e=u?g:o,t=(void 0!==r&&(s.useProgram(r.Program),"Candlestick"===l||u?r.xBinding.apply(s,d.buffers[e]):(t="Bar"===l&&1<c.length?o:0,r.xBinding.apply(s,d.buffers[t])),null!=p&&r.setTexture(s,p)),"Candlestick"===l?d.colorBuffers[0]:d.colorBuffers[o]),e="Bar"===l&&1<c.length?o+d.buffers.length/2:e+("Candlestick"===l?2:1);r.yBinding.apply(s,d.buffers[e]),t&&r.colorLocation&&r.colorLocation.apply(s,t),d.sizeBuffer&&r.sizeLocation&&r.sizeLocation.apply(s,d.sizeBuffer),_.each([new w(i.x,i.z),new w(i.y,i.w)],function(e,t){var i=0===t?r.xRange:r.yRange,n=0===t?d.tx:d.tys[o],e=e.applyFn(function(e){return N.convertJSToScalar(n,e)});N.isLong(n)?(t=(0===t?d.xCol:d.yCols[o]).calcRange(),(t=N.getMidrange(new w(t[0],t[1]),n))&&(e=new w(N.toBigInt(e.x)-t,N.toBigInt(e.y)-t)),t=new w(E.Long.fromString(e.x.toString().split(".")[0]),E.Long.fromString(e.y.toString().split(".")[0])),i.set(s,t.applyFn(N.toNumber))):i.set(s,e.applyFn(N.toNumber))}),r.color&&(e=B.hexColorToVec4(n[o%n.length],h),r.color.set(s,e)),r.pointSize&&r.pointSize.set(s,a),d.drawGL(s,y),g+=2})},B.prototype.updatePointSizeOnZoom=function(i,e){var n=[];this.pointSizes&&(_.each(this.pointSizes,function(e){var t=e*i;n.push(t<e?e:t)}),this.sizeBuffer=A.createBuffer(e,new Float32Array(n)))},B.prototype.convertData=function(e,t,i,n,r,o){var s,a=t.qtype,l=r&&void 0!==r.barWidth,h=null==n?void 0:n.lineFill,e=(!e&&N.isInt(a)&&(s=N.intToFloat(t),a=D.Float),"Category"===this.axisTypes[i]);if(e&&(s=(u=N.getCategoryData(t))[1],"x"===i&&(this.xCategoryData=u),"y"===i&&(this.yCategoryData[0].push(u[0]),this.yCategoryData[1].push(s))),e||l||"Candlestick"===i||h||null!=n&&n.spanGaps){if(l||null==n||!n.spanGaps?e||(u=B.convertBarsOrLineFillData(t,a),s=B.calcBarData(t,u.scalar,u.nullVal)):null!=n&&n.spanGaps&&null!=n&&n.xCol&&(e=void 0,"Category"===this.axisTypes.x&&(this.xCategoryData=N.getCategoryData(null==n?void 0:n.xCol),e=this.xCategoryData[1]),e=(u=function(e,t,i){if("Category"===e)return{col:i,scalar:function(e,t){return e[t]}};e=B.convertBarsOrLineFillData(t,t.qtype);return{col:t,scalar:e.scalar,nullVal:e.nullVal}})(this.axisTypes.x,null==n?void 0:n.xCol,e),u=u(this.axisTypes.y,t,s),s=V.spanGaps(e,u)),"Candlestick"===i||"GroupedBars"===i)return s;if(!l&&null!=h&&h.fill){e=new V;s=null!=n&&n.spanGaps?{x:e.getXLineFill(s.x),y:e.getYLineFill(s.y,h)}:"x"===i?e.getXLineFill(s):e.getYLineFill(s,h)}else if(l){var u=new H(this.tx,this.tys);if("x"===i){if(!r.mergedBounds)throw"Missing merged";if("Fixed Width"===r.barType&&void 0===r.chartWidth)throw"Missing width";e=N.convertVec4ToScalar(r.mergedBounds,this.tx,this.tys[0]);s=u.getXBarPoints(s,r,e,o),this.barWidth=u.getBarWidth()}else s=u.getYBarPoints(s)}null!=n&&n.spanGaps?s=[this.getXData(s.x),this.getYData(s.y)]:(l||null!=h&&h.fill)&&(s="x"===i?this.getXData(s):this.getYData(s))}else s=N.isString(a)?[]:N.isDouble(a)?N.floatToEmulateDoubleArray(t):N.isLong(a)?N.longToEmulateDoubleArray(t):s||t.toTypedArray();return s},B.prototype.drawGL=function(e,t){var i=this.count;t===e.TRIANGLES&&(i*=6),e.drawArrays(t,0,i)},B.prototype.getPointSizes=function(i,n,r){var o=[],e=i.qtype,s=N.isLong(e)?function(e,t){return Number("bigint"==typeof e?i.getScalar(t):i.getLegacyScalar(t).toString())}:function(e,t){return i.getScalar(t)};return _.each(i,function(e,t){t=s(i,t);o.push(t*(n*(r?1.333:1)))}),o},B.prototype.getXData=function(e){if(B.isDoubleOrLongTemporal(this.tx)){for(var t=new Float32Array(2*e.length),i=0,n=0;n<t.length;n+=2){var r=e[i++];t[n]=r,t[n+1]=r-Math.fround(r)}return t}return new Float32Array(e)},B.prototype.getYData=function(r){var o=new Float32Array(0);return _.each(this.tys,function(e){if(B.isDoubleOrLongTemporal(e)){o=new Float32Array(2*r.length);for(var t=0,i=0;i<o.length;i+=2){var n=r[t++];o[i]=n,o[i+1]=n-Math.fround(n)}}}),o.length?o:new Float32Array(r)},B.prototype.processCandlesticks=function(e,i,s,t,a,l){var h=this,n=[],u=(e.forEach(function(e,t){n[t]=h.convertData(i,e,"Candlestick")}),l.mergedBounds),e=[n[1],n[2]],r=[n[0],n[3]],c=new H(this.tx,this.tys),p=this.convertData(i,t,"Candlestick"),d=[],y=a[5];[e,r].forEach(function(e,t){var i=0===t,n=i?a[3]/10:a[3],r=i?void 0:a,o=Math.abs(u.w-u.y)||0,e=c.getCandlesticks(e,o,r),o=(i||(d=e[1]),l=g(g({},l),{barType:y,barWidth:n}),h.buffers[t]=A.createBuffer(s,h.getXData(c.getXBarPoints(p,l,u))),h.buffers[t+2]=A.createBuffer(s,new Float32Array(e[0])),c.getBarWidth());o>h.barWidth&&(h.barWidth=o)}),d.length&&this.setColorArray(!1,!0,[d],s,!1)},B.prototype.setColorArray=function(o,t,e,i,s){var n=this,a=[];e&&e.length&&(e.forEach(function(e){var r;e=t?(r=[],_.each(e,function(e){for(var t=0;t<6;++t){var i,n=e;o&&s&&(i=1===t||2===t||4===t?0:e[3],n=[e[0],e[1],e[2],i]),r.push(Array.prototype.concat.apply([],n))}}),new Float32Array(Array.prototype.concat.apply([],r))):(e=Array.prototype.concat.apply([],e),new Float32Array(e)),a.push(e)}),a.forEach(function(e,t){n.colorBuffers[t]=A.createBuffer(i,e)}))};var _e=B;function B(n,r,o,s,a,l,t,e,i,h,u,c,p,d){var y=this,g=(this.barWidth=0,this.buffers=[],this.colorBuffers=[],this.pointSizes=[],this.yCols=[],this.yCategoryData=[[],[]],this.count=Math.min(n.length,_.max(r.map(function(e){return e.length}))||0),this.tx="Category"===t.x?D.Float:n.qtype,this.tys=r.map(function(e){return"Category"===t.y?D.Float:e.qtype}),this.yCols=r,this.xCol=n,this.axisTypes=t,!s&&N.isInt(this.tx)&&(this.tx=D.Float),s||(this.tys=this.tys.map(function(e){return N.isInt(e)?D.Float:e})),this.shaders=new Array(e.length?2:r.length),this.buffers=new Array(e.length?4:r.length+1),p&&p[0]),f=!(!g||!g.fill||"No Fill"===g.fill),m=d&&void 0!==d.barWidth||f||0<e.length,P=m||l,x=!!p&&p[1],v={lineFill:g,spanGaps:l,xCol:n},g=p?c:u&&u.length?u:i&&i.length?i:null,O=(g&&g.length&&this.setColorArray(f,m,g,o,x),h[0]&&(this.pointSizes=this.getPointSizes(h[0],h[1],a),this.sizeBuffer=A.createBuffer(o,new Float32Array(this.pointSizes))),B.isDoubleOrLongTemporal(this.tx)),p=null==d?void 0:d.mergedBounds;if(e.length&&p&&null!=d&&d.chartWidth){var L=r.map(function(e){return e.qtype}).map(function(e){return N.isInt(e)?D.Float:e}),b=B.isDoubleOrLongTemporal(L[0]);this.processCandlesticks(r,s,o,n,e,d);for(var S=0;S<this.shaders.length;S++){var C=0===S?void 0:this.colorBuffers[0],C=A.getShader(o,s,O?this.tx:D.Float,b?L[0]:D.Float,a,void 0!==C,void 0!==this.sizeBuffer);this.shaders[S]=C,o.useProgram(C.Program)}}else{var R=0,T=(d&&d.barGrouping&&1<r.length?r.forEach(function(e,t){var i=y.convertData(s,n,"x",v,d,t);y.buffers[t]=A.createBuffer(o,i)}):l||(c=this.convertData(s,n,"x",v,d),this.buffers[0]=A.createBuffer(o,c)),_.clone(this.buffers).length);this.yCategoryData=[[],[]],r.forEach(function(e,t){var i=B.isDoubleOrLongTemporal(y.tys[t]),i=A.getShader(o,s,P&&!O?D.Float:y.tx,P&&!i?D.Float:y.tys[t],a,void 0!==y.colorBuffers[t],void 0!==y.sizeBuffer),i=(y.shaders[t]=i,o.useProgram(i.Program),y.convertData(s,e,"y",v,d));l?(y.buffers[R]=A.createBuffer(o,i[0]),y.buffers[R+1]=A.createBuffer(o,i[1]),R+=2):(e=d&&d.barGrouping&&1<r.length?t+(T-1):t+1,y.buffers[e]=A.createBuffer(o,i))})}}L.getConditionResult=function(e,t,i){var n,r,o=!1,s=isNaN(parseFloat(e))||_.isObject(e)?(""+e).toLowerCase():parseFloat(e),a=isNaN(parseFloat(t))||_.isObject(t)?(""+t).toLowerCase():parseFloat(t);switch(e&&e.class&&0<=["1212","1213","1214","1215"].indexOf(e.class)?(s=E.Tools.convertKDBTemporalToMoment(e).unix(),"in"===i?(n=[],_.each(t.toString().split(","),function(e){n.push(E.Tools.convertDateStringValueToMoment(e).unix()),a=n.toString()})):a=E.Tools.convertDateStringValueToMoment(t).unix()):e&&e.class&&0<=["1216","1217","1218","1219"].indexOf(e.class)&&(s=E.Tools.convertKDBTemporalToMoment(e).valueOfNano(),"in"===i?(r=[],_.each(t.toString().split(","),function(e){r.push(E.Tools.convertDateStringValueToMoment(e).valueOfNano()),a=r.toString()})):a=E.Tools.convertDateStringValueToMoment(t).valueOfNano()),i){case"contains":o=0<=s.toString().indexOf(a.toString());break;case"starts with":o=0===s.toString().indexOf(a.toString());break;case"ends with":o=-1!==s.toString().indexOf(a.toString(),s.toString().length-a.toString().length);break;case"==":o=s===a;break;case"<":o=s<a;break;case">":o=a<s;break;case"<=":o=s<=a;break;case">=":o=a<=s;break;case"!=":o=s!==a;break;case"in":o=0<=a.toString().split(",").indexOf(s.toString());break;case"search":o=!!s.toString().match(a.toString());break;case"regexp":o=new RegExp(t.toString()).test(e?e.toString():"")}return o},L.getScalarResult=function(e,t,i,n,r){var o=e.getScalar(t);if(r&&N.isNull(o,N.getNullVal(e.qtype)))return null;switch("bigint"==typeof o&&"bigint"!=typeof i&&(i=N.toLong(i)),n){case"==":return o===i;case"<":return o<i;case">":return i<o;case"<=":return o<=i;case">=":return i<=o;case"!=":return o!==i}},L.interpolateColor=function(e,t,i,n){if(!e.length)return"";for(var i=(i-t)/(e.length-1),n=this.clamp((n-t)/i,0,e.length-1),n=_.isNaN(n)?0:n,t=e[Math.floor(n)].type,i=e[Math.ceil(n)].type,r=this.hex2RGB(t),o=this.hex2RGB(i),s=n-Math.floor(n),a=r.slice(),l=0;l<3;l++)a[l]=Math.round(a[l]+s*(o[l]-r[l]));return this.RGB2hex(a)},L.clamp=function(e,t,i){return i<e?i:e<t?t:e},L.hex2RGB=function(e){e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:[255,255,255]},L.RGB2hex=function(e){return"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1)};var Ce=L;function L(){}Te.prototype.computeHighlightRules=function(r,e,t,i,o,n,s,a,l,h){var u=this;if(!o)return[""];var c={},p=(_.each(_.keys(o),function(e){c[e]=o[e]}),[]),d=[],y=i.length?i:t,g=e;if(r||s){var f,m=r.map(function(e){return new RegExp((e.RuleTarget||"*").replace(/\*/g,"(.*)$"))});if(c[y]){for(var P=0;P<c[y].length;P++){h&&h.length&&(g=h[P]);var x=r.length?this.computeColorInternal(y,P,r,m,c,l):a;p.push(void 0!==x?x:g)}d.push(p)}else N.isRegexOrWild(i)&&("*"===i&&delete n[t],f=0,_.each(n,function(e,t){p=[];for(var i=0;i<e.length;i++){var n=r.length?u.computeColorInternal(t,i,r,m,o,l):a[f];p.push(n||(h&&h.length&&h[f]?h[f][i]:g[f]))}f++,d.push(p)}));return d}return[g]},Te.prototype.getColorArray=function(e,i,n,r){var o,t=[];return _.each(e,function(e){o=[],_.each(e,function(e){var t=_e.hexColorToVec4(e,n?r:i);o.push(Object.keys(t).map(function(e){return t[e]}))}),t.push(o)}),t},Te.prototype.computeColorInternal=function(a,l,e,h,u,c){var p,d={};return e.forEach(function(e,t){if(h[t].test(a)&&e.RuleSource){var t=u[e.RuleSource],i=null==t?void 0:t.qtype;if((3<i&&i<11||11<i&&i<20)&&{"==":!0,"<":!0,">":!0,"<=":!0,">=":!0,"!=":!0}[e.RuleOperation]&&!N.isIE11)return i=N.convertStringToScalar(e.RuleValue,N.ipcTemp(i)),void((t=Ce.getScalarResult(t,l,i,e.RuleOperation,c))?p=e.RuleColor:null===t&&(p=""));_.each(_.keys(u),function(e){d[e]=u[e].getValue(l)});var n,i=e.RuleSource,r=d[i];if(c&&null===r)p="";else{if(r&&"object"==typeof r&&!r.i){for(var o="",s=0;s<r.length;s++)o+=""+r.getValue(s);r=o}"gradient"===e.RuleType?(t=e.Palette,i=e.RuleMin,n=e.RuleMax,p=Ce.interpolateColor(t,i,n,r)):e.RuleOperation&&(t=e.RuleOperation,i=e.RuleValue,Ce.getConditionResult(r,i,t)&&(p=e.RuleColor))}}}),p};var Re=Te;function Te(){}Ae.prototype.getJSDataBounds=function(e){var t=this.xCol.qtype,i=this.yCols[0]?this.yCols[0].qtype:t;return N.convertVec4ToJsScalar(e,t,i)},Ae.prototype.createRenderer=function(e,t,i,n,r,o,s,a,l,h,u){var c;return h&&u&&(l||r.length)&&(c={barGrouping:l,barWidth:this.barWidth,barType:this.barType,mergedBounds:h,chartWidth:u}),new _e(this.xCol,this.yCols,e,t,i,n,s,r,o,this.radiusInfo,this.highlightRules,this.lineFillColors,a,c)},Ae.prototype.getPoint=function(t){function e(e){return N.getColValue(e,t)}return[e(this.xCol)].concat(this.yCols.map(e))};var Ee=Ae;function Ae(e,t,i,n,r,o,s,a){this.xCol=e,this.yCols=t,this.yColNames=i,this.barWidth=n,this.barType=r,this.radiusInfo=o,this.highlightRules=s,this.lineFillColors=a}Object.defineProperty(b.prototype,"RenderState",{get:function(){return this.renderState},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"Config",{get:function(){return this.config},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"Renderer",{get:function(){return this.renderer},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"XType",{get:function(){return this.config?this.config.xCol.qtype:null},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"YType",{get:function(){return this.config&&this.config.yCols.length?this.config.yCols[0].qtype:null},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"datasourceError",{get:function(){var e;return null==(e=null==(e=this.datasource)?void 0:e.attributes)?void 0:e.error},enumerable:!1,configurable:!0}),b.prototype.getConvertedCategoryData=function(e,t,i){var n=this.getAllCategoryData(t);return n&&n[1]?(n=n[1],("y"===t&&void 0!==i?n[i]:n)[e]):[]},b.prototype.getAllPointsFromRelativeX=function(){return this.points},b.prototype.getAxisId=function(e){return this.api.getProperty(this.indexProp(e.toUpperCase()+"AxisId")).replace(/.*?(\d+)$/,"$1")-1},b.prototype.getAxisType=function(e){var t=this.getAxisId(e),e=e.toUpperCase()+"axes.";return this.api.getProperty(e+t+".Type")},b.prototype.getBarType=function(){return this.api.getProperty(this.indexProp(b.PROP_BARWIDTHTYPE))},b.prototype.getClosestPointFromRelativeX=function(n,t,e,r){var o=this;if(!this.config)return null;function i(e){return"Category"===l?o.getConvertedCategoryData(e,"x"):N.getColValue(a,e)}var s=this.config,a=s.xCol,l=this.getAxisType("x");if("Linear"===l&&a.hasIndex&&a.hasIndex())h=a.length,c=function(e){return a.getIndexFromSortedIndex(e)};else{if(!this.workerIndex.length)return null;var h=this.workerIndex.length,u=this.workerIndex,c=function(e){return u[e]}}function p(e){for(var t=s.getPoint(c(e)),i=1;i<t.length;i++){var n=t[i],n=("Category"===o.getAxisType("y")&&(n=e/o.workerIndex.length),N.calculateRelativeValue(n,r.y,r.w));if(0<=n&&n<=1)return 1}}function d(e,t){for(var i=[];t?0<=e:e<h;)m(e)||i.push(e),t?e--:e++;return i.length?o.getClosestXPoint(i,r,s,c,n):e}var y,g=N.isLong(a.qtype)&&"Linear"===l,f=(y=g?(y=Math.round(n*e),N.isIE11?(r=r.applyFn(N.toLong)).x.add(new E.Long(y).mul(r.z.sub(r.x)).div(new E.Long(e))):N.toBigInt(r.x)+N.toBigInt(y)*(N.toBigInt(r.z)-N.toBigInt(r.x))/N.toBigInt(e)):Number(r.x)+n*(Number(r.z)-Number(r.x)),0<=(e="Linear"===l&&a.hasIndex&&a.hasIndex()?a.findIndex(y):g&&N.isIE11?E.Tools.binarySearch2(y,this.workerIndex,function(e,t){t=a.getLegacyScalar(t);return e.compare(t)}):E.Tools.binarySearch2(y,this.workerIndex,function(e,t){t=i(t);return t<e?1:e<t?-1:0}))?P=e:(P=-e-2)+1),m=function(e){var e=s.getPoint(c(e)),t=e[0],e=e.slice(1);return!N.isString(o.XType)&&isNaN(Number(t))||_.every(e,function(e){return!N.isString(o.YType)&&isNaN(Number(e))})};if(!N.isString(this.XType)){var P,e=s.getPoint(c(P)),x=s.getPoint(c(f)),e=isNaN(Number(e[0])),x=isNaN(Number(x[0]));if(e)P=d(P,!0);else if(m(P))for(;0<=P&&m(P);)P--;if(x)f=d(f,!1);else if(m(f))for(;f<h&&m(f);)f++;(e||x)&&(P=f=this.getClosestXPoint([P,f],r,s,c,n))}for(var v=[],O=[],L=s.getPoint(c(P)),b=s.getPoint(c(f));0<=P&&s.getPoint(c(P))[0]===L[0];)p(P)&&v.push(P),P--;for(;f<h&&s.getPoint(c(f))[0]===b[0];)p(f)&&O.push(f),f++;P=v.length?this.getY(v,r,s,c,t):P,f=O.length?this.getY(O,r,s,c,t):f;var S,e=_.union(v,O);if(this.api.getProperty("Overlay.ShowAllPoints")&&(S=[],_.each(e,function(e){S.push(o.isRegexOrWild()?o.getAllWildcards(e,r,s,c):[o.getClosestPoint(e,r,s,c,t)])}),this.points=S),P<0&&h<=f)return null;if(P<0)return this.getClosestPoint(f,r,s,c,t);if(h<=f)return this.getClosestPoint(P,r,s,c,t);var C,R,x=this.getY(e,r,s,c,t);return e=N.isIE11&&g?(C=y.sub(a.getLegacyScalar(c(P))),R=a.getLegacyScalar(c(f)).sub(y),C.equals(R)?x:C.lt(R)?P:f):(e=Number(i(c(P))),g=Number(i(c(f))),(C=Number(y)-e)===(R=g-Number(y))?x:C<R?P:f),this.getClosestPoint(e,r,s,c,t)},b.prototype.getAllCategoryData=function(e){var t;return(null==(t=this.renderer)?void 0:t.getCategoryData(e))||[]},b.prototype.getColorArr=function(e,t){return(t||0===t?this.colorArr[t]:this.colorArr)[e]},b.prototype.getColorData=function(){return this.colorDataInfo},b.prototype.getAllCols=function(){return _.get(this.yAxes,"length")||(this.yAxes=this.getYAxesVals()),_.union(this.yAxes,this.disabledColumns)},b.prototype.getFillToLayerData=function(){return this.renderer?this.renderer.convertFillToLayerData():[]},b.prototype.getGroupedBarData=function(){var e;return this.cols?(e=this.indexProp(b.PROP_XAXIS),e=this.api.getProperty(e),e=this.cols[e],_e.convertGroupedBarsData(e,e.qtype)):[]},b.prototype.getFillType=function(){return"Line"===this.propertyCache[b.PROP_TYPE]?this.propertyCache[b.PROP_FILL]:""},b.prototype.getId=function(){return this.uid},b.prototype.getLayerName=function(){return this.api.getProperty(this.indexProp("Name"))},b.prototype.getLayerType=function(){return this.propertyCache[b.PROP_TYPE]},b.prototype.getLegendGroup=function(){return this.api.getProperty(this.indexProp("LegendGroup"))},b.prototype.hasColorData=function(){var e=this.api.getProperty(this.indexProp(b.PROP_COLORDATA));return!this.isCandlestick()&&e&&"None"!==e},b.prototype.hasFixedWidth=function(){var e=this.api.getProperty(this.indexProp(b.PROP_TYPE)),t=this.getBarType();return"Bar"===e&&"Fixed Width"===t},b.prototype.hasPadding=function(){return"Line"!==this.propertyCache[b.PROP_TYPE]},b.prototype.hasTexture=function(){return!(!this.icon||!this.texture)},b.prototype.isBubble=function(){return"Bubble"===this.api.getProperty(this.indexProp(b.PROP_TYPE))},b.prototype.isCandlestick=function(){return"Candlestick"===this.api.getProperty(this.indexProp(b.PROP_TYPE))},b.prototype.isEnabled=function(){return!0===this.api.getProperty(this.indexProp(b.PROP_ENABLED))},b.prototype.updateLayerPalette=function(e,t,i){e&&(this.disabledColumns=e);var e=!1,n=this.getPaletteProperty(),t=(this.palette=t?n:this.getUpdatedPalette(n),this.api.getProperty(this.indexProp(b.PROP_FILL))&&(n=this.getPaletteProperty(!0),this.fillPalette=t?n:this.getUpdatedPalette(n)),this.hasColorData()&&this.cols&&(t=this.propertyCache[b.PROP_COLORDATA],n=this.calculateColorData(t),this.setColorData(n),e=!0),this.propertyCache[b.PROP_HIGHLIGHTRULES]),n=(t&&t.length&&(this.onHighlightRuleChange(t),e=!0),this.propertyCache[b.PROP_FILL]);return n&&"No Fill"!==n&&(e=!0,(t&&t.length||this.propertyCache[b.PROP_FADE])&&this.onLineFillChange(t)),i&&e&&this.configure(),this.palette},b.prototype.getRowData=function(t){if(!this.cols)return null;var i=this.cols,n={};return _.each(_.keys(i),function(e){n[e]=i[e].getValue(t),n[e]&&"object"==typeof n[e]&&!E.Tools.isKDBTemporal(n[e])&&(n[e]=N.getValueFromObject(n[e]))}),n},b.prototype.getColumnKeysFromAxisString=function(e){var t,i=/\/[gimsuy]*$/,n="",r=(0===e.indexOf("/")?(t=e.substring(1).replace(i,""),n=(i=e.match(i))?i[0].substring(1):""):t="^"+(e=e.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\*/g,"(.*)")+"$",new RegExp(t,n));return this.columns.filter(function(e){return e.match(r)})},b.prototype.getDataRangeX=function(){if(this.cols&&this.hasData()){var e=this.cols[this.api.getProperty(this.indexProp(b.PROP_XAXIS))];if("Category"===this.getAxisType("x"))return new w(0,1);var t=e.calcRange&&e.length?e.calcRange():[0,1];return N.convertVec2ToJsScalar(new w(t[0],t[1]),e.qtype,e.qtype)}return new w(0,1)},b.prototype.getDataRangeY=function(){if(this.cols&&this.hasData()){var e=_.difference(this.yAxes,this.disabledColumns),t=this.cols,e=e.map(function(e){return t[e]}).filter(function(e){return e});if("Category"===this.getAxisType("y"))return new w(0,1);e=e.map(function(e){var t=e.calcRange?e.calcRange():[0,1];return N.convertVec2ToJsScalar(new w(t[0],t[1]),e.qtype,e.qtype)});return N.mergeRange(e)||new w(0,1)}return new w(0,1)},b.prototype.isBar=function(){return"Bar"===this.api.getProperty(this.indexProp(b.PROP_TYPE))},b.prototype.getPaddedRange=function(e,t,i){var n,r,o,s,a,l=e.applyFn(v.isMoment),h=e.applyFn(v.isDuration),u=e.applyFn(N.convertJSToNumber),c=this.propertyCache[b.PROP_TYPE],p="Bar"===c,d=u.x,y=u.z,g=u.y,f=u.w,m=!0,P=!0,x=(u.y===u.w&&(P=(!l.y&&!h.y||e.y.nanosecond()===e.w.nanosecond())&&P)&&(f+=x=Math.abs(.01*g),g-=x),u.x===u.z&&(m=(!l.x&&!h.x||e.x.nanosecond()===e.z.nanosecond())&&m)&&(y+=x=Math.abs(.01*d),d-=x),0),i=(p&&i&&(r=this.getBarType(),o=y-d,a=i.allBarLayers.indexOf(this),s=(a=i.layersCommonXAxis[a]).length,x=("Percentage"===r?(r=a.indexOf(this),o/i.dataLengths[r]/(s+1)*(this.api.getProperty(this.indexProp(b.PROP_BARPERCENT))/100)):o*(this.api.getProperty(this.indexProp(b.PROP_BARFIXED))/t.x))*s),p||this.isCandlestick()?(n=x||(null==(a=this.renderer)?void 0:a.getBarWidth())||0,i=(f-g)*b.BAR_MIN_RELATIVE_SZ,r=p&&0<f&&0<g?Math.max(0,g-i):g,o=p&&f<0?Math.min(0,f+i):f,u=new I(d-n,r,y+n,o)):"Bubble"===c?(s=this.propertyCache[b.PROP_RADIUS_DATA],n=x=Number(this.propertyCache[b.PROP_RADIUS_SCALE])/2,p=a=0,"Fixed Size"!==s&&this.cols&&(r=(i=this.cols[s]).length?i.calcRange():[0,1],n=x*Number(r[1])),o=n/t.x,s=n/t.y,u=new I(d-(a=o*(y-d)),g-(p=s*(f-g)),y+a,f+p)):"Line"===c&&(u=new I(d,g,y,f)),["x","y","z","w"].forEach(function(e){l[e]?u[e]=v(u[e]):h[e]&&(u[e]=v.duration(u[e]))}),m?u:e),x=P?u:e;return new I(i.x,x.y,i.z,x.w)},b.prototype.getPaletteProperty=function(e){return this.api.getProperty(this.indexProp(e?b.PROP_FILLPALETTE:b.PROP_PALETTE)).map(function(e){return"object"==typeof e.type&&e.type.attributes?e.type.attributes.value:e.type})},b.prototype.hasData=function(){if(this.datasource){var e=this.datasource.attributes,t=e.queryStatus;if(e.error)return!1;if(t){if("Loading"===t.type)return!1;if("NoResults"===t.type)return}return!0}},b.prototype.hasNoResults=function(){var e;return!!this.datasource&&"NoResults"===(null==(e=this.datasource.get("queryStatus"))?void 0:e.type)},b.prototype.indexProp=function(e){return b.PROP_PREFIX+this.index+"."+e},b.prototype.isRegexOrWild=function(){return N.isRegexOrWild(this.api.getProperty(this.indexProp(b.PROP_YAXIS)))},b.prototype.onData=function(e,i,t){this.renderState=M.Loaded,t&&this.appInvalidate(this.renderState);var t=_.find(this.cols,function(e,t){return!i.cols||e!==i.cols[t]}),e=(this.cols=_.clone(i.cols),e.columns.collection.models.map(function(e){return e.id})),n=!_.isEqual(e,this.columns);if(t||n){this.columns=e,this.updateWildcardLayers(!1,!0);try{this.setIgnoreSettings(!0),this.api.setProperty(this.indexProp("possibleXColumns"),this.columns),this.api.setProperty(this.indexProp("possibleYColumns"),["*"].concat(this.columns)),this.api.setProperty(this.indexProp("possibleColorColumns"),["None"].concat(this.cols?Object.keys(this.cols):[]));var r,o,s,a=this.api.getProperty(this.indexProp(b.PROP_COLORDATA)),l=(!a||i.cols&&!i.cols[a]?(this.api.setProperty(this.indexProp(b.PROP_COLORDATA),"None"),this.colorData=[],this.colorDataArr=[]):this.hasColorData()&&this.cols&&(r=this.calculateColorData(a),this.setColorData(r)),this.propertyCache[b.PROP_HIGHLIGHTRULES]||this.api.getProperty(this.indexProp(b.PROP_HIGHLIGHTRULES))),h=l&&l.length,u=(h&&(o=this.cols?Object.keys(this.cols):[],this.api.setProperty(this.indexProp("possibleRulesColumns"),o),this.onHighlightRuleChange(l)),this.propertyCache[b.PROP_FILL]),c=this.propertyCache[b.PROP_FADE],p=(u&&"No Fill"!==u&&(c||h)&&this.onLineFillChange(l),this.indexProp(b.PROP_XAXIS)),d=this.api.getProperty(p),y=((i.cols&&!i.cols[d]||!d)&&this.columns[0]&&(s=this.columns.find(function(e){return!N.isString(i.cols[e].qtype)})||this.columns[0],this.api.setProperty(p,s)),this.indexProp(b.PROP_YAXIS)),g=this.api.getProperty(y);this.isCandlestick()?(this.setCandlestickProperties(),g&&this.api.setProperty(y,void 0)):(!i.cols||i.cols[g]||this.isRegexOrWild())&&g||!this.columns[1]||(this.api.setProperty(y,"*"),this.setColorProperties())}catch(e){}this.setIgnoreSettings(!1),this.configure()}else this.config?this.onConfigComplete():this.appInvalidate(this.renderState)},b.prototype.onResize=function(){this.renderState=M.Process},b.prototype.onSettingsChange=function(e){var t=[b.PROP_TYPE,b.PROP_XAXIS,b.PROP_YAXIS,b.PROP_XAXISID,b.PROP_YAXISID,b.PROP_BARWIDTHTYPE,b.PROP_BARPERCENT,b.PROP_BARFIXED,b.PROP_FILL,b.PROP_FADE,b.PROP_RADIUS_DATA,b.PROP_RADIUS_SCALE,b.PROP_SPAN_GAPS,b.PROP_COLORDATA,b.PROP_HIGHLIGHTRULES],i=e[b.PROP_DATA],i=(void 0!==i&&i!==this.datasource&&(this.propertyCache[b.PROP_DATA]=i,this.onDataSourceChange(i)),e[b.PROP_COLOR]),i=(""!==i&&i||this.setColorProperties(),e[b.PROP_HIGHLIGHTRULES]),n=i&&i.length,r=(i&&!i.length&&this.highlightRules&&this.highlightRules.length&&(this.highlightRules=void 0),n&&this.cols&&t.push(b.PROP_COLOR,b.PROP_OPACITY),this.hasColorData()&&this.cols?t.push(b.PROP_OPACITY):(this.colorData=[],this.colorDataArr=[]),e[b.PROP_ICON]),r=(void 0!==r&&r!==this.icon&&(this.propertyCache[b.PROP_ICON]=r,this.onIconChange(r)),this.isCandlestick()&&t.push(b.PROP_OPEN,b.PROP_HIGH,b.PROP_LOW,b.PROP_CLOSE,b.PROP_BEARCOLOR,b.PROP_BULLCOLOR,b.PROP_NEUTRALCOLOR,b.PROP_CANDLEWIDTHTYPE,b.PROP_CANDLEPERCENT,b.PROP_CANDLEFIXED,b.PROP_OPACITY),e[b.PROP_ENABLED]),r=(r!==this.propertyCache[b.PROP_ENABLED]&&(this.propertyCache[b.PROP_ENABLED]=r,this.invalidate(M.Process)),e[b.PROP_FADE]),o=e[b.PROP_FILL];this.cols&&o&&"No Fill"!==o&&this.isEnabled()&&(r||n?this.onLineFillChange(i):this.lineFillColors=void 0,t.push(b.PROP_FILLCOLOR,b.PROP_FILLOPACITY),this.isRegexOrWild()&&t.push(b.PROP_FILLPALETTE)),this.configureIfDiff(e,t),this.invalidateIfDiff(e,b.PROP_COLOR,M.Uniforms),this.invalidateIfDiff(e,b.PROP_WICKCOLOR,M.Uniforms),this.invalidateIfDiff(e,b.PROP_OPACITY,M.Uniforms),this.invalidateIfDiff(e,b.PROP_FILLCOLOR,M.Uniforms),this.invalidateIfDiff(e,b.PROP_FILLOPACITY,M.Uniforms)},b.prototype.processData=function(e,t,i,n){var r,o,s,a,l,h,u,c,p,d=this;this.renderState===M.Process&&this.config&&(r=(o=this.config).xCol,o=o.yCols,r&&r.length&&(this.renderer&&this.renderer.remove(e),this.rendererFill&&this.rendererFill.remove(e),this.propertyCache[b.PROP_ICON]&&this.image&&this.image.height&&(this.texture=A.createTexture(e,this.image,this.index)),s=[],this.isCandlestick()&&(a=this.api.getProperty(this.indexProp(b.PROP_BEARCOLOR)),l=this.api.getProperty(this.indexProp(b.PROP_BULLCOLOR)),h=this.api.getProperty(this.indexProp(b.PROP_NEUTRALCOLOR)),p=this.api.getProperty(this.indexProp(b.PROP_CANDLEWIDTHTYPE)),u=this.api.getProperty(this.indexProp(b.PROP_CANDLEPERCENT))/100,c=this.api.getProperty(this.indexProp(b.PROP_CANDLEFIXED)),s=[a,l,h,"Percentage"===p?u:c,this.api.getProperty(this.indexProp(b.PROP_OPACITY)),p]),a=this.propertyCache[b.PROP_TYPE]||this.api.getProperty(this.indexProp(b.PROP_TYPE)),l=this.propertyCache[b.PROP_SPAN_GAPS],h=null!==this.texture,this.renderer=this.config.createRenderer(e,this.isWebGL2,h,"Line"===a&&l,s,this.colorData,new w(this.getAxisType("x"),this.getAxisType("y")),void 0,n,"Bar"===a||this.isCandlestick()?i:void 0,"Bar"!==a&&!this.isCandlestick()||null==t?void 0:t.x)),u="Line"===this.propertyCache[b.PROP_TYPE],c=this.propertyCache[b.PROP_FILL],u&&"No Fill"!==c||(this.renderState=M.Uniforms),this.workerIndex=[],p=this.getAxisId("x"),"Category"!==this.api.getProperty("Xaxes."+p+".Type")&&r.hasIndex&&r.hasIndex()||!o.length?this.worker&&(this.worker.terminate(),this.worker=null):(this.worker||(e=requirejs.toUrl("ChartGL").slice(0,-4)+"worker.js",this.worker=new Worker(e),this.worker.onmessage=function(e){"ready"!==e.data||d.workerQueued?(d.workerIndex=e.data,d.invalidate(M.Tooltip)):(d.workerQueued=!0,window.requestAnimationFrame(function(){var e,t,i;d.Config&&d.Config.xCol&&(e=d.getAxisId("x"),e=d.api.getProperty("Xaxes."+e+".Type"),t=d.Config.xCol,i=(i=null==(i=d.renderer)?void 0:i.getCategoryData("x"))&&"Category"===e?JSON.parse(JSON.stringify(i[0])):t.toTypedArray?t.toTypedArray():{},d.workerQueued=!1,d.worker&&d.worker.postMessage([t.qtype,i,e]))}))},this.worker.onerror=function(e){return E.Log.Error(e)}),r&&o.length&&this.worker.postMessage("queue")))},b.prototype.getWildcardColumns=function(){var t=this;return this.yAxes.filter(function(e){return-1===t.disabledColumns.indexOf(e)})},b.prototype.processLineFillData=function(e,t){var i,n;this.config&&(n=this.api.getProperty(this.indexProp(b.PROP_COLORDATA)),i=[],this.hasColorData()&&this.cols&&(n=this.calculateColorData(n),i=this.setColorData(n,!0)),n=null!==this.texture,this.rendererFill=this.config.createRenderer(e,this.isWebGL2,n,this.propertyCache[b.PROP_SPAN_GAPS],[],i,new w(this.getAxisType("x"),this.getAxisType("y")),[t,this.propertyCache[b.PROP_FADE]])),this.renderState=M.Uniforms},b.prototype.remove=function(e,t){t&&(this.renderer&&this.renderer.remove(e),this.texture&&e.deleteTexture(this.texture)),this.datasource&&(this.datasource.unsubscribe(this.subId),this.datasource.off("change:queryStatus",this.datasourceStatusFn)),this.renderer&&this.renderer.remove(e),this.rendererFill&&this.rendererFill.remove(e),this.texture&&(e.deleteTexture(this.texture),this.texture=null),this.worker&&this.worker.terminate()},b.prototype.render=function(e,t,i,n){var r=this.propertyCache[n?b.PROP_FILL:b.PROP_TYPE],o=this.propertyCache[b.PROP_WICKCOLOR],s=this.propertyCache[n?b.PROP_FILLCOLOR:b.PROP_COLOR],a=this.propertyCache[b.PROP_RADIUS_DATA],l=this.propertyCache[n?b.PROP_FILLOPACITY:b.PROP_OPACITY],h=this.texture?1.333*Number(this.propertyCache[b.PROP_RADIUS_SCALE]):Number(this.propertyCache[b.PROP_RADIUS_SCALE]),u=0<i?1/i:1,c=h*u,p=this.getWildcardColumns(),d=this.propertyCache[b.PROP_SPAN_GAPS],a=(i&&"Bubble"===r&&"Fixed Size"!==a&&null!=(a=this.renderer)&&a.updatePointSizeOnZoom(u,e),n?this.rendererFill:this.renderer),u=n?this.fillPalette:this.palette;a&&a.render(e,t,this.isRegexOrWild()?u:this.isCandlestick()?[o]:[s],i&&h<=c?c:h,r,l,d,p,this.texture?this.index:void 0)},b.prototype.updateRenderState=function(){this.renderState=M.Process},b.prototype.getDataSource=function(){return this.datasource},b.prototype.updateAxisId=function(e,i){i=i.toUpperCase();var n=[],e=(_.each(e,function(e,t){n.push(i+"-Axis "+(t+1))}),this.api.setProperty(this.indexProp("possible"+i+"Axes"),n),this.api.getProperty(this.indexProp(i+"AxisId")));n.length&&-1===n.indexOf(e)&&this.api.setProperty(this.indexProp(i+"AxisId"),i+"-Axis 1")},b.prototype.updateColumns=function(e,t){this.disabledColumns=e,t||this.configure()},b.prototype.updateLayer=function(e,t,i){var n=this;this.api.setProperty(this.indexProp(b.PROP_DATA),e),_.each(t,function(e,t){n.api.setProperty(n.indexProp(i[t]),e)})},b.prototype.wildcardDataChanged=function(e){return this.isRegexOrWild()&&this.propertyCache[b.PROP_DATA]!==e},b.prototype.calculateColorData=function(e,t){var i=[];if(this.cols&&this.cols[e]){for(var n,r=this.cols,o=[],s=[],a=function(e){return null===e?null:E.Tools.isKDBTemporal(e)?E.Tools.convertKDBTemporalToMoment(e).toDashString():N.getValueFromObject(e)},l=0,h=0;h<r[e].length;h++)"object"==typeof(u=r[e].getValue(h))&&(u=a(u)),-1===o.indexOf(u)&&(o.push(u),n=this.getPaletteProperty(!!t),s.push(n[l%n.length]),l++);t||(this.colorDataInfo=[o,s]);for(var u,h=0;h<r[e].length;h++)"object"==typeof(u=r[e].getValue(h))&&(u=a(u)),i.push(s[o.indexOf(u)])}else this.colorDataInfo=[[],[]],this.colorData=[],this.colorDataArr=[];return i},b.prototype.configure=function(){var i=this;if(this.config=null,this.cols){var n=this.cols,e=this.indexProp(b.PROP_XAXIS),e=this.api.getProperty(e),r=this.indexProp(b.PROP_YAXIS),r=this.api.getProperty(r),e=this.cols[e],o=(this.isCandlestick()||r||(this.setIgnoreSettings(!0),this.api.setProperty(this.indexProp(b.PROP_YAXIS),"*"),this.setIgnoreSettings(!1)),this.getYAxesVals());if(this.isRegexOrWild()&&-1===r.indexOf("*")){var r=_.keys(_.groupBy(o,function(e){return n[e].qtype})),s=[D.Byte,D.Short,D.Int,D.Long,D.Double,D.Float,D.Char],a=[D.Timestamp,D.Month,D.Date,D.DateTime,D.Timespan,D.Minute,D.Second,D.Time];if(r.some(function(e){return 0<=a.indexOf(Number(e))})&&r.some(function(e){return 0<=s.indexOf(Number(e))}))return void this.api.showErrorMessage({error:t("Can't mix date types with number types on ")+"<b>"+t("Properties > Layer > Y-Axis Data")+"</b>",type:"Error"})}this.isCandlestick()&&(this.setCandlestickProperties(),o=[b.PROP_OPEN,b.PROP_HIGH,b.PROP_LOW,b.PROP_CLOSE].map(function(e){return i.api.getProperty(i.indexProp(e))})),_.isEqual(this.yAxes,o)||(this.disabledColumns=[]),this.yAxes=o;var r=_.difference(o,this.disabledColumns),o=(this.setColorProperties(),this.setIgnoreSettings(!0),this.propertyCache[b.PROP_TYPE]),l=["Fixed Size"].concat(this.columns),h=this.api.getProperty(this.indexProp("possibleRadiusData")),h=("Bubble"!==o||_.isEqual(l,h)||this.api.setProperty(this.indexProp("possibleRadiusData"),l),"Line"===o&&this.setLineFillProperties(),this.setIgnoreSettings(!1),r.map(function(e){return n[e]})),l=this.api.getProperty(this.indexProp(b.PROP_BARWIDTHTYPE)),o=this.api.getProperty(this.indexProp(b.PROP_BARPERCENT))/100,u=this.api.getProperty(this.indexProp(b.PROP_BARFIXED)),o="Percentage"===l?o:u,u=this.api.getProperty(this.indexProp(b.PROP_RADIUS_DATA)),c=this.api.getProperty(this.indexProp(b.PROP_RADIUS_SCALE)),u="Fixed Size"===u?"":this.cols[u];e&&h&&h.length&&(this.config=new Ee(e,h,r,o,l,[u,c],this.highlightRules,this.lineFillColors),this.onConfigComplete())}},b.prototype.configureIfDiff=function(i,e){var n=this,r=!1,t=this.propertyCache[b.PROP_HIGHLIGHTRULES],o=t&&t.length,s=this.propertyCache[b.PROP_COLORDATA],a=!1,l=!1;e.forEach(function(e){var t=i.hasOwnProperty(e)&&!n.propertyCache.hasOwnProperty(e)||!_.isEqual(i[e],n.propertyCache[e]);!t||"Opacity"!==e&&"Color"!==e&&"YAxis"!==e&&"SpanGaps"!==e&&"ColorData"!==e&&"HighlightRules"!==e||(o&&(l=!0),s&&(a=!0)),t&&(r=r||t,n.propertyCache[e]=_.get(i,e))}),a&&(t=this.api.getProperty(this.indexProp(b.PROP_COLORDATA)),this.hasColorData()&&(e=this.calculateColorData(t),this.setColorData(e))),l&&this.onHighlightRuleChange(this.propertyCache[b.PROP_HIGHLIGHTRULES]),r&&this.configure()},b.prototype.getAllWildcards=function(e,t,i,n){e=n(e);for(var r=i.getPoint(e),o=[],s=1;s<r.length;s++)o.push([e,N.calculateRelativePoint(new w(r[0],r[s]),t),i.yColNames[s-1],s-1]);return o},b.prototype.getClosestPoint=function(e,t,i,n,r){for(var o=1,s=(e=n(e),i.getPoint(e)),a=Math.abs(r-N.calculateRelativeValue(s[1],t.y,t.w)),l=2;l<s.length;l++){var h=N.calculateRelativeValue(s[l],t.y,t.w),h=Math.abs(h-r);(h<a||isNaN(Number(s[o])))&&(a=h,o=l)}n=N.calculateRelativePoint(new w(s[0],s[o]),t);return"Category"===this.getAxisType("x")&&(n=new w(s[0],n.y)),[e,n="Category"===this.getAxisType("y")?new w(n.x,s[o]):n,i.yColNames[o-1],o-1]},b.prototype.getClosestXPoint=function(i,n,t,r,o){var s=i[0],e=i.map(function(e){return t.getPoint(r(e))[0]}),a=Math.abs(o-N.calculateRelativeValue(e[0],n.x,n.z));return _.each(e,function(e,t){"number"!=typeof e&&"bigint"!=typeof e||(e=N.calculateRelativeValue(e,n.x,n.z),(e=Math.abs(e-o))<a&&(a=e,s=i[t]))}),s},b.prototype.getUpdatedPalette=function(e){for(var t=this.getAllCols(),i=0,n=[];n.length<t.length;)n[i]=e[i%e.length],i++;var r=this.disabledColumns;return _.each(r,function(e){return n[t.indexOf(e)]=""}),n.filter(function(e){return 0<e.length})},b.prototype.getY=function(i,n,t,r,o){var s,a,l,h=this,u=i[0],c=[];if(_.each(i,function(e){e=r(e),(s=t.getPoint(e))&&(2<s.length?c.push(s.slice(1)):c.push(s[1]))}),!c.length)return null;var e=(2<s.length?c[0]:c)[0],p=Math.abs(o-N.calculateRelativeValue(e,n.y,n.w));return _.each(c,function(e,t){2<s.length&&Array.isArray(e)?_.each(e,function(e){a=N.calculateRelativeValue(e,n.y,n.w),(l=Math.abs(a-o))<p&&(p=l,u=i[t])}):"number"!=typeof e&&"bigint"!=typeof e||("Category"===h.getAxisType("y")&&(e=i[t]/h.workerIndex.length),a=N.calculateRelativeValue(e,n.y,n.w),(l=Math.abs(a-o))<p&&(p=l,u=i[t]))}),u},b.prototype.getYAxesVals=function(){var t=this.cols;if(!t)return this.yAxes;var e=this.api.getProperty(this.indexProp(b.PROP_XAXIS)),i=this.api.getProperty(this.indexProp(b.PROP_YAXIS)),n=this.isRegexOrWild()?this.getColumnKeysFromAxisString(i):[i];return i&&-1!==i.indexOf("*")&&(i=_.without(n,e),n=_.maxBy(_.values(_.groupBy(i,function(e){return t[e].qtype})),function(e){return e.length})),n},b.prototype.invalidate=function(e){e<this.renderState&&(this.renderState=e),this.appInvalidate(this.renderState)},b.prototype.invalidateIfDiff=function(e,t,i){void 0!==e[t]&&e[t]!==this.propertyCache[t]&&(this.propertyCache[t]=e[t],this.invalidate(i))},b.prototype.onDataSourceChange=function(e){var i=this;this.datasource&&(this.datasource.unsubscribe(this.subId),this.datasource.off("change:queryStatus",this.datasourceStatusFn)),this.datasource=e,this.datasource?(this.cols=void 0,this.columns=[],this.renderState=M.Data,this.datasource.subscribe(this.subId,this,!0),this.datasourceStatusFn=function(e,t){t&&"Loading"===t.type&&i.invalidate(M.Data)},this.datasource.on("change:queryStatus",this.datasourceStatusFn)):this.renderState=M.Init,this.appInvalidate(this.renderState)},b.prototype.onConfigComplete=function(){this.renderState=M.Process,this.appInvalidate(this.renderState)},b.prototype.onLineFillChange=function(e){var t=this,i=this.api.getProperty(this.indexProp(b.PROP_FILL)),n=this.api.getProperty(this.indexProp(b.PROP_FADE)),r=this.api.getProperty(this.indexProp(b.PROP_FILLCOLOR)),o=this.api.getProperty(this.indexProp(b.PROP_FILLOPACITY)),s=this.api.getProperty(this.indexProp(b.PROP_YAXIS)),a=this.propertyCache[b.PROP_SPAN_GAPS],l=new Re,r=this.isRegexOrWild()?this.fillPalette.length?this.fillPalette:this.getUpdatedPalette(this.getPaletteProperty(!!i)):r,h=this.getColumnKeysFromAxisString(s),u={},e=(_.keys(this.cols).forEach(function(e){-1!==h.indexOf(e)&&t.cols&&(u[e]=t.cols[e])}),l.computeHighlightRules(e,r,this.propertyCache[b.PROP_XAXIS],s,this.cols,u,n,r,a,this.colorDataArr));this.lineFillColors=l.getColorArray(e,0,i&&"No Fill"!==i,o)},b.prototype.onHighlightRuleChange=function(e){var t=this,i=this.api.getProperty(this.indexProp(b.PROP_YAXIS)),n=this.api.getProperty(this.indexProp(b.PROP_COLOR)),r=this.api.getProperty(this.indexProp(b.PROP_OPACITY)),o=this.propertyCache[b.PROP_TYPE],s=this.propertyCache[b.PROP_SPAN_GAPS],a=new Re,l=this.getColumnKeysFromAxisString(i),h={},e=(_.keys(this.cols).forEach(function(e){-1!==l.indexOf(e)&&t.cols&&(h[e]=t.cols[e])}),a.computeHighlightRules(e,this.isRegexOrWild()?this.palette.length?this.palette:this.getPaletteProperty():n,this.api.getProperty(this.indexProp(b.PROP_XAXIS)),i,this.cols,h,!1,"","Line"===o&&s,this.colorDataArr)),n=this.cols?Object.keys(this.cols):[],i=(this.api.setProperty(this.indexProp("possibleRulesColumns"),n),e.map(function(e){return Array.isArray(e)?e.filter(function(e){return!!e}):e}));this.highlightRules=a.getColorArray(i,r),this.isRegexOrWild()?this.colorArr=e:this.colorArr=Array.prototype.concat.apply([],e)},b.prototype.onIconChange=function(e){var t,i=this;if(!(this.icon=e))return this.texture=null,void this.invalidate(M.Process);if(0===e.indexOf("fa-"))t=requirejs.toUrl("QuickBase").replace(/main$/,"")+"images/white/"+e.replace(/^fa-/,"")+".png";else{if(0!==e.indexOf("data:image/"))throw Error("Unsupported icon scheme!");t=e}this.image||(this.image=document.createElement("img")),this.el.append(this.image),this.image.height=1,this.image.style.visibility="hidden",this.image.src=t,this.image.onload=function(){i.image&&i.el.removeChild(i.image),i.invalidate(M.Process)}},b.prototype.setCandlestickProperties=function(){var n=this,r=this.columns,o=this.api.getProperty(this.indexProp(b.PROP_XAXIS)),e=[b.PROP_OPEN,b.PROP_HIGH,b.PROP_LOW,b.PROP_CLOSE],s=[b.PROP_YAXIS,b.PROP_COLORDATA,b.PROP_COLOR];this.setIgnoreSettings(!0),e.forEach(function(e,t){var i=n.indexProp(e);n.api.getProperty(i)||n.api.setProperty(i,-1!==r.indexOf(e)?e:o),s[t]&&(i=n.indexProp(s[t]),n.api.getProperty(i)&&n.api.setProperty(i,void 0))}),this.setIgnoreSettings(!1)},b.prototype.setColorData=function(t,e){var i=[],n=e?this.propertyCache[b.PROP_FILLOPACITY]:this.propertyCache[b.PROP_OPACITY],r=(_.each(t,function(e){e=_e.hexColorToVec4(e,n);i.push(Object.values(e))}),this.api.getProperty(this.indexProp(b.PROP_XAXIS))),r=this.yAxes.length?this.yAxes:_.without(this.columns,r),r=(this.colorDataArr=this.isRegexOrWild()?r.map(function(e){return t}):t,this.isRegexOrWild()?r.map(function(e){return i}):[i]);return e||(this.colorArr=this.colorDataArr,this.colorData=r),r},b.prototype.setColorProperties=function(){this.setIgnoreSettings(!0);var e=this.indexProp(b.PROP_COLOR),t=this.api.getProperty(e);this.isRegexOrWild()||this.isCandlestick()?(void 0!==t&&(this.colorCache=t),this.api.setProperty(e,void 0)):void 0!==t&&""!==t||(t=this.colorCache||z.COLOR_DEFAULT,this.api.setProperty(e,t),this.propertyCache[b.PROP_COLOR]=t),this.setIgnoreSettings(!1)},b.prototype.setLineFillProperties=function(){var e=this.api.getProperty(this.indexProp(b.PROP_FILLCOLOR)),t=this.api.getProperty(this.indexProp(b.PROP_FILLOPACITY)),i=this.api.getProperty(this.indexProp(b.PROP_FADE));"No Fill"===this.api.getProperty(this.indexProp(b.PROP_FILL))?(this.fillCache=[e||this.fillCache[0],t||this.fillCache[1],i||this.fillCache[2]],this.api.setProperty(this.indexProp(b.PROP_FILLCOLOR),void 0),this.api.setProperty(this.indexProp(b.PROP_FILLOPACITY),void 0),this.api.setProperty(this.indexProp(b.PROP_FADE),void 0)):(void 0!==e||this.isRegexOrWild()?void 0!==e&&this.isRegexOrWild()&&(this.fillCache[0]=e,this.api.setProperty(this.indexProp(b.PROP_FILLCOLOR),void 0)):this.api.setProperty(this.indexProp(b.PROP_FILLCOLOR),this.fillCache[0]||this.propertyCache[b.PROP_COLOR]),void 0===t&&this.api.setProperty(this.indexProp(b.PROP_FILLOPACITY),this.fillCache[1]||80),void 0===i&&this.api.setProperty(this.indexProp(b.PROP_FADE),this.fillCache[2]||!1))},b.PROP_DATA="Data",b.PROP_TYPE="_Type",b.PROP_XAXIS="XAxis",b.PROP_YAXIS="YAxis",b.PROP_COLOR="Color",b.PROP_BARPERCENT="BarWidth",b.PROP_BARFIXED="BarFixedWidth",b.PROP_BARWIDTHTYPE="BarWidthType",b.PROP_BEARCOLOR="CandlestickFormat.BearColor",b.PROP_CANDLEPERCENT="CandlestickFormat.BarWidth",b.PROP_CANDLEFIXED="CandlestickFormat.BarFixedWidth",b.PROP_CANDLEWIDTHTYPE="CandlestickFormat.BarWidthType",b.PROP_BULLCOLOR="CandlestickFormat.BullColor",b.PROP_NEUTRALCOLOR="CandlestickFormat.NeutralColor",b.PROP_FADE="Line.FadeToTransparent",b.PROP_FILL="Line.Fill",b.PROP_FILLCOLOR="Line.FillColor",b.PROP_FILLOPACITY="Line.FillOpacity",b.PROP_FILLPALETTE="Line.FillPalette",b.PROP_ICON="Icon",b.PROP_PALETTE="Palette",b.PROP_SPAN_GAPS="Line.SpanGaps",b.PROP_WICKCOLOR="CandlestickFormat.WickColor",b.PROP_ACTIONS="Actions",b.PROP_HIGHLIGHTRULES="HighlightRules",b.PROP_XAXISID="XAxisId",b.PROP_YAXISID="YAxisId",b.BAR_MIN_RELATIVE_SZ=.02,b.PROP_COLORDATA="ColorData",b.PROP_ENABLED="Enabled",b.PROP_OPACITY="Opacity",b.PROP_PREFIX="Layers.",b.PROP_RADIUS_SCALE="RadiusScaling",b.PROP_RADIUS_DATA="RadiusData",b.PROP_OPEN="Open",b.PROP_HIGH="High",b.PROP_LOW="Low",b.PROP_CLOSE="Close";var F=b;function b(e,t,i,n,r,o,s){this.index=e,this.uid=t,this.api=i,this.appInvalidate=n,this.setIgnoreSettings=r,this.el=o,this.updateWildcardLayers=s,this.config=null,this.colorArr=[],this.colorCache=null,this.colorData=[],this.colorDataArr=[],this.colorDataInfo=null,this.columns=[],this.datasource=null,this.disabledColumns=[],this.fillCache=[],this.icon="",this.image=null,this.isWebGL2="undefined"!=typeof WebGL2RenderingContext,this.palette=[],this.fillPalette=[],this.points=[],this.propertyCache={},this.renderer=null,this.rendererFill=null,this.texture=null,this.subId=_.uniqueId("glLayer"),this.renderState=M.Init,this.workerIndex=[],this.worker=null,this.workerQueued=!1,this.yAxes=[]}we=Backbone.View,i(C,we),C.prototype.remove=function(){return this.lnkCsvExport&&this.lnkCsvExport.removeEventListener("click",_.bind(this.fileExport.bind(this),".csv"),!1),this.lnkExcelExport&&this.lnkExcelExport.removeEventListener("click",_.bind(this.fileExport.bind(this),".xlsx"),!1),this.stopListening(),Backbone.View.prototype.remove.apply(this)},C.prototype.getWidth=function(){var e=this.api.getProperty("FileExport");return e.ShowExportCsvButton||e.ShowExportExcelButton?C.LEGEND_WIDTH:0},C.prototype.displayChoiceLinkButtons=function(){var e=this.api.getProperty("FileExport");!e||_.keys(e).length<3||(e.ShowExportCsvButton||e.ShowExportExcelButton?this.lnkCsvExport&&this.lnkExcelExport&&this.lnksExport&&(this.lnksExport.classList.remove("link-disabled"),this.lnkCsvExport.classList.toggle("link-disabled",!e.ShowExportCsvButton),this.lnkExcelExport.classList.toggle("link-disabled",!e.ShowExportExcelButton)):(this.lnksExport&&this.lnksExport.classList.add("link-disabled"),this.lnkCsvExport&&this.lnkCsvExport.classList.add("link-disabled"),this.lnkExcelExport&&this.lnkExcelExport.classList.add("link-disabled")),this.onResize())},C.prototype.initializeEvents=function(){var e=this;this.lnkCsvExport&&this.lnkExcelExport&&(this.lnkCsvExport.addEventListener("click",function(){e.fileExport(".csv")}),this.lnkExcelExport.addEventListener("click",function(){e.fileExport(".xlsx")}))},C.prototype.mergeArray=function(e,t,i){return Object.values(_.merge(_.keyBy(e,i),_.keyBy(t,i)))},C.prototype.fileExport=function(e){var i=this,t=E.ExportTools,h=[],u=[],c=this.api,p=[];_.each(this.layers,function(r,o){var t=[],s=_.get(r,"propertyCache.XAxis");if(!_.isNil(s)){var a=_.get(r,"config.yColNames");if(a){var n=[s].concat(a),l=_.get(r,"cols");if(_.get(l,s)){for(var e=0;e<l[s].length;e++)!function(i){var e=Object.assign.apply(Object,G([{}],_.flatMap(n,function(e){var t={};return t[0<=a.indexOf(e)?e+"_"+o:e]=l[e].getValue(i),t}),!1));t.push(e)}(e);u=i.mergeArray(u,t,s)}_.each(n,function(t,e){var i,n;_.find(h,function(e){return t===e.colId})||(i=(i=s===t?"x":"y").toUpperCase()+"axes."+r.getAxisId(i),n=0<=a.indexOf(t)?t+"_"+o:t,p.indexOf(n)<0&&p.push(n),h.push({colId:n,colName:1!==e||r.isRegexOrWild()?t:r.getLayerName(),dataFormat:"",dataKdbType:l[t].qtype,dataType:"String",hideTrailingZeroes:c.getProperty(i+".Format.HideTrailingZeroes"),prefix:c.getProperty(i+".Format.Prefix"),suffix:c.getProperty(i+".Format.Suffix")}))})}}});var n=(n=_.map(c.getProperty("FileExport.FileName"),function(e){return(e=null!==(e=e.FileNamePart)&&!_.isObject(e)?e:"").toString()}).join("")).replace(/[^a-z0-9]/gi,"_"),e=(_.each(u,function(t){_.each(_.difference(p,Object.keys(t)),function(e){t[e]=null})}),{configSets:{chartGLExport:{dataSet:u,metaData:h}},fileFormat:e,fileName:n||"ChartGL_Export",workSheetTitle:"ChartGL"});t.openFileExportDialog(e)},C.prototype.renderLinks=function(){this.lnksExport=this.el.querySelectorAll(".lnksExport")[0],this.lnkCsvExport=this.el.querySelectorAll("a.lnkCsvExport")[0],this.lnkExcelExport=this.el.querySelectorAll("a.lnkExcelExport")[0]},C.LEGEND_WIDTH=85;var we,Ie=C;function C(e){var t=we.call(this,e)||this;return t.getCanvas=e.getCanvas,t.api=e.api,t.layers=e.layers,t.onResize=e.onResize,t.el=e.el,t.el.innerHTML=y.fileExporter({}),t.isIE=!1,HTMLCanvasElement&&HTMLCanvasElement.prototype&&_.get(HTMLCanvasElement.prototype,"msToBlob")&&(t.isIE=!0),t.render(),t.renderLinks(),t.initializeEvents(),t}R.easeInQuad=function(e){return Math.pow(e,2)},R.easeOutQuad=function(e){return-(Math.pow(e-1,2)-1)},R.easeInOutQuad=function(e){return(e/=.5)<1?.5*Math.pow(e,2):-.5*((e-=2)*e-2)},R.easeInCubic=function(e){return Math.pow(e,3)},R.easeOutCubic=function(e){return Math.pow(e-1,3)+1},R.easeInOutCubic=function(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)},R.easeInQuart=function(e){return Math.pow(e,4)},R.easeOutQuart=function(e){return-(Math.pow(e-1,4)-1)},R.easeInOutQuart=function(e){return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},R.easeInQuint=function(e){return Math.pow(e,5)},R.easeOutQuint=function(e){return Math.pow(e-1,5)+1},R.easeInOutQuint=function(e){return(e/=.5)<1?.5*Math.pow(e,5):.5*(Math.pow(e-2,5)+2)},R.easeInSine=function(e){return 1-Math.cos(e*(Math.PI/2))},R.easeOutSine=function(e){return Math.sin(e*(Math.PI/2))},R.easeInOutSine=function(e){return-.5*(Math.cos(Math.PI*e)-1)},R.easeInExpo=function(e){return 0===e?0:Math.pow(2,10*(e-1))},R.easeOutExpo=function(e){return 1===e?1:1-Math.pow(2,-10*e)},R.easeInOutExpo=function(e){return 0===e?0:1===e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e))},R.easeInCirc=function(e){return-(Math.sqrt(1-e*e)-1)},R.easeOutCirc=function(e){return Math.sqrt(1-Math.pow(e-1,2))},R.easeInOutCirc=function(e){return(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},R.easeOutBounce=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},R.easeInBack=function(e){return e*e*(2.70158*e-1.70158)},R.easeOutBack=function(e){return(e-=1)*e*(2.70158*e+1.70158)+1},R.easeInOutBack=function(e){var t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},R.elastic=function(e){return-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1},R.swingFromTo=function(e){var t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},R.swingFrom=function(e){return e*e*(2.70158*e-1.70158)},R.swingTo=function(e){return--e*e*(2.70158*e+1.70158)+1},R.bounce=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},R.bouncePast=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?2-(7.5625*(e-=1.5/2.75)*e+.75):e<2.5/2.75?2-(7.5625*(e-=2.25/2.75)*e+.9375):2-(7.5625*(e-=2.625/2.75)*e+.984375)},R.easeFromTo=function(e){return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},R.easeFrom=function(e){return Math.pow(e,4)},R.easeTo=function(e){return Math.pow(e,.25)};var M,De=R;function R(){}function k(e){var t=this;this.ignoreSettingsChange=!1,this.layers=[],this.isLoading=!1,this.xAxisLayer={},this.yAxisLayer={},this.layerXAxis={},this.layerYAxis={},this.xAxisDataBounds=[],this.yAxisDataBounds=[],this.xAxisViewBounds=[],this.yAxisViewBounds=[],this.activeZoom=new I(0,0,1,1),this.animateZoom=!1,this.selZoom=!1,this.lastXZoom=[],this.lastYZoom=[],this.xAxisZoom=[],this.yAxisZoom=[],this.onXZoom=!1,this.onYZoom=!1,this.zoomTime=0,this.resetZoom=!1,this.activeBounds=[],this.activeXPan=[],this.activeYPan=[],this.closestPoint=new w(0,1),this.expressTime=Date.now()-k.REST_MS,this.overPoint=null,this.size=new w(1,1),this.renderedMargin=new I(0,0,0,0),this.renderedSize=new w(1,1),this.click=!1,this.hover=!1,this.settingsSelected=!1,this.settingsHovered=!1,this.renderState=M.Valid,this.panning=!1,this.options=e,this.api=e.api,this.el=e.el,this.el.className+=" ChartGL",this.uid=_.uniqueId("ChartGL"),this.el.innerHTML=y.app({uid:this.uid}),this.tooltips=new ge(this.api),this.legend=new ve(this.el,this.api,this.tooltips,this.invalidate.bind(this),this.setIgnoreSettings.bind(this),this.updateWildcardLayers.bind(this),this.getFileExporterWidth.bind(this)),this.axis=new be(this.api,this.el.getElementsByClassName("axis")[0],this.legend),this.pan=new Oe(this.api,this.axis,this.onPan.bind(this)),this.canvas=this.el.getElementsByTagName("canvas")[1],this.image=document.createElement("img"),this.image.style.opacity="0",this.crosshairHover=new fe(this.el,this.api,this.canvas),this.crosshairSelected=new fe(this.el,this.api,this.canvas),this.overlay=new Se(this.el.getElementsByClassName("overlay")[0],this.onOverlayOver.bind(this),this.onOverlayZoom.bind(this),this.onOverlayReset.bind(this),this.onOverlayClick.bind(this)),N.isWebGLHWAcclEnabled||E.Log.Warn("ChartGL: Hardware Acceleration not enabled"),this.gl=this.canvas.getContext(N.glContext,{premultipliedAlpha:N.isWebGLHWAcclEnabled,preserveDrawingBuffer:!0}),this.gl?(this.setTheme(e.dashboardViewModel.get(k.APP_THEME)),this.onResize(),this.initializeEventListeners(),this.fileExporterView=new Ie({api:this.api,el:this.el.getElementsByClassName("export-div")[0],layers:this.layers,getCanvas:function(){return t.canvas},onResize:this.onResize.bind(this)})):E.Log.Error("ChartGL: Context Not Initialized")}return(e=M=M||{})[e.Init=0]="Init",e[e.Data=1]="Data",e[e.Loaded=2]="Loaded",e[e.Process=3]="Process",e[e.Legend=4]="Legend",e[e.Axis=5]="Axis",e[e.Uniforms=6]="Uniforms",e[e.Tooltip=7]="Tooltip",e[e.Valid=8]="Valid",k.getNewLayerId=function(e){for(var t=0;e["L"+t];)t++;return"L"+t},k.prototype.onOverlayOver=function(e){var t;(null==e?void 0:e.x)===(null==(t=this.overPoint)?void 0:t.x)&&(null==e?void 0:e.y)===(null==(t=this.overPoint)?void 0:t.y)||(!e&&this.overPoint&&this.api.setProperty(k.PROP_HOVER,""),this.overPoint=e,this.invalidate(M.Tooltip),e&&(this.hover=!0))},k.prototype.onOverlayZoom=function(e){E.Log.Log("Region: "+e);var e=new I(e.x,1-e.w,e.z,1-e.y),t=new w(this.activeZoom.x,this.activeZoom.z),i=new w(this.activeZoom.y,this.activeZoom.w),n=N.calculateCroppedJs2(new w(e.x,e.z),t),r=N.calculateCroppedJs2(new w(e.y,e.w),i);this.onXZoom=!_.isEqual(t,n),this.onYZoom=!_.isEqual(i,r),this.zoomTime=Date.now(),this.activeZoom=this.activeZoom?N.calculateCroppedBounds(e,this.activeZoom):e,this.onZoom(e,!!t,!!i)},k.prototype.onOverlayReset=function(){var i=this;this.zoomTime=Date.now(),this.activeZoom=new I(0,0,1,1),this.resetZoom=!0,this.activeXPan.forEach(function(e,t){return i.activeXPan[t]=new w(0,1)}),this.activeYPan.forEach(function(e,t){return i.activeYPan[t]=new w(0,1)}),this.setIgnoreSettings(!0),this.axis.x.forEach(function(e,t){return e.setRangeViewstate(null,"Xaxes",t)}),this.axis.y.forEach(function(e,t){return e.setRangeViewstate(null,"Yaxes",t)}),this.setIgnoreSettings(!1),this.getSelectionViewstates(),this.processIfFixedBars()},k.prototype.onPan=function(e,t,i,n){t&&this.crosshairSelected.onPan(t),"Right"===n||"Left"===n?this.activeXPan[i]=new w(e.x,e.z):this.activeYPan[i]=new w(e.y,e.w),this.invalidate(M.Axis)},k.prototype.getFileExporterWidth=function(){return this.fileExporterView?this.fileExporterView.getWidth():0},k.prototype.onResize=function(){this.size=new w(this.el.offsetWidth,this.el.offsetHeight),this.legend.onResize(this.el.offsetHeight),this.axis.onResize(),this.processIfFixedBars()},k.prototype.onSettingsChange=function(i){var t,n,r,o,s,a,e,l,h,u,c,p,d=this;this.ignoreSettingsChange||(u=_.find(_.keys(i),function(e){return 0===e.indexOf(k.PROP_SELECT)}),c=_.find(_.keys(i),function(e){return 0===e.indexOf(k.PROP_HOVER)}),(!u&&c||!c&&u)&&(this.settingsSelected=!(!u||this.click),this.settingsHovered=!(!c||this.hover),this.invalidate(M.Tooltip)),i.hasOwnProperty("Layers")||(u=N.expandNestedViewStates(i,this.api),c=N.replaceViewStatesWithValue("",u,this.api),i=c),0<(u=_.filter(_.keys(i),function(e){return-1!==e.indexOf("Layers.")})).length&&(t={},_.each(u,function(e){_.set(t,e,i[e]),delete i[e]}),_.extend(i,t)),c=i[k.PROP_LEGEND_GROUPS],u=this.api.getProperty(k.PROP_LEGEND_GROUPS).filter(function(e){return!!e}),(c||i[k.PROP_LAYERS])&&(e=(p=u.length&&this.api.getProperty("Layers").some(function(e){return e.LegendGroup&&"None"!==e.LegendGroup}))?["Left","Right"]:["Top","Bottom","Left","Right"],this.api.getProperty(k.PROP_POSSIBLEPOSITIONS)!==e&&(this.api.setProperty(k.PROP_POSSIBLEPOSITIONS,e),!p||"Top"!==(e=this.api.getProperty("Legend.Position"))&&"Bottom"!==e||this.api.setProperty("Legend.Position","Right"))),c&&c.length&&(u.forEach(function(e,t){e=e.Name;_.isEmpty(e)&&d.api.setProperty(k.PROP_LEGEND_GROUPS+"."+t+".Name","Legend Group "+(t+1))}),p=this.api.getProperty(k.PROP_POSSIBLELEGENDGROUPS),e=u.map(function(e){return e.Name}),p!==["None"].concat(e)&&this.api.setProperty(k.PROP_POSSIBLELEGENDGROUPS,["None"].concat(e)),this.legend.onSettingsChange(u)),i[k.PROP_LAYERS]&&(n=this.api.getProperty(k.PROP_LAYERS),r=!1,o=_.reduce(n,function(e,t){return e[t[k.PROP_LAYER_ID]]=!0,e},{}),_.each(this.layers,function(e){void 0===e||o[e.getId()]||(e.isBar()&&d.updateBars(e.getAxisId("x")),r=!0,e.remove(d.gl),d.layers.splice(d.layers.indexOf(e),1),d.activeBounds.splice(d.layers.indexOf(e),1))}),_.each(this.layers,function(t){var e=_.findIndex(n,function(e){return e._Id===t.getId()});t.index!==e&&(t.index=e)}),(c=this.layers.find(function(e){var t;if(i&&i.Layers)return t=i.Layers[e.index],e.getLayerType()!==t._Type||e.wildcardDataChanged(t[F.PROP_DATA])||d.layers.length!==i[k.PROP_LAYERS].length}))||this.updateWildcardLayers(),this.drawLayers(i),this.invalidate(this.layers.length?r||c?M.Process:M.Legend:M.Uniforms)),i[k.PROP_LEGEND_POS]&&_.some(this.layers,function(e){return e.hasData()})&&this.invalidate(M.Legend),s=_.find(_.keys(i),function(e){return 0===e.indexOf("Xaxes")}),a=_.find(_.keys(i),function(e){return 0===e.indexOf("Yaxes")}),p=this.api.getProperty("Xaxes"),e=this.api.getProperty("Yaxes"),l=[],h=[],(s||a)&&(s&&_.each(p,function(e,t){var i=d.axis.x[t];i&&e.Type!==i.axisType&&l.push(Number(t)),d.axis.onSettingsChange(s,t)}),a&&_.each(e,function(e,t){var i=d.axis.y[t];i&&e.Type!==i.axisType&&h.push(Number(t)),d.axis.onSettingsChange(a,t)}),this.selZoom||this.checkRangeViewstatesChanged(p,"Xaxes"),this.selZoom||this.checkRangeViewstatesChanged(e,"Yaxes"),this.selZoom&&(this.getSelectionViewstates(),this.zoomTime=Date.now()),u=function(e,i){e.forEach(function(t){d.layers.forEach(function(e){e.getAxisId(i)===t&&e.updateRenderState()})})},l.length||h.length?(l.length&&u(l,"x"),h.length&&u(h,"y"),this.invalidate(M.Process)):this.processIfFixedBars()),(c=_.find(_.keys(i),function(e){return 0===e.indexOf(k.PROP_CROSSHAIRS)}))&&!i[c]&&this.crosshairHover.hideCrosshair("hide-both"),(p=_.find(_.keys(i),function(e){return 0===e.indexOf(k.PROP_COORDS)}))&&!i[p]&&this.tooltips.hideCoordinates(this.el),_.find(_.keys(i),function(e){return 0===e.indexOf(k.PROP_EXPORT)})&&this.fileExporterView.displayChoiceLinkButtons())},k.prototype.onWheelZoom=function(e){var t,i,n,r,o=this.zoomedPoint||this.overPoint;o&&e.deltaY&&(e.preventDefault(),r=n=1,e.deltaY<(i=t=0)?(this.zoomedPoint=this.closestPoint,e.shiftKey?(i=.1*o.y,r=1-.1*(1-o.y)):(t=.1*o.x,n=1-.1*(1-o.x))):0<e.deltaY&&(e.shiftKey?(i=-.1*o.y,r=1+.1*(1-o.y)):(t=-.1*o.x,n=1+.1*(1-o.x))),o=new I(t,i,n,r),t=N.calculateCroppedBounds(o,this.activeZoom),i=!e.shiftKey&&1<t.z-t.x,n=e.shiftKey&&1<t.w-t.y,(r=i||n)&&(o=new I(0,0,1,1),i?t=new I(0,t.y,1,t.w):n&&(t=new I(t.x,0,t.z,1))),e.shiftKey?this.onYZoom=!0:this.onXZoom=!0,this.activeZoom=t,this.onZoom(o,!e.shiftKey,e.shiftKey,r))},k.prototype.onZoom=function(i,e,t,n){var r=this;e&&this.axis.x.forEach(function(e,t){r.xAxisZoom[t]=n?new w(0,1):r.xAxisZoom[t]?N.calculateCroppedJs2(new w(i.x,i.z),r.xAxisZoom[t]).applyFn(N.convertJSToNumber):new w(r.activeZoom.x,r.activeZoom.z)}),t&&this.axis.y.forEach(function(e,t){return r.yAxisZoom[t]=n?new w(0,1):r.yAxisZoom[t]?N.calculateCroppedJs2(new w(i.y,i.w),r.yAxisZoom[t]).applyFn(N.convertJSToNumber):new w(r.activeZoom.y,r.activeZoom.w)}),this.processIfFixedBars()},k.prototype.updateWildcardLayers=function(i,n){var r=this,o=!1,e=_.filter(this.api.getProperty("Layers"),function(e){return N.isRegexOrWild(e.YAxis)});_.each(this.api.getProperty("Layers"),function(e,t){t=r.layers[t];t&&t.isBar()&&(o=r.updateBars(t.getAxisId("x")))}),_.each(e,function(t){var e=_.findIndex(r.layers,function(e){return e.getId()===t._Id});t.Enabled||r.legend.updateWildcards(r.layers[e],e),!0!==t.Enabled||i||r.legend.updateWildcards(r.layers[e],e,"reset",n)}),this.legend.getLayers(this.layers),o&&this.invalidate(M.Process)},k.prototype.remove=function(){var t=this;return this.overlay&&this.overlay.remove(),this.layers.forEach(function(e){return e.remove(t.gl)}),this},k.prototype.setTheme=function(e){"Light"===e?this.el.classList.add("Light"):this.el.classList.remove("Light"),this.axis.updateTheme(e),this.axis.renderAxes(),this.legend.updateTheme(e),this.tooltips.updateTheme(e,this.el),this.theme=e,this.invalidate(M.Legend)},k.prototype.calculateLayerAxisMaps=function(){var n=this;this.xAxisLayer={},this.yAxisLayer={},this.layerXAxis={},this.layerYAxis={},this.layers.forEach(function(e,t){var i=n.api.getProperty(e.indexProp(F.PROP_XAXISID)).replace(/.*?(\d+)$/,"$1"),e=n.api.getProperty(e.indexProp(F.PROP_YAXISID)).replace(/.*?(\d+)$/,"$1");i&&(i=Number(i)-1,void 0===n.xAxisLayer[i]?n.xAxisLayer[i]=[t]:n.xAxisLayer[i].push(t),n.layerXAxis[t]=i),e&&(e=Number(e)-1,void 0===n.yAxisLayer[e]?n.yAxisLayer[e]=[t]:n.yAxisLayer[e].push(t),n.layerYAxis[t]=e)})},k.prototype.checkRangeViewstatesChanged=function(e,o){var s=this;_.each(e,function(e,t){var i=s.api.getPropertyMeta(o+"."+t+S.PROP_SEL_MIN),n=s.api.getPropertyMeta(o+"."+t+S.PROP_SEL_MAX),t=("Xaxes"===o?s.xAxisViewBounds:s.yAxisViewBounds)[t],r=!t&&(i.value||n.value);(i.viewstateType||n.viewstateType)&&(t||r)&&(s.selZoom=!0)})},k.prototype.createDataBounds=function(e,r,o,s){var a=this;return e.map(function(e,t){var i=new w(0,1),n=(o[t]&&(n=o[t].map(function(e){return a.layers[e].isEnabled()&&a.layers[e].hasData()?r[e]:null}).filter(function(e){return e}),i=N.mergeRange(n)||new w(0,1)),_.max(a.getLayerTypes(s?"x":"y",t)));return a.axis.getBounds(i,s?"Xaxes":"Yaxes",t,n)})},k.prototype.createViewBounds=function(l,h,u,c,e){var p=this;return e.map(function(e,t){var i=new w(0,1),n=new w(0,1),r=c?p.xAxisLayer:p.yAxisLayer;if(!r[t])return[i,n];var o,r=r[t].map(function(e){if(l[e])return c?N.xPart(l[e]):N.yPart(l[e])}).filter(function(e){return e}),i=N.mergeRange(r)||new w(0,1),r=_.max(p.getLayerTypes(c?"x":"y",t)),s=(p.updateZoomValues(i,t,r,c),(c?p.xAxisZoom:p.yAxisZoom)[t]),s=s?s.applyFn(N.convertJSToNumber):c?new w(p.activeZoom.x,p.activeZoom.z):new w(p.activeZoom.y,p.activeZoom.w),a=s;return h?(o=(c?p.lastXZoom:p.lastYZoom)[t])&&(a=N.scale2(u,o,s)):(p.zoomTime=0,c?p.lastXZoom[t]=_.clone(s):p.lastYZoom[t]=_.clone(s)),n=a.applyFn(N.convertJSToNumber),[N.calculateCroppedJs2(n,i,r),n]})},k.prototype.drawCoordinates=function(e,t,i,n){var r="";t&&("x"===(r=this.overlay.getZoomDirection())?this.tooltips.hideCoordinates(this.el,"y"):"y"===r&&this.tooltips.hideCoordinates(this.el,"x"));var o,s,a,l=this.api.getProperty(k.PROP_SNAP)&&!t,h=!l&&this.overPoint?new w(this.overPoint.x,Math.abs(this.overPoint.y)):new w(e.overpoint.x,1-e.overpoint.y),u=t?0:e.layer.index,u=this.activeBounds[u].applyFn(N.toNumber),c=null,p=null;"y"!==r&&(s=(o="Category"===e.layer.getAxisType("x")?D.Float:e.layer.XType)?new w(Number(N.convertJSToScalar(o,u.x)),Number(N.convertJSToScalar(o,u.z))):new w(u.x,u.z),a=l?i:(s.y-s.x)*h.x+s.x,c=this.getCoordinateInfo(e,t,a,i,"x")),"x"!==r&&(s=(o="Category"===e.layer.getAxisType("y")?D.Float:e.layer.YType)?new w(Number(N.convertJSToScalar(o,u.y)),Number(N.convertJSToScalar(o,u.w))):new w(u.y,u.w),a=l?n:(s.x-s.y)*h.y+s.y,p=this.getCoordinateInfo(e,t,a,n,"y")),this.tooltips.drawCoordinates(this.canvas,h,this.renderedMargin,this.el,c,p)},k.prototype.drawLayers=function(s){var a=this,l=this.api.getProperty(k.PROP_LAYERS),h=_.reduce(l,function(e,t){return e[t[k.PROP_LAYER_ID]]=!0,e},{}),i=(_.each(l,function(e,t){var i,n=(e=s.Layers[t]?s.Layers[t]:e)[k.PROP_LAYER_ID],r=(_.isEmpty(n)&&(n=e[k.PROP_LAYER_ID]=k.getNewLayerId(h),h[n]=!0,a.api.setProperty(k.PROP_LAYERS+"."+t+"."+k.PROP_LAYER_ID,n,{silent:!0})),e[k.PROP_LAYER_NAME]),r=(_.isEmpty(r)&&a.api.setProperty(k.PROP_LAYERS+"."+t+"."+k.PROP_LAYER_NAME,"Layer "+(t+1)),_.find(a.layers,function(e){return e.getId()===n})),t=_.findIndex(l,function(e){return e._Id===n}),o=!1;r||(o=!0,r=new F(t,n,a.api,a.invalidate.bind(a),a.setIgnoreSettings.bind(a),a.el,a.updateWildcardLayers.bind(a)),a.layers.push(r),0<t&&a.layers[t-1].isBar()&&a.updateBars(a.layers[t-1].getAxisId("x"))),r.onSettingsChange(e),0<t&&!r.getDataSource()&&o&&(i=t-1,e=[F.PROP_COLOR,F.PROP_XAXISID,F.PROP_YAXISID,F.PROP_TYPE,F.PROP_XAXIS,F.PROP_YAXIS,F.PROP_BARPERCENT,F.PROP_BARFIXED,F.PROP_BARWIDTHTYPE,F.PROP_FILL,F.PROP_FILLCOLOR,F.PROP_FILLOPACITY,F.PROP_BEARCOLOR,F.PROP_BULLCOLOR,F.PROP_NEUTRALCOLOR,F.PROP_WICKCOLOR,F.PROP_CANDLEPERCENT,F.PROP_CANDLEFIXED,F.PROP_CANDLEWIDTHTYPE,F.PROP_PALETTE,F.PROP_SPAN_GAPS,F.PROP_FILLPALETTE,F.PROP_FADE],o=_.map(e,function(e){return a.api.getProperty("Layers."+i+"."+e)}),r.updateLayer(a.layers[i].getDataSource(),o,e))}),[]),n=(_.each(l,function(t){var e=a.layers[_.findIndex(a.layers,function(e){return e.getId()===t._Id})];e&&i.push(e)}),this.layers=i,this.legend.getLayers(this.layers),this.layers.filter(function(e){return"Line"===a.api.getProperty(e.indexProp(F.PROP_TYPE))}));this.setIgnoreSettings(!0),_.each(n,function(e){var t=a.api.getProperty(e.indexProp(F.PROP_FILL)),i=a.api.getProperty(e.indexProp("possibleLayers"));i&&i.length===n.length+1||(i=_.map(n,function(e){return"Layer "+(e.index+1)}),i=["No Fill","Origin"].concat(_.without(i,"Layer "+(e.index+1))),a.api.setProperty(e.indexProp("possibleLayers"),i),-1===i.indexOf(t)&&a.api.setProperty(e.indexProp(F.PROP_FILL),"No Fill"))}),this.setIgnoreSettings(!1)},k.prototype.doActions=function(e,n,r){var o,t=this.api.getProperty(e.indexProp(F.PROP_ACTIONS));t.length&&(this.setIgnoreSettings(!0),o=[],t.forEach(function(e,t){var i=n.data[e.Current];"mousemove"===r&&"Hover"!==e.Trigger||"mousemove"!==r&&"Hover"===e.Trigger||o.push(g(g({},e),{Value:i,_PropertyIndex:t}))}),this.api.doActions(o,"Layers.".concat(e.index,".Actions")),this.setIgnoreSettings(!1))},k.prototype.getLayerDataBounds=function(e){return I.fromVec2(this.xAxisDataBounds[this.layerXAxis[e]],this.yAxisDataBounds[this.layerYAxis[e]])},k.prototype.getLayerViewBounds=function(e){return I.fromVec2(this.xAxisViewBounds[this.layerXAxis[e]],this.yAxisViewBounds[this.layerYAxis[e]])},k.prototype.getCoordinateInfo=function(e,t,i,n,r){var o=e.layer.getAxisId(r),s=r.toUpperCase()+"axes.",t=t?this.api.getProperty(s+"0.Position"):this.api.getProperty(s+o+".Position"),s=i;return!_.isEqual(i,n)&&E.Tools.isKDBTemporal(n)&&(o=e.layer.index,s=N.convertToJsScalar(this.getLayerType(r,o),i,!0)),{position:t,val:s}},k.prototype.getGroupedBars=function(){var o,i,n,r,s=[];if(this.layers.filter(function(e){return e.isBar()&&e.isEnabled()}).forEach(function(t){var e=t.getWildcardColumns();1<e.length?e.forEach(function(e){return s.push(t)}):s.push(t)}),s.length)return o={},this.api.getProperty("Xaxes").forEach(function(e,t){var i=s.filter(function(e){return e.getAxisId("x")===t}),n=i.map(function(e){return e.getGroupedBarData()}),r=[];n.forEach(function(e){return r=r.concat(e)}),o[t]={dataLength:_.uniq(r).length,indices:i.map(function(e,t){return t}),layers:i}}),i=[],n=[],r=[],s.forEach(function(e,t){e=o[e.getAxisId("x")];i[t]=e.indices,n[t]=e.layers,r[t]=e.dataLength}),{barIndices:i,dataLengths:r,layersCommonXAxis:n,allBarLayers:s}},k.prototype.getLayerType=function(e,t){t=this.layers[t];if(!t.hasData())return D.Float;var i="y"===e?t.YType:t.XType;return"Category"===t.getAxisType(e)?D.Float:i},k.prototype.getLayerTypes=function(t,i,e){var n=this.api.getProperty(t.toUpperCase()+"axes."+i+".Type"),r=this.layers.filter(function(e){return e.getAxisId(t)===i&&e.isEnabled()&&e.hasData()});return r.length&&("Category"!==n||e)?r.map(function(e){return"x"!==t&&e.YType||e.XType}):[D.Float]},k.prototype.getSelectionViewstates=function(){function r(e,t){if("Category"===o.api.getProperty(e+"axes."+t+".Type"))return null==(e=o.layers.filter(function(e){return e.getAxisId("x")===t})[0])?void 0:e.getAllCategoryData("x")}var o=this;this.axis.x.forEach(function(e,t){var i=o.xAxisDataBounds[t]||new w(0,1),n=o.axis.getSelectionZoomBounds(i,"Xaxes",t,_.max(o.getLayerTypes("x",t,!0)),r("X",t));o.xAxisZoom[t]=N.calculateCrop(n,i)}),this.axis.y.forEach(function(e,t){var i=o.yAxisDataBounds[t]||new w(0,1),n=o.axis.getSelectionZoomBounds(i,"Yaxes",t,_.max(o.getLayerTypes("y",t,!0)),r("Y",t));o.yAxisZoom[t]=N.calculateCrop(n,i)})},k.prototype.initializeEventListeners=function(){var t,i=this;this.el.addEventListener("mousedown",function(e){e.target===i.el.getElementsByClassName("axis")[0]&&(i.panning=!0,t=i.pan.onAxisPan(e,i.el.getBoundingClientRect())[1],i.pan.onPointDown(i.pan.onAxisPan(e,i.el.getBoundingClientRect())[0],t))}),document.addEventListener("mouseup",function(){setTimeout(function(){i.panning=!1,document.body.style.cursor="default"},75)}),document.addEventListener("mousemove",function(e){i.panning&&(e=i.pan.onAxisPan(e,i.el.getBoundingClientRect())[0],i.pan.onPanning(e,t,i.xAxisZoom,i.yAxisZoom,i.activeXPan,i.activeYPan,i.el))}),this.el.addEventListener("wheel",function(e){i.onWheelZoom(e)})},k.prototype.invalidate=function(e){if(e<this.renderState){if((this.renderState=e)===M.Process&&this.expressTime<Date.now()-k.REST_MS&&_.every(this.layers,function(e){return e.RenderState===M.Process}))return this.expressTime=Date.now(),this.validate();window.requestAnimationFrame(this.validate.bind(this))}},k.prototype.onOverlayClick=function(){this.click=!0,this.invalidate(M.Tooltip)},k.prototype.processIfFixedBars=function(){var e=this.layers.filter(function(e){return e.hasFixedWidth()||e.isCandlestick()});_.each(e,function(e){return e.onResize()}),this.invalidate(e.length?M.Process:M.Axis)},k.prototype.setIgnoreSettings=function(e){this.ignoreSettingsChange=e},k.prototype.setRange=function(e,t,i,n,r,o){var s=r?new w(this.activeZoom.x,this.activeZoom.z):new w(this.activeZoom.y,this.activeZoom.w),n=n?n.applyFn(N.convertJSToNumber):s,s=N.calculateCroppedJs2(n,t,i),n=o[1];n&&n.length&&(i=(t=function(e,i){return e.reduce(function(e,t){return Math.abs(t-i)<Math.abs(e-i)?t:e})})(n,s.x),t=t(n,s.y),i=n.indexOf(i),n=n.indexOf(t),t=o[0],s=new w(t[i],t[n])),this.setIgnoreSettings(!0),r?this.axis.x[e].setRangeViewstate(s,"Xaxes",e):this.axis.y[e].setRangeViewstate(s,"Yaxes",e),this.setIgnoreSettings(!1)},k.prototype.updateBars=function(t){var e=this.layers.filter(function(e){return e.isBar()&&e.isEnabled()&&e.getAxisId("x")===t});return e.forEach(function(e){return e.updateRenderState()}),!!e.length},k.prototype.updateLayerPossibleAxes=function(){var n=this,r=(this.setIgnoreSettings(!0),this.api.getProperty(k.PROP_XAXES)),o=this.api.getProperty(k.PROP_YAXES);_.each(this.layers,function(e,t){var i=n.api.getProperty("Layers."+t+".possibleXAxes"),t=n.api.getProperty("Layers."+t+".possibleYAxes");i.length!==r.length&&e.updateAxisId(r,"x"),t.length!==o.length&&e.updateAxisId(o,"y")}),this.setIgnoreSettings(!1)},k.prototype.updateZoomValues=function(e,t,i,n){var r=this.layers.filter(function(e){return e.getAxisId(n?"x":"y")===t})[0].getAllCategoryData(n?"x":"y"),o=_.max(this.getLayerTypes(n?"x":"y",t,!0)),o=this.axis.getSelectionZoomBounds(e,n?"Xaxes":"Yaxes",t,o,r);n?(this.selZoom&&(this.xAxisZoom[t]=N.calculateCrop(o,e)),this.onXZoom&&this.setRange(t,e,i,this.xAxisZoom[t],n,r)):(this.selZoom&&(this.yAxisZoom[t]=N.calculateCrop(o,e)),this.onYZoom&&this.setRange(t,e,i,this.yAxisZoom[t],n,r))},k.prototype.validate=function(){var s=this;if(!this.api.getProperty("Layers").length)return this.api.showErrorMessage({error:t("To get started, please add a layer from")+" <b> "+t("Properties-Layers")+" </b> ",type:"Warning"}),void this.legend.render();var r,o,a,e=this.layers.filter(function(e){return e.isEnabled()}),i=e.filter(function(e){return e.Config}),n=(this.renderState<M.Legend&&this.layers.filter(function(e){return!e.isEnabled()}).length&&!i.length&&(this.renderState=M.Legend),_.some(e,function(e){return e.RenderState===M.Data})),e=e.map(function(e){return e.datasourceError}).filter(function(e){return!!e});if(n&&_.isEmpty(e))this.isLoading||this.api.showQueryStatus({error:"",type:"Loading"}),this.isLoading=!0;else{if(this.layers.every(function(e){return e.isEnabled()&&e.hasNoResults()}))return this.api.showQueryStatus({error:"",type:"NoResults"}),void(this.renderState=M.Valid);e.length&&e[0]?(this.api.showQueryStatus({error:t(e[0].error),type:"Error"}),this.renderState=M.Valid):this.api.hideQueryStatus(),this.isLoading=!1}this.calculateLayerAxisMaps(),this.renderState<=M.Process&&i.length&&(r=this.getGroupedBars(),this.barGroupingInfo=r,0<this.layers.length&&this.layers.some(function(e){return e.getDataSource()})&&this.api.hideErrorMessage(),n=this.layers.map(function(e){return e.getDataRangeX()}),e=this.layers.map(function(e){return e.getDataRangeY()}),C=this.api.getProperty("Xaxes"),R=this.api.getProperty("Yaxes"),this.xAxisDataBounds=this.createDataBounds(C,n,this.xAxisLayer,!0),this.yAxisDataBounds=this.createDataBounds(R,e,this.yAxisLayer,!1),this.activeXPan=C.map(function(e,t){return s.activeXPan[t]||new w(0,1)}),this.activeYPan=R.map(function(e,t){return s.activeYPan[t]||new w(0,1)}),n=this.layers.filter(function(e){return e.hasFixedWidth()||e.isCandlestick()}),(this.onXZoom||this.onYZoom||this.selZoom)&&!this.resetZoom||_.each(n,function(e){return e.onResize()}),o=_.some(this.layers.filter(function(e){return e.isEnabled()}),function(e){return!e.Config}),(T=i.filter(function(e){return e.hasData()})).forEach(function(e){var t,i,n=e.isBar()&&!o&&r;n&&(t=r.allBarLayers.indexOf(e),i=r.layersCommonXAxis[t].indexOf(e),a={barIndices:r.barIndices[t],dataLength:r.dataLengths[t],index:i}),!n&&e.isBar()||e.processData(s.gl,s.size,N.calculateCroppedJsBounds(s.activeZoom,s.getLayerDataBounds(e.index),s.getLayerType("x",e.index),s.getLayerType("y",e.index)),a)}),T.forEach(function(e){var t,i,n=e.getFillType(),r=-1!==n.indexOf("Layer");e.RenderState!==M.Process||!r&&"Origin"!==n||(i=t=null,r&&(i=Number(n.replace(/.*?(\d+)$/,"$1")||1)-1,t=s.layers[i].getFillToLayerData()),r={fill:n,cols:t,toBounds:null!==i?N.calculateCroppedJsBounds(s.activeZoom,s.getLayerDataBounds(i),s.getLayerType("x",i),s.getLayerType("y",i)):void 0,fromBounds:N.calculateCroppedJsBounds(s.activeZoom,s.getLayerDataBounds(e.index),s.getLayerType("x",e.index),s.getLayerType("y",e.index))},e.processLineFillData(s.gl,r))}),!i.filter(function(e){return e.RenderState>=M.Process}).length&&i.length||(e=this.onXZoom||this.onYZoom||this.resetZoom||this.selZoom,this.renderState=e?M.Axis:M.Legend),_.some(i,function(e){return!1===e.hasData()})&&(this.renderState=M.Process)),this.renderState===M.Legend&&(this.legend.render(!1),this.axis.onResize(),this.renderState=M.Axis);var l,h,u=[],c=[];if(this.renderState===M.Axis&&(this.updateLayerPossibleAxes(),n=this.layers.map(function(e){if(!e.isEnabled()||!e.Config)return null;var t=e.index,i=e.getAxisId("x"),n=e.getAxisId("y"),i=s.activeXPan[i],n=s.activeYPan[n],i=new I(i.x,n.x,i.y,n.y),n=e.getPaddedRange(s.getLayerDataBounds(t),s.size,s.barGroupingInfo),e=s.getLayerType("x",t),t=s.getLayerType("y",t);return N.calculateCroppedJsBounds(i,n,e,t)}),e=!1,g=0,(this.lastXZoom.length||this.lastYZoom.length)&&(S=Date.now()-this.zoomTime,y=this.api.getProperty(k.PROP_DURATION),g=(0,De[this.api.getProperty(k.PROP_EASING)])(S/y),this.animateZoom=!!(e=S<y)),S=this.api.getProperty("Xaxes"),y=this.createViewBounds(n,e,g,!0,S),this.xAxisViewBounds=y.map(function(e){return e[0]}),u=y.map(function(e){return e[1]}),S=this.api.getProperty("Yaxes"),y=this.createViewBounds(n,e,g,!1,S),this.yAxisViewBounds=y.map(function(e){return e[0]}),c=y.map(function(e){return e[1]}),this.onXZoom=!1,this.onYZoom=!1,this.selZoom=!1,l=function(t,i,e){var n=s.layers.filter(function(e){return e.getAxisId(t)===i}).map(function(e){return e.getAllCategoryData(t)[0]}),r=[],n=(n.forEach(function(e){return r=r.concat(e)}),"x"===t?r:r[0]),n=_.uniqBy(n,function(e){return e.i&&e.n?e.i&&e.n:e.i||e});e.updateCategoryData(n)},this.setIgnoreSettings(!0),_.values(this.axis.x).forEach(function(e,t){var i=s.getLayerTypes("x",t,!0),t=("Category"===s.api.getProperty("Xaxes."+t+".Type")&&l("x",t,e),s.xAxisViewBounds[t]||new w(0,1));e.updateBounds(t,i)}),_.values(this.axis.y).forEach(function(e,t){var i=s.getLayerTypes("y",t,!0),t=("Category"===s.api.getProperty("Yaxes."+t+".Type")&&l("y",t,e),s.yAxisViewBounds[t]||new w(0,1));e.updateBounds(t,i)}),this.setIgnoreSettings(!1),_.first(i.map(function(e){return e.Config}).filter(function(e){return!!e}))&&(n=this.axis.render(this.size.x,this.size.y,this.api.getProperty("Xaxes"),this.api.getProperty("Yaxes")),_.isEqual(n,this.renderedMargin)&&this.size===this.renderedSize||(e=Math.max(this.size.x-n.x-n.z,0),g=Math.max(this.size.y-n.y-n.w,0),this.overlay.resize(n.x,n.y,e,g),this.canvas.style.left=n.x+"px",this.canvas.style.top=n.y+"px",this.canvas.width=e,this.canvas.height=g,this.renderedMargin=_.clone(n),this.renderedSize=this.size),S=u[0]||new w(0,1),this.crosshairSelected.updateSelected(S,this.animateZoom)),this.renderState=M.Uniforms),this.renderState===M.Uniforms&&_.every(i.filter(function(e){return e.hasData()}),function(e){return e.RenderState>=M.Uniforms})&&(N.isWebGLHWAcclEnabled||N.isIE11?this.gl.clearColor(0,0,0,0):"Light"===this.theme?this.gl.clearColor(.973,.973,.973,0):this.gl.clearColor(.157,.157,.157,0),(h=this.gl).clear(h.COLOR_BUFFER_BIT),h.viewport(0,0,h.canvas.width,h.canvas.height),h.enable(h.BLEND),h.blendFunc(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA),_.filter(i,function(e){return e&&e.RenderState===M.Uniforms}).forEach(function(e){var t,i,n;e.hasData()&&(t=0,s.api.getProperty("Layers."+e.index+".ScaleOnZoom")&&(n=s.animateZoom?u:s.lastXZoom,i=s.animateZoom?c:s.lastYZoom,n=n[s.layerXAxis[e.index]]||new w(0,1),i=i[s.layerYAxis[e.index]]||new w(0,1),t=((n=I.fromVec2(n,i)).z-n.x+(n.w-n.y))/2),i="Line"===s.api.getProperty(e.indexProp("_Type")),n="No Fill"!==s.api.getProperty(e.indexProp("Fill")),i&&n&&e.render(h,s.getLayerViewBounds(e.index),t,!0),e.render(h,s.getLayerViewBounds(e.index),t,!1))}),this.renderState=this.panning||this.animateZoom?M.Axis:M.Tooltip),this.renderState===M.Tooltip){if(this.resetZoom=!1,this.activeBounds=this.layers.map(function(e){return s.getLayerViewBounds(e.index)}),!this.activeBounds.length)return;var p,d,y=this.api.getProperty(k.PROP_HOVER),e=this.api.getProperty(k.PROP_SELECT),g=void 0,e=(null!==this.overPoint||!y&&!e||(p=this.settingsSelected?e:this.settingsHovered?y:"")&&(d=p,(n=_.find(this.xAxisViewBounds,function(e,t){t=_.max(s.getLayerTypes("x",t));return d=N.convertJSToNumber(N.convertStringToJsScalar(p,t)),e=e.applyFn(N.convertJSToNumber),d>=e.x&&d<=e.y}))&&(S=n.applyFn(N.convertJSToNumber),g=new w((d-S.x)/(S.y-S.x),0))),this.api.getProperty(k.PROP_COORDS)),n=this.overlay.isDragging(),f=this.overPoint||g;if(!f||n&&!e)return this.renderState=M.Valid,void(y||(this.tooltips.hideTooltip(),this.tooltips.hideCoordinates(this.el),this.crosshairHover.hideCrosshair(""),this.hover=!1));var m=[],P=[],x=((T=i.filter(function(e){return e.hasData()})).forEach(function(n){var r,o,e,t,i=n.getClosestPointFromRelativeX(f.x,1+f.y,s.canvas.width,N.convertVec4ToScalar(s.getLayerViewBounds(n.index),s.getLayerType("x",n.index),s.getLayerType("y",n.index)));null!==i&&(r=i[0],t=i[1],o=i[3],e=function(e){var t=n.getConvertedCategoryData(r,e,o),i=n.getAxisId(e),e=("x"===e?s.xAxisViewBounds:s.yAxisViewBounds)[i];return N.calcCrop(t,e.x,e.y)},e=new w("Category"===n.getAxisType("x")?e("x"):t.x,"Category"===n.getAxisType("y")?e("y"):t.y),m.push(new ye(n,r,e,i[2],o))),s.api.getProperty("Overlay.ShowAllPoints")&&(t=n.getAllPointsFromRelativeX(),_.each(t,function(e){_.each(e,function(e){e&&P.push(new ye(n,e[0],e[1],e[2],e[3]))})}))}),null),v=null,O=null,L=f.x,b=1+f.y;if(_.each(m,function(e){var t=Number(e.overpoint.x),i=Number(e.overpoint.y);null===v?(v=Math.abs(L-t),O=Math.abs(b-i),x=e):(t=Math.abs(L-t))<v?(v=t,O=Math.abs(b-i),x=e):t===v&&O&&Math.abs(b-i)<O&&(O=Math.abs(b-i),v=t,x=e)}),x){var S=x.overpoint;if(1<S.x||S.x<0||1<S.y||S.y<0||isNaN(S.x)||isNaN(S.y))return void(this.renderState=M.Valid);this.closestPoint!==x.overpoint&&(this.closestPoint=x.overpoint);g=P.length?P:m,y=this.tooltips.render(this.canvas,x,g,m),i=this.tooltips.returnPointInfo();if(i&&y){var C=this.api.getProperty(x.layer.indexProp(F.PROP_XAXIS)),R=x.yAxis,T=y[C];if(e&&this.drawCoordinates(x,n,T,y[R]),n)return this.crosshairHover.hideCrosshair(""),this.tooltips.hideTooltip(),void(this.renderState=M.Valid);this.hover||!this.click&&!this.settingsSelected?(this.doActions(x.layer,i,"mousemove"),S=!this.api.getProperty(k.PROP_SNAP)&&this.overPoint?new w(this.overPoint.x,1+this.overPoint.y):x.overpoint,this.crosshairHover.render(this.renderedMargin,S,"hover",this.options.dashboardViewModel.get(k.APP_THEME)),this.overPoint&&this.api.getPropertyMeta(k.PROP_HOVER).viewstateType&&(E.Tools.isKDBTemporal(T)&&(T=E.Tools.convertKDBTemporalToMoment(T).toDashString()),this.api.setProperty(k.PROP_HOVER,T))):(this.doActions(x.layer,i,"click"),this.crosshairSelected.render(this.renderedMargin,x.overpoint,"click",this.options.dashboardViewModel.get(k.APP_THEME)),this.click&&this.api.getPropertyMeta(k.PROP_SELECT).viewstateType&&(E.Tools.isKDBTemporal(T)&&(T=E.Tools.convertKDBTemporalToMoment(T).toDashString()),this.api.setProperty(k.PROP_SELECT,T)))}}else this.tooltips.hideTooltip();this.hover=!1,this.click=!1,this.settingsHovered=!1,this.settingsSelected=!1,this.renderState=M.Valid}this.renderState<M.Valid&&window.requestAnimationFrame(this.validate.bind(this))},k.getComponentDefinition=z.getComponentDefinition,k.PROP_COORDS="Overlay.ShowCoordinates",k.PROP_CROSSHAIRS="Overlay.ShowCrosshairs",k.PROP_DURATION="Basics.Duration",k.PROP_HOVER="Basics.Hover",k.PROP_SELECT="Basics.Selected",k.PROP_EASING="Basics.Easing",k.PROP_LAYERS="Layers",k.PROP_LAYER_ID="_Id",k.PROP_LAYER_NAME="Name",k.PROP_LEGEND_GROUPS="Legend.LegendGroups",k.PROP_POSSIBLELEGENDGROUPS="possibleLegendGroups",k.PROP_LEGEND_POS="Legend.Position",k.PROP_POSSIBLEPOSITIONS="possiblePositions",k.PROP_SNAP="Overlay.SnapToPoint",k.APP_THEME="DashboardTheme",k.PROP_XAXES="Xaxes",k.PROP_YAXES="Yaxes",k.PROP_EXPORT="FileExport",k.REST_MS=500,k});